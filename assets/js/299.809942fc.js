(window.webpackJsonp=window.webpackJsonp||[]).push([[299],{487:function(t,s,a){"use strict";a.r(s);var n=a(0),r=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"服务端渲染概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端渲染概述","aria-hidden":"true"}},[t._v("#")]),t._v(" 服务端渲染概述")]),t._v(" "),a("p",[t._v("主流的单页面应用"),a("code",[t._v("vue")]),t._v("、"),a("code",[t._v("react")]),t._v("都是客户端渲染技术，也就是俗称的"),a("font",{attrs:{color:"#DD1144"}},[t._v("CSR")]),t._v(",这种会带来两个普遍的问题：")],1),t._v(" "),a("ul",[a("li",[a("font",{attrs:{color:"#9400D3"}},[t._v("首屏展示(TTFP)时间过长")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#9400D3"}},[t._v("网站的SEO搜索效果都很差")])],1)]),t._v(" "),a("p",[t._v("所以关于主流的"),a("code",[t._v("SSR")]),t._v("框架都有"),a("font",{attrs:{color:"#DD1144"}},[t._v("NEXT.js(react)")]),t._v("和"),a("font",{attrs:{color:"#DD1144"}},[t._v("NUXT.js(vue)")]),t._v(",但是使用别人的框架不算什么本事，我们希望自己能够搞出一个"),a("code",[t._v("SSR")]),t._v("框架，实现原理的真正熟知。我们整个要解决的问题有下面这些：")],1),t._v(" "),a("ul",[a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("搭建React SSR框架，解决CSR问题")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("在框架中如何实现同构")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("框架中路由机制的实现")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("框架与Redux的融合")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("框架作为中间层的职能处理")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("细节调优")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("样式相关的Webpack配置")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("框架SEO特性优化")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("预渲染技术介绍")])],1)]),t._v(" "),a("h2",{attrs:{id:"什么是服务端渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是服务端渲染","aria-hidden":"true"}},[t._v("#")]),t._v(" 什么是服务端渲染")]),t._v(" "),a("p",[t._v("我们首先创建一个"),a("code",[t._v("server")]),t._v("文件件，使用"),a("code",[t._v("npm init")]),t._v("创建"),a("code",[t._v("package.json")]),t._v("文件，然后下载"),a("code",[t._v("express")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("npm install express "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("save "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("registry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("taobao"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org\n")])])]),a("p",[t._v("然后创建"),a("code",[t._v("app.js")]),t._v("，内容如下：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" express "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("`<html>\n\t\t\t<head>\n\t\t\t\t<title>hello</title>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t<h1>first lesson</h1>\n\t\t\t\t<p>hello world</p>\n\t\t\t</body>\n\t\t</html>`")])]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" host "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("address\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" port "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port\n\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Example app listening at http://%s:%s'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("这就是一个最简单的"),a("code",[t._v("Node")]),t._v("的"),a("code",[t._v("http")]),t._v("的服务器，使用"),a("code",[t._v("node app.js")]),t._v("即可以启动整个服务器，然后在浏览器中打开"),a("code",[t._v("localhost:3000")]),t._v("就能看到内容了。")]),t._v(" "),a("p",[t._v("这种页面渲染的方式就是"),a("font",{attrs:{color:"#DD1144"}},[t._v("服务端渲染")]),t._v("，"),a("font",{attrs:{color:"#9400D3"}},[t._v("服务端渲染的本质就是页面显示的内容是服务器端生产出来的")]),t._v("，它的最大的特性页面上的内容全部都是在服务端上就已经做好了，浏览器拿到只负责显示而已。")],1),t._v(" "),a("h2",{attrs:{id:"什么是客户端渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是客户端渲染","aria-hidden":"true"}},[t._v("#")]),t._v(" 什么是客户端渲染")]),t._v(" "),a("p",[t._v("我们再通过"),a("code",[t._v("create-react-app client")]),t._v("来创建一个"),a("code",[t._v("react")]),t._v("的项目，然后使用"),a("code",[t._v("npm start")]),t._v("来启动项目，你会在浏览器发现是有内容的，但是当你打开源代码你会发现实际上页面显示的东西并不存在于源代码当中，而是源代码通过加载一个"),a("code",[t._v("js")]),t._v("文件，通过"),a("code",[t._v("javascript")]),t._v("来向空的页面上添加内容。")]),t._v(" "),a("p",[t._v("所以"),a("font",{attrs:{color:"#9400D3"}},[t._v("客户端渲染的本质就是浏览器上的页面上的内容是通过javascript代码执行生产出来的，而javascript执行在客户端，所以称为客户端渲染")])],1),t._v(" "),a("h2",{attrs:{id:"客户端渲染的优劣"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端渲染的优劣","aria-hidden":"true"}},[t._v("#")]),t._v(" 客户端渲染的优劣")]),t._v(" "),a("p",[t._v("在前后端分离的过程当中，客户端渲染的优势很明显，")]),t._v(" "),a("ul",[a("li",[a("font",{attrs:{color:"#DD1144"}},[t._v("前端负责渲染页面，后端负责实现接口，各自干好各自的事情，对开发效率有极大的提升")])],1)]),t._v(" "),a("p",[t._v("但是客户端的劣势也极其明显：\n"),a("img",{attrs:{src:t.$withBase("/react_ssr_csr_ssr.png"),alt:""}})]),t._v(" "),a("ul",[a("li",[a("p",[a("font",{attrs:{color:"#DD1144"}},[t._v("SSR的请求流程很简单，就是请求服务器，服务器返回完整的html文件，浏览器直接显示即可，但是CSR浏览器拿到的是一个空的html和一堆js文件，所以浏览器要想服务器重新请求这些js文件并且下载，下载好了还要执行，js文件执行的就是react代码，react代码运行完毕用户才能看到完整的页面")])],1)]),t._v(" "),a("li",[a("p",[a("font",{attrs:{color:"#1E90FF"}},[t._v("对比之下，CSR用户看到页面要经历的时间更长，就是因为时间都花费在了下载js文件和执行js文件，导致首屏加载时间过长")])],1)]),t._v(" "),a("li",[a("p",[a("font",{attrs:{color:"#1E90FF"}},[t._v("同时正是因为页面的DOM结构都是由js渲染出来的，对SEO不友好，因为搜索引擎的爬虫只认识html上的内容，不认识js的内容，所以如果是客户端渲染的网页，爬虫爬的是空的html文件，当然无法给你好的排名")])],1)])])])},[],!1,null,null,null);s.default=r.exports}}]);