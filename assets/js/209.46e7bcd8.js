(window.webpackJsonp=window.webpackJsonp||[]).push([[209],{396:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"ejs模板引擎介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ejs模板引擎介绍","aria-hidden":"true"}},[t._v("#")]),t._v(" ejs模板引擎介绍")]),t._v(" "),s("p",[t._v("我们首先在"),s("code",[t._v("app.js")]),t._v("当中注册了所有"),s("code",[t._v("ejs")]),t._v("的文件夹"),s("code",[t._v("views")]),t._v("，所以当我们的路由通过"),s("code",[t._v("ctx.render")]),t._v("方法就可以直接找到文件和传递参数：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("router"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello Koa 2!'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[s("font",{attrs:{color:"#CC99CD"}},[t._v("这段代码的意思就是当你访问根路由的时候，我们会到view目录下去找这个index.ejs文件，然后通过第二个参数来渲染index.ejs当中的所有内容，渲染完毕就把结果以html的方式返回给客户端。")])],1)]),t._v(" "),s("li",[s("p",[s("font",{attrs:{color:"#DD1144"}},[t._v("为什么我们使用ctx.render的时候使用await，也就是使用异步的方式去渲染的？实际上渲染模板的过程是读取模板文件的过程，属于读取文件这种I/O操作，在node中所有I/O文件都是异步的，所以一定要加这个await关键字，否则如果是同步的话还没与来得及读取完文件内容就返回了")])],1)])]),t._v(" "),s("p",[t._v("基本上"),s("code",[t._v("ejs")]),t._v("在"),s("code",[t._v("koa2")]),t._v("最简单的渲染过程我们已经说完了，下面我们来说说"),s("code",[t._v("ejs")]),t._v("模板中的具体使用。")]),t._v(" "),s("h2",{attrs:{id:"变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#变量","aria-hidden":"true"}},[t._v("#")]),t._v(" 变量")]),t._v(" "),s("p",[t._v("根据上面的过程我们是向模板传入了一个"),s("code",[t._v("title")]),t._v("的变量，然后我们在模板当中以这样的方式去获取并渲染的：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("<%= title %>"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("在"),s("code",[t._v("ejs")]),t._v("模板当中对变量有严格的控制，如果在"),s("code",[t._v("ejs")]),t._v("书写的模板变量后端在渲染的时候没有传入对应的值，就会报错，所以我们的解决方法是：")]),t._v(" "),s("ul",[s("li",[s("font",{attrs:{color:"#DD1144"}},[t._v("对于我们不确定是否后端会传入的变量我们需要在ejs模板当中添加locals前缀来防止报错")]),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("<%= locals.name %>"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])],1)]),t._v(" "),s("h2",{attrs:{id:"判断和循环"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#判断和循环","aria-hidden":"true"}},[t._v("#")]),t._v(" 判断和循环")]),t._v(" "),s("p",[t._v("其实对于判断语句来说也比较简单，几乎就像在写"),s("code",[t._v("javascript")]),t._v("语句一样，只不过每行的左右分别要用"),s("code",[t._v("<% %>")]),t._v("包裹起来,语句中的变量仍热需要使用"),s("code",[t._v("<%= %>")]),t._v("进行包裹")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    <% if(isMe) { %>\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("#"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" @ 提到我的（<%= locals.msgNum %>）"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    <% } else { %>\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("关注"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    <% }%>\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("而循环也不是和我们在"),s("code",[t._v("vue")]),t._v("当中有什么指令，也是书写"),s("code",[t._v("javascript")]),t._v("的方式，如下：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ul")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  <% blogList.forEach(blog => { %>\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("data-id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("<%= blog.id %>"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("<%= blog.title %>"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  <% }) %>\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ul")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h2",{attrs:{id:"引用组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引用组件","aria-hidden":"true"}},[t._v("#")]),t._v(" 引用组件")]),t._v(" "),s("p",[t._v("我们首先在"),s("code",[t._v("src/views/widgets/user-info.ejs")]),t._v("当中写如下内容:")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  <% if(isMe) { %>\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("#"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" @ 提到我的（<%= locals.msgNum %>）"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  <% } else { %>\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("关注"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  <% } %>\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("然后我们在"),s("code",[t._v("src/views/index.ejs")]),t._v("中调用这个组件：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[t._v("<%- include('widgets/user-info',{\n  isMe,\n  msgNum\n}) %>\n")])])]),s("p",[t._v("所以组件的引用使用的是这样的方式："),s("font",{attrs:{color:"#DD1144"}},[t._v("<%- include('组件路径'，参数对象)%>")])],1),t._v(" "),s("p",[t._v("这里有个特别注意的点就是，有时候我们在引用顶级变量的时候我们是不需要写"),s("code",[t._v("include")]),t._v("的第二个参数的，原因如下：")]),t._v(" "),s("ul",[s("li",[s("font",{attrs:{color:"#CC99CD"}},[t._v("包含的内容在运行时插入，在你顶级数据对象中的变量都可以用于所有的包含，而局部变量需要传递进来，如下")]),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ul")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  <% users.forEach(function(user){ %>\n    <%- include('user/show', {user: user}) %>\n  <% }); %>\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ul")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])],1)]),t._v(" "),s("p",[t._v("很简单，因为"),s("code",[t._v("user")]),t._v("变量已经不是顶级变量了，需要传值进去，但是我推荐的做法是这样：")]),t._v(" "),s("ul",[s("li",[s("font",{attrs:{color:"#1E90FF"}},[t._v("但为了组件的复用性，我还是习惯将组件内部的都作为私有变量使用，有传递关系，这样变量的来源就更加清晰了")])],1)]),t._v(" "),s("h2",{attrs:{id:"关于ejs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于ejs","aria-hidden":"true"}},[t._v("#")]),t._v(" 关于ejs")]),t._v(" "),s("p",[t._v("这里还有个很重要的概念："),s("font",{attrs:{color:"#3eaf7c"}},[t._v("SSR")]),t._v(",其实"),s("code",[t._v("SSR")]),t._v("的意思是服务端渲染，"),s("font",{attrs:{color:"#CC99CD"}},[t._v("只要是通过服务端返回的html都叫做SSR")]),t._v("，所以其实"),s("code",[t._v("SSR")]),t._v("技术并不是什么创新技术，在"),s("code",[t._v("React")]),t._v("和"),s("code",[t._v("Vue")]),t._v("当中都只是借鉴了以前的技术")],1),t._v(" "),s("p",[t._v("所以"),s("code",[t._v("SSR")]),t._v("渲染的技术前端拿到的都是已经有结果的"),s("code",[t._v("html")]),t._v("页面了，而"),s("code",[t._v("Vue")]),t._v("和"),s("code",[t._v("React")]),t._v("你看其实是一大堆"),s("code",[t._v("JS")]),t._v(",是通过"),s("code",[t._v("JS")]),t._v("发送"),s("code",[t._v("ajax")]),t._v("从后端拿到数据再局部渲染到当前页面。")]),t._v(" "),s("p",[t._v("所以"),s("code",[t._v("SSR")]),t._v("并不是什么高大上的技术，而且本身和"),s("code",[t._v("Vue")]),t._v("和"),s("code",[t._v("React")]),t._v("没有啥关系，甚至这种技术的雏形在上世纪90年代就有了，用"),s("code",[t._v("java")]),t._v("实现"),s("code",[t._v("SSR")]),t._v("的技术就是"),s("code",[t._v("jsp")]),t._v("，并不是用"),s("code",[t._v("java")]),t._v("去实现一个"),s("code",[t._v("Vue")]),t._v("或者"),s("code",[t._v("React")]),t._v(",谁现在还学"),s("code",[t._v("jsp")]),t._v("谁就是想返回上个世纪。")]),t._v(" "),s("p",[t._v("最后我们提交代码，当然我建议你在提交的时候使用"),s("code",[t._v("git diff")]),t._v("来检查一下修改的东西")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("git diff\ngit add "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\ngit commit "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'feat：ejs演示'")]),t._v("\ngit push origin master\n")])])])])},[],!1,null,null,null);a.default=e.exports}}]);