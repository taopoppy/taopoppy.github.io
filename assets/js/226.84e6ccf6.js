(window.webpackJsonp=window.webpackJsonp||[]).push([[226],{414:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"commonjs规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#commonjs规范","aria-hidden":"true"}},[t._v("#")]),t._v(" CommonJS规范")]),t._v(" "),a("p",[a("font",{attrs:{color:"#CC99CD"}},[t._v("CommonJS是一种规范，通过简单的API声明服务器的模块，目标是让JavaScript可以运行在浏览器之外的所有地方，例如在服务器或者本地桌面应用服务程序上")])],1),t._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介","aria-hidden":"true"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("p",[a("code",[t._v("CommonJS")]),t._v("原本是一个项目，由牛人云集的"),a("code",[t._v("CommonJS")]),t._v("社区指定，其中"),a("code",[t._v("Moudules1/0规范如下：")])]),t._v(" "),a("ul",[a("li",[t._v("规定模块的标识应该遵循的规则（手写规则）")]),t._v(" "),a("li",[t._v("定义全局函数"),a("code",[t._v("require")]),t._v(",通过传入模块标识来引入其他模块，执行结果即其他模块暴露出来的"),a("code",[t._v("API")])]),t._v(" "),a("li",[t._v("如果被"),a("code",[t._v("require")]),t._v("函数引入的模块中也包含依赖，则依次加载这些依赖")]),t._v(" "),a("li",[t._v("如果引入模块失败，那么"),a("code",[t._v("require")]),t._v("函数应该抛出异常")]),t._v(" "),a("li",[t._v("模块通过变量"),a("code",[t._v("exports")]),t._v("来向外暴露"),a("code",[t._v("API")]),t._v(","),a("code",[t._v("exports")]),t._v("只能是一个对象，暴露的"),a("code",[t._v("API")]),t._v("必须作为此对象的属性")])]),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("① CommonJS和Node.js的关系")])])],1),t._v(" "),a("p",[a("code",[t._v("Node.js")]),t._v("借鉴"),a("code",[t._v("CommonJS")]),t._v("模块规范实现了一套非常易用的模块系统，"),a("code",[t._v("npm")]),t._v("对模块规范的完美支持，也使得"),a("code",[t._v("Node.js")]),t._v("应用开发事半功倍，但是经常有人会说"),a("font",{attrs:{color:"#3eaf7c"}},[t._v("Node是基于CommmonJS规范的")]),t._v("，那其实这里有两个误区：")],1),t._v(" "),a("ul",[a("li",[a("font",{attrs:{color:"#CC99CD"}},[t._v("并不是先有的规范再有的Node")]),t._v("：虽然"),a("code",[t._v("CommonJS")]),t._v("在"),a("code",[t._v("Node")]),t._v("之后产生，但是它对"),a("code",[t._v("Node")]),t._v("后续发展影响甚大，所以说"),a("code",[t._v("Node")]),t._v("基于"),a("code",[t._v("CommonJS")]),t._v("只是强调了"),a("code",[t._v("CommonJS")]),t._v("的重要性，而不是时间上的具体区分")],1),t._v(" "),a("li",[a("font",{attrs:{color:"#CC99CD"}},[t._v("Node并不支持所有CommonJS规范")]),t._v("："),a("code",[t._v("CommonJS")]),t._v("是一个很大的项目，里面制定了一系列的规范，"),a("code",[t._v("Node")]),t._v("并没有在所有方面都依赖"),a("code",[t._v("CommonJS")]),t._v("，只是在模块方面遵循了"),a("code",[t._v("CommonJS")]),t._v("当中的模块规范")],1)]),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("② CommonJS和Node.js的区别")])])],1),t._v(" "),a("p",[a("code",[t._v("CommonJS")]),t._v("和"),a("code",[t._v("Node.js")]),t._v("的区别主要体现在"),a("code",[t._v("module.exports")]),t._v("对象的具体实现上")]),t._v(" "),a("ul",[a("li",[t._v("原生"),a("code",[t._v("Node.js")]),t._v("当中，"),a("code",[t._v("module.exports")]),t._v("是真正的特殊对象，也是真正的对外暴露接口，在"),a("code",[t._v("CommonJS")]),t._v("没有出现以前，也没有"),a("code",[t._v("exports")]),t._v("这种东西")]),t._v(" "),a("li",[t._v("在"),a("code",[t._v("CommonJS")]),t._v("规范当中,规定"),a("code",[t._v("exports")]),t._v("对象是暴露接口的对象，所以"),a("code",[t._v("Node")]),t._v("为了遵循规定但是又不修改自身"),a("code",[t._v("module.exports")]),t._v("的基础上，额外增加了将"),a("code",[t._v("exports")]),t._v("关键字绑定到了"),a("code",[t._v("module.exports")]),t._v("对象上的默认操作，说白了就"),a("code",[t._v("exports")]),t._v("默认指向了"),a("code",[t._v("module.exports")]),t._v("导出的对象。这就是为什么"),a("code",[t._v("Node")]),t._v("在包装模块的时候将"),a("code",[t._v("exports")]),t._v("作为参数的原因，默认将规范添加了进来。")]),t._v(" "),a("li",[t._v("两者同时存在时，以"),a("code",[t._v("module.exports")]),t._v("为准，因为"),a("code",[t._v("module.exports")]),t._v("的实际含义是一个完全预先构造的对象，但是"),a("code",[t._v("exports")]),t._v("可以手动被我们篡改指向，这就是很多讲师在给"),a("code",[t._v("Node")]),t._v("初学者解释两者区别最常用的一句话："),a("font",{attrs:{color:"#CC99CD"}},[t._v("exports在没有改变指向的时候是module.exports的代替品")]),t._v(" ，这句话是没有错的，但是我想你听了我上面的解释，你一定会有更深刻的理解。")],1)]),t._v(" "),a("h2",{attrs:{id:"核心"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心","aria-hidden":"true"}},[t._v("#")]),t._v(" 核心")]),t._v(" "),a("p",[a("code",[t._v("Node.js")]),t._v("对模块定义的非常简单，主要分为"),a("font",{attrs:{color:"#CC99CD"}},[t._v("模块引用")]),t._v("、"),a("font",{attrs:{color:"#CC99CD"}},[t._v("模块定义")]),t._v("、"),a("font",{attrs:{color:"#CC99CD"}},[t._v("模块标识")]),t._v("，其中最常用的模块处理命令就有两个："),a("font",{attrs:{color:"#CC99CD"}},[t._v("require")]),t._v("和"),a("font",{attrs:{color:"#CC99CD"}},[t._v("exports")])],1),t._v(" "),a("h3",{attrs:{id:"_1-模块的导入和导出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-模块的导入和导出","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 模块的导入和导出")]),t._v(" "),a("p",[a("font",{attrs:{color:"#CC99CD"}},[t._v("模块可以理解为将能够完成实现一个独立功能的代码封装到一个代码单元当中")]),t._v("，在"),a("code",[t._v("Node")]),t._v("中创建一个模块可以理解为把全部和此功能关联的函数放在一个文件当中。")],1),t._v(" "),a("p",[t._v("我们之前就说"),a("font",{attrs:{color:"#CC99CD"}},[t._v("exports默认情况下是module.exports的引用")]),t._v("，所以使用方面只有更方便的说法，没有对错和性能方面的区分")],1),t._v(" "),a("ul",[a("li",[a("p",[t._v("当我们编写对外暴露对个"),a("code",[t._v("API")]),t._v("的工具我们可以使用"),a("code",[t._v("exports")]),t._v("更方便：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// exports的写法")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("sub")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 外部引用和使用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" add "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./xxx.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// module.exports的写法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sub")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" add"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sub "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 外部引用和使用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./xxx.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("这种情况下使用"),a("code",[t._v("exports")]),t._v("更方便，因为代码少，好理解，更重要的是外部调用很方便")])]),t._v(" "),a("li",[a("p",[t._v("当我们编写同一个对象的时候使用"),a("code",[t._v("module.exports")]),t._v("更方便：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Student")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" name\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("study")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'I have finished my homework'")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Student")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'小明'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("这种情况下不得不依赖"),a("code",[t._v("module.exports")]),t._v("，因为是输出一个整体的对象。")])])]),t._v(" "),a("h3",{attrs:{id:"_2-模块间的循环引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-模块间的循环引用","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 模块间的循环引用")]),t._v(" "),a("p",[t._v("不管在"),a("code",[t._v("Node")]),t._v("当中还是别的地方，模块之间都会相互引用，官网称之为"),a("code",[t._v("module cycles")]),t._v("，翻译成为模块间的循环引用")]),t._v(" "),a("p",[t._v("而在"),a("code",[t._v("CommonJS Moudules1.0")]),t._v("当中有说明，"),a("font",{attrs:{color:"#CC99CD"}},[t._v("在这种情况下，require返回的对象必须至少包含此外部模块在调用require函数之前就已经准备完毕的输出")]),t._v("，这种解决模块间的循环引用的策略称为"),a("font",{attrs:{color:"#CC99CD"}},[t._v("模块缓存策略")])],1),t._v(" "),a("p",[t._v("上述策略的意图也很简单，就是说"),a("code",[t._v("a.js")]),t._v("引用的其他模块"),a("code",[t._v("b.js")]),t._v("和"),a("code",[t._v("c.js")]),t._v("，这两者就相当于包含在"),a("code",[t._v("a.js")]),t._v("的外部模块，那么"),a("code",[t._v("require('a.js')")]),t._v("的时候一定会先运行"),a("code",[t._v("b.js")]),t._v("和"),a("code",[t._v("c.js")]),t._v("，光运行也不行，在"),a("code",[t._v("b.js")]),t._v("和"),a("code",[t._v("c.js")]),t._v("当中的"),a("code",[t._v("module.exports")]),t._v("上面必须存在有效的输出，才叫做准备完毕的输出。")]),t._v(" "),a("p",[t._v("我们还要避免的一种写法就是："),a("font",{attrs:{color:"#3eaf7c"}},[t._v("A模块引用了B模块，B模块也引用了A模块")]),t._v("，这种循环引用遵循的规则是这样："),a("font",{attrs:{color:"#CC99CD"}},[t._v("一旦出现某个模块被循环加载，就只输出已经执行的部分，还未执行的部分不会输出")]),t._v("。")],1),t._v(" "),a("h2",{attrs:{id:"拓展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拓展","aria-hidden":"true"}},[t._v("#")]),t._v(" 拓展")]),t._v(" "),a("p",[t._v("实际上，无论什么时候我们在"),a("code",[t._v("Node")]),t._v("当中讲任何知识点都会和前端联系起来，也并不是因为"),a("code",[t._v("Node")]),t._v("本身就是前端的一部分，而是前端在发展的过程当中越来越依赖"),a("code",[t._v("Node")]),t._v("模块。所有由"),a("code",[t._v("CommonJS")]),t._v("规范我们就会拓展前端模块化的东西。我们会简单介绍一下"),a("code",[t._v("AMD")]),t._v("和"),a("code",[t._v("CMD")]),t._v(",重点放在"),a("code",[t._v("ES6")]),t._v("模块以及它和"),a("code",[t._v("CommonJS")]),t._v("规范的对比。")]),t._v(" "),a("h3",{attrs:{id:"_1-amd和require-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-amd和require-js","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. AMD和require.js")]),t._v(" "),a("p",[a("code",[t._v("commonJS")]),t._v("用同步的方式加载模块。在服务端，模块文件都存在本地磁盘，读取非常快，所以这样做不会有问题。但是在浏览器端，限于网络原因，更合理的方案是使用异步加载。")]),t._v(" "),a("p",[a("code",[t._v("AMD")]),t._v("规范采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。这里介绍用"),a("code",[t._v("require.js")]),t._v("实现"),a("code",[t._v("AMD")]),t._v("规范的模块化：用"),a("code",[t._v("require.config()")]),t._v("指定引用路径等，用"),a("code",[t._v("define()")]),t._v("定义模块，用"),a("code",[t._v("require()")]),t._v("加载模块。")]),t._v(" "),a("h3",{attrs:{id:"_2-cmd和sea-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-cmd和sea-js","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. CMD和sea.js")]),t._v(" "),a("p",[a("code",[t._v("CMD")]),t._v("是另一种"),a("code",[t._v("js")]),t._v("模块化方案，它与"),a("code",[t._v("AMD")]),t._v("很类似，不同点在于："),a("code",[t._v("AMD")]),t._v("推崇依赖前置、提前执行，"),a("code",[t._v("CMD")]),t._v("推崇依赖就近、延迟执行。此规范其实是在"),a("code",[t._v("sea.js")]),t._v("推广过程中产生的。")]),t._v(" "),a("h3",{attrs:{id:"_3-es6-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-es6-module","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. ES6 Module")]),t._v(" "),a("p",[a("code",[t._v("ES6")]),t._v("在语言标准的层面上，实现了模块功能，而且实现得相当简单，旨在成为浏览器和服务器通用的模块解决方案。其模块功能主要由两个命令构成："),a("code",[t._v("export")]),t._v("和"),a("code",[t._v("import")]),t._v("。"),a("code",[t._v("export")]),t._v("命令用于规定模块的对外接口，"),a("code",[t._v("import")]),t._v("命令用于输入其他模块提供的功能。"),a("code",[t._v("ES")]),t._v("模块的目标是创建一个同时兼容"),a("code",[t._v("CommonJS")]),t._v("和"),a("code",[t._v("AMD")]),t._v("的格式，使语法更加紧凑，通过编译时加载，在编译的时候就能确认模块之间的关系，比"),a("code",[t._v("CommonJS")]),t._v("模块的加载效率更高。而在异步加载方面和配置模块加载方面，则借鉴"),a("code",[t._v("AMD")]),t._v("规范，执行效率，灵活度都比"),a("code",[t._v("CommonJS")]),t._v("好的多。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** 定义模块 math.js **/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" basicNum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" basicNum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** 引用模块 **/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" basicNum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./math'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ele")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ele"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textContent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" basicNum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("如上例所示，使用"),a("code",[t._v("import")]),t._v("命令的时候，用户需要知道所要加载的变量名或函数名。其实"),a("code",[t._v("ES6")]),t._v("还提供了"),a("code",[t._v("export default")]),t._v("命令，为模块指定默认输出，对应的"),a("code",[t._v("import")]),t._v("语句不需要使用大括号。这也更趋近于"),a("code",[t._v("ADM")]),t._v("的引用写法。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** export default **/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//定义输出")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" basicNum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//引入")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" math "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./math'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ele")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ele"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textContent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("basicNum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("ES6")]),t._v("的模块不是对象，"),a("code",[t._v("import")]),t._v("命令会被"),a("code",[t._v("JavaScript")]),t._v("引擎静态分析，在编译时就引入模块代码，而不是在代码运行时加载，所以无法实现条件加载。也正因为这个，使得静态分析成为可能。")]),t._v(" "),a("h3",{attrs:{id:"_4-es6-模块与-commonjs-模块的差异"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-es6-模块与-commonjs-模块的差异","aria-hidden":"true"}},[t._v("#")]),t._v(" 4. ES6 模块与 CommonJS 模块的差异")]),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("① CommonJS 模块输出的是一个值的拷贝，ES6 模块输出的是值的引用。")])])],1),t._v(" "),a("ul",[a("li",[a("code",[t._v("CommonJS")]),t._v("模块输出的是值的拷贝，也就是说，一旦输出一个值，模块内部的变化就影响不到这个值。")]),t._v(" "),a("li",[a("code",[t._v("ES6")]),t._v("模块的运行机制与"),a("code",[t._v("CommonJS")]),t._v("不一样。"),a("code",[t._v("JS")]),t._v("引擎对脚本静态分析的时候，遇到模块加载命令"),a("code",[t._v("import")]),t._v("，就会生成一个只读引用。等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里面去取值。换句话说，"),a("code",[t._v("ES6")]),t._v("的"),a("code",[t._v("import")]),t._v("有点像"),a("code",[t._v("Unix")]),t._v("系统的“符号连接”，原始值变了，"),a("code",[t._v("import")]),t._v("加载的值也会跟着变。因此，"),a("code",[t._v("ES6")]),t._v(" 模块是动态引用，并且不会缓存值，模块里面的变量绑定其所在的模块。")])]),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("② CommonJS模块是运行时加载，ES6模块是编译时输出接口")])])],1),t._v(" "),a("ul",[a("li",[t._v("运行时加载: "),a("code",[t._v("CommonJS")]),t._v("模块就是对象；即在输入时是先加载整个模块，生成一个对象，然后再从这个对象上面读取方法，这种加载称为“运行时加载”。")]),t._v(" "),a("li",[t._v("编译时加载: "),a("code",[t._v("ES6")]),t._v("模块不是对象，而是通过"),a("code",[t._v("export")]),t._v("命令显式指定输出的代码，"),a("code",[t._v("import")]),t._v("时采用静态命令的形式。即在"),a("code",[t._v("import")]),t._v("时可以指定加载某个输出值，而不是加载整个模块，这种加载称为“编译时加载”。")])]),t._v(" "),a("p",[t._v("上述说了这么多，我们还是要真正来总结一下整个流程:")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("CommonJS")]),t._v("加载的是一个对象（即module.exports属性），该对象只有在脚本运行完才会生成,流程如下：")]),t._v(" "),a("ul",[a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("本部模块（简称a）在运行时加载外部模块（简称b）")]),t._v("（"),a("font",{attrs:{color:"#CC99CD"}},[t._v("重点")]),t._v("）")],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("外部模块（b）整体被运行，通过exports生成最终对象，同时还被缓存")]),t._v("（"),a("font",{attrs:{color:"#b14"}},[t._v("Node通过require函数加载外部模块的过程我们会在下一小节详细说明")]),t._v("）")],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("本部模块（a）加载完毕外部模块（b）后拷贝外部模块（b）生成的最终对象")]),t._v("（"),a("font",{attrs:{color:"#CC99CD"}},[t._v("重点")]),t._v("）")],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("导致本部模块（a）中的require函数执行完最终获得的是一个值拷贝")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("这个值拷贝表现在栈中就是一个变量的值是一个值类型")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("而这个值类型也要分普通值类型和引用值类型，下面给出不同类型时的表现")])],1)]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*************** a.js**********************/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// count是个普通值")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出值（值得类型时普通值）的拷贝")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这里改变count值，并不会将module.exports对象的count属性值改变")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*************** b.js**********************/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*************** c.js**********************/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0")]),t._v("\nobj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n")])])]),a("p",[t._v("有些小伙伴会疑惑为啥不同的引用写法会造成不同，"),a("code",[t._v("c.js")]),t._v("很好理解，因为"),a("code",[t._v("obj")]),t._v("这个变量存的和"),a("code",[t._v("a.js")]),t._v("导出对象一样的堆中地址，所以操作是相互影响的，但是"),a("code",[t._v("b.js")]),t._v("这种解构写法类似于下面这样：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" add "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0")]),t._v("\n")])])]),a("p",[t._v("显然这里"),a("code",[t._v("count")]),t._v("虽然和"),a("code",[t._v("obj.count")]),t._v("的值一样，但是"),a("code",[t._v("add")]),t._v("操作的是"),a("code",[t._v("obj")]),t._v("里面的"),a("code",[t._v("count")]),t._v(",外面的"),a("code",[t._v("count")]),t._v("是不会受影响的。那我们再来看一个例子：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*************** a.js**********************/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// count是个引用值类型")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" count  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出值（值得类型是引用值）的拷贝")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("num"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里改变count中属性值，会将module.exports对象的count属性改变")]),t._v("\n    count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里改变了引用也不会改变已经导出出的那个count的引用值")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*************** b.js**********************/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//{ num: 0 }")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//{ num: 1 }")]),t._v("\n")])])]),a("ul",[a("li",[t._v("上述第二种情况可能会让你感到疑惑，你不是说值得拷贝么，一旦输出一个值，模块内部的变化就影响不到这个值么？怎么代码表现出来是会影响呢？我们来看一张图就明白了\n"),a("img",{attrs:{src:t.$withBase("/node_commonjs_esmodule.png"),alt:"CommonJS规范"}})]),t._v(" "),a("li",[t._v("虽然"),a("code",[t._v("count")]),t._v("是一个引用，但是"),a("code",[t._v("0x005")]),t._v("这地址本身就是个普通值，所以拷贝到"),a("code",[t._v("b.js")]),t._v("当中依旧是"),a("code",[t._v("0x005")]),t._v("这个普通值，只不过两个"),a("code",[t._v("0x005")]),t._v("指向堆中相同的内存，就好比两把钥匙能开同一扇们一样,所以"),a("font",{attrs:{color:"#CC99CD"}},[t._v("值得拷贝")]),t._v("这句话没有错")],1),t._v(" "),a("li",[t._v("外部模块"),a("code",[t._v("a.js")]),t._v("中的"),a("code",[t._v("count = {}")]),t._v("表示外部模块当中的变化，由"),a("code",[t._v("0x005")]),t._v("变成了"),a("code",[t._v("0x006")]),t._v("，但是也没有影响到在"),a("code",[t._v("b.js")]),t._v("当中缓存值"),a("code",[t._v("count")]),t._v("的指向，这个缓存值依旧是"),a("code",[t._v("0x005")]),t._v(",所以 "),a("font",{attrs:{color:"#CC99CD"}},[t._v("一旦输出一个值，模块内部的变化就影响不到这个值")]),t._v(" 这句话也没有问题。")],1)])]),t._v(" "),a("li",[a("p",[t._v("而"),a("code",[t._v("ES6")]),t._v("模块不是对象，它的对外接口只是一种静态定义，在代码静态解析阶段就会生成。")]),t._v(" "),a("ul",[a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("本部模块（简称a）在编译的时候加载外部模块（简称b）")]),t._v(" （"),a("font",{attrs:{color:"#CC99CD"}},[t._v("重点")]),t._v("）")],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("外部模块（b）被加载的时候只会对exports后面的代码整个生成一个只读引用")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("本部模块（a）加载完毕外部模块（b）后，import获得就是一个引用")]),t._v("（"),a("font",{attrs:{color:"#CC99CD"}},[t._v("重点")]),t._v("）")],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("这个引用在栈中就是一个变量的值是一个堆中的某个地址")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("本部模块（a）在运行的时候就会根据这个引用去堆中找值")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#1E90FF"}},[t._v("所以本部模块（a）import加载的变量会受到外部模块（b）的影响")])],1)]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[t._v("<!DOCTYPE html>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width, initial-scale=1.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("X-UA-Compatible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ie=edge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Document"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("你好ES6"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("vender/b.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*************** a.js**********************/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//输出的是值的引用，指向同一块内存")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//此时引用指向的内存值发生改变")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*************** b.js**********************/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./a.js'")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1")]),t._v("\n")])])]),a("p",[t._v("上述的例子必须要通过建立服务器来测试，我们可以全局下载"),a("code",[t._v("http-server")]),t._v("然后来启动"),a("code",[t._v("index.html")]),t._v("，同时注意："),a("font",{attrs:{color:"#3eaf7c"}},[t._v('在script标签中必须使用 type="module"才能使用ES6模块语法')]),t._v("，然后通过"),a("code",[t._v("http-server index.html")]),t._v("来进行测试")],1)])]),t._v(" "),a("p",[a("strong",[t._v("参考文章")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://juejin.im/post/5aaa37c8f265da23945f365c#heading-5",target:"_blank",rel:"noopener noreferrer"}},[t._v("前端模块化：CommonJS,AMD,CMD,ES6"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.im/post/5ae04fba6fb9a07acb3c8ac5",target:"_blank",rel:"noopener noreferrer"}},[t._v("CommonJs 和 ESModule 的 区别整理"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/108",target:"_blank",rel:"noopener noreferrer"}},[t._v("ES6系列之模块加载规范"),a("OutboundLink")],1)])])])},[],!1,null,null,null);s.default=e.exports}}]);