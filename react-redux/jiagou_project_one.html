<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端架构设计 | TaoPoppy</title>
    <meta name="description" content="陶振川">
    <link rel="icon" href="/meta.png">
    
    <link rel="preload" href="/assets/css/0.styles.32e41c9b.css" as="style"><link rel="preload" href="/assets/js/app.1a394514.js" as="script"><link rel="preload" href="/assets/js/2.8304a06b.js" as="script"><link rel="preload" href="/assets/js/253.374cc99e.js" as="script"><link rel="prefetch" href="/assets/js/10.7aef26de.js"><link rel="prefetch" href="/assets/js/100.b6a5dbe3.js"><link rel="prefetch" href="/assets/js/101.4cf14517.js"><link rel="prefetch" href="/assets/js/102.a10509c8.js"><link rel="prefetch" href="/assets/js/103.725c83f9.js"><link rel="prefetch" href="/assets/js/104.4cf52e25.js"><link rel="prefetch" href="/assets/js/105.fa93d42c.js"><link rel="prefetch" href="/assets/js/106.bc4f6131.js"><link rel="prefetch" href="/assets/js/107.720518ec.js"><link rel="prefetch" href="/assets/js/108.73134973.js"><link rel="prefetch" href="/assets/js/109.074b05fb.js"><link rel="prefetch" href="/assets/js/11.0781fb51.js"><link rel="prefetch" href="/assets/js/110.fa287650.js"><link rel="prefetch" href="/assets/js/111.66cf0003.js"><link rel="prefetch" href="/assets/js/112.ec18ad13.js"><link rel="prefetch" href="/assets/js/113.45a7c13a.js"><link rel="prefetch" href="/assets/js/114.8ac723f2.js"><link rel="prefetch" href="/assets/js/115.519d8940.js"><link rel="prefetch" href="/assets/js/116.c52bde55.js"><link rel="prefetch" href="/assets/js/117.35c583ff.js"><link rel="prefetch" href="/assets/js/118.6b209cf4.js"><link rel="prefetch" href="/assets/js/119.a3bd3fcb.js"><link rel="prefetch" href="/assets/js/12.75f1c153.js"><link rel="prefetch" href="/assets/js/120.45c18f2c.js"><link rel="prefetch" href="/assets/js/121.f1335403.js"><link rel="prefetch" href="/assets/js/122.4ddc6efe.js"><link rel="prefetch" href="/assets/js/123.3fedcfb9.js"><link rel="prefetch" href="/assets/js/124.57c3d5fd.js"><link rel="prefetch" href="/assets/js/125.98bb56f7.js"><link rel="prefetch" href="/assets/js/126.b4e3e7bc.js"><link rel="prefetch" href="/assets/js/127.aa4e7f95.js"><link rel="prefetch" href="/assets/js/128.08be9111.js"><link rel="prefetch" href="/assets/js/129.c32609eb.js"><link rel="prefetch" href="/assets/js/13.a3141dde.js"><link rel="prefetch" href="/assets/js/130.a0c93b04.js"><link rel="prefetch" href="/assets/js/131.dfae9fea.js"><link rel="prefetch" href="/assets/js/132.74845e19.js"><link rel="prefetch" href="/assets/js/133.cb7fc263.js"><link rel="prefetch" href="/assets/js/134.f9ae184c.js"><link rel="prefetch" href="/assets/js/135.273e7372.js"><link rel="prefetch" href="/assets/js/136.1da93b8e.js"><link rel="prefetch" href="/assets/js/137.198dbe16.js"><link rel="prefetch" href="/assets/js/138.64fac690.js"><link rel="prefetch" href="/assets/js/139.ac7f9fdf.js"><link rel="prefetch" href="/assets/js/14.023d10f2.js"><link rel="prefetch" href="/assets/js/140.a6685c82.js"><link rel="prefetch" href="/assets/js/141.96f04b23.js"><link rel="prefetch" href="/assets/js/142.cc5f5520.js"><link rel="prefetch" href="/assets/js/143.9b28c5f0.js"><link rel="prefetch" href="/assets/js/144.b0527ead.js"><link rel="prefetch" href="/assets/js/145.dad8d1ad.js"><link rel="prefetch" href="/assets/js/146.37619b4e.js"><link rel="prefetch" href="/assets/js/147.51353321.js"><link rel="prefetch" href="/assets/js/148.b7dbbadc.js"><link rel="prefetch" href="/assets/js/149.01c189f9.js"><link rel="prefetch" href="/assets/js/15.1ead8c76.js"><link rel="prefetch" href="/assets/js/150.6999137d.js"><link rel="prefetch" href="/assets/js/151.36a45175.js"><link rel="prefetch" href="/assets/js/152.f4c8c0a3.js"><link rel="prefetch" href="/assets/js/153.f04f1cfa.js"><link rel="prefetch" href="/assets/js/154.11f667b0.js"><link rel="prefetch" href="/assets/js/155.3df246f1.js"><link rel="prefetch" href="/assets/js/156.95c2a81f.js"><link rel="prefetch" href="/assets/js/157.4c4e453a.js"><link rel="prefetch" href="/assets/js/158.ea143735.js"><link rel="prefetch" href="/assets/js/159.1851c143.js"><link rel="prefetch" href="/assets/js/16.588b8a18.js"><link rel="prefetch" href="/assets/js/160.8623fd27.js"><link rel="prefetch" href="/assets/js/161.9f3dde39.js"><link rel="prefetch" href="/assets/js/162.ec8ada30.js"><link rel="prefetch" href="/assets/js/163.578cd511.js"><link rel="prefetch" href="/assets/js/164.5f326c38.js"><link rel="prefetch" href="/assets/js/165.d6055e4f.js"><link rel="prefetch" href="/assets/js/166.a4b38932.js"><link rel="prefetch" href="/assets/js/167.6a25e6a6.js"><link rel="prefetch" href="/assets/js/168.11291db9.js"><link rel="prefetch" href="/assets/js/169.3a6aec97.js"><link rel="prefetch" href="/assets/js/17.dbb0117f.js"><link rel="prefetch" href="/assets/js/170.c1b92e05.js"><link rel="prefetch" href="/assets/js/171.f06cccdb.js"><link rel="prefetch" href="/assets/js/172.26661658.js"><link rel="prefetch" href="/assets/js/173.ce718757.js"><link rel="prefetch" href="/assets/js/174.425859ee.js"><link rel="prefetch" href="/assets/js/175.b334be38.js"><link rel="prefetch" href="/assets/js/176.d29c1ef4.js"><link rel="prefetch" href="/assets/js/177.61e20b4a.js"><link rel="prefetch" href="/assets/js/178.f79fe9c5.js"><link rel="prefetch" href="/assets/js/179.8ab2f01b.js"><link rel="prefetch" href="/assets/js/18.5178d2f1.js"><link rel="prefetch" href="/assets/js/180.e1f584e7.js"><link rel="prefetch" href="/assets/js/181.384f8b65.js"><link rel="prefetch" href="/assets/js/182.675d4534.js"><link rel="prefetch" href="/assets/js/183.a5314419.js"><link rel="prefetch" href="/assets/js/184.49a4f95b.js"><link rel="prefetch" href="/assets/js/185.39566276.js"><link rel="prefetch" href="/assets/js/186.faf772f8.js"><link rel="prefetch" href="/assets/js/187.5e40a002.js"><link rel="prefetch" href="/assets/js/188.e9a85c75.js"><link rel="prefetch" href="/assets/js/189.4f6300fd.js"><link rel="prefetch" href="/assets/js/19.a3a8a3b2.js"><link rel="prefetch" href="/assets/js/190.5395a82d.js"><link rel="prefetch" href="/assets/js/191.c37e69d9.js"><link rel="prefetch" href="/assets/js/192.49c5336c.js"><link rel="prefetch" href="/assets/js/193.8358c1f7.js"><link rel="prefetch" href="/assets/js/194.f3baad75.js"><link rel="prefetch" href="/assets/js/195.9b64acde.js"><link rel="prefetch" href="/assets/js/196.af79cfd2.js"><link rel="prefetch" href="/assets/js/197.83502b3c.js"><link rel="prefetch" href="/assets/js/198.79a30060.js"><link rel="prefetch" href="/assets/js/199.4a4580d8.js"><link rel="prefetch" href="/assets/js/20.f7956ee9.js"><link rel="prefetch" href="/assets/js/200.ea5edefe.js"><link rel="prefetch" href="/assets/js/201.ba9f6baf.js"><link rel="prefetch" href="/assets/js/202.a684e81a.js"><link rel="prefetch" href="/assets/js/203.f6ae36b1.js"><link rel="prefetch" href="/assets/js/204.1b7d15f6.js"><link rel="prefetch" href="/assets/js/205.886aa300.js"><link rel="prefetch" href="/assets/js/206.4c920afb.js"><link rel="prefetch" href="/assets/js/207.84ff34f5.js"><link rel="prefetch" href="/assets/js/208.869b1786.js"><link rel="prefetch" href="/assets/js/209.46e7bcd8.js"><link rel="prefetch" href="/assets/js/21.a7419b80.js"><link rel="prefetch" href="/assets/js/210.8ae86200.js"><link rel="prefetch" href="/assets/js/211.8f174712.js"><link rel="prefetch" href="/assets/js/212.13a1cfde.js"><link rel="prefetch" href="/assets/js/213.2623c8b3.js"><link rel="prefetch" href="/assets/js/214.5f6c13ce.js"><link rel="prefetch" href="/assets/js/215.239ee6c0.js"><link rel="prefetch" href="/assets/js/216.bb2ce7ff.js"><link rel="prefetch" href="/assets/js/217.0708a1bc.js"><link rel="prefetch" href="/assets/js/218.9b44a3a0.js"><link rel="prefetch" href="/assets/js/219.872ef7dc.js"><link rel="prefetch" href="/assets/js/22.c95b31e3.js"><link rel="prefetch" href="/assets/js/220.d16ceb67.js"><link rel="prefetch" href="/assets/js/221.405b655a.js"><link rel="prefetch" href="/assets/js/222.fcbd0075.js"><link rel="prefetch" href="/assets/js/223.e48f31f2.js"><link rel="prefetch" href="/assets/js/224.f5562fa5.js"><link rel="prefetch" href="/assets/js/225.4c58f939.js"><link rel="prefetch" href="/assets/js/226.84e6ccf6.js"><link rel="prefetch" href="/assets/js/227.307e3114.js"><link rel="prefetch" href="/assets/js/228.f4bc2989.js"><link rel="prefetch" href="/assets/js/229.96ea2ba2.js"><link rel="prefetch" href="/assets/js/23.a75f3ddc.js"><link rel="prefetch" href="/assets/js/230.2ae85257.js"><link rel="prefetch" href="/assets/js/231.78d7510d.js"><link rel="prefetch" href="/assets/js/232.f5bf4f67.js"><link rel="prefetch" href="/assets/js/233.9102fdaa.js"><link rel="prefetch" href="/assets/js/234.a9e5e11a.js"><link rel="prefetch" href="/assets/js/235.71426295.js"><link rel="prefetch" href="/assets/js/236.03474465.js"><link rel="prefetch" href="/assets/js/237.48aed7b3.js"><link rel="prefetch" href="/assets/js/238.6a271b50.js"><link rel="prefetch" href="/assets/js/239.28d2a86b.js"><link rel="prefetch" href="/assets/js/24.84641855.js"><link rel="prefetch" href="/assets/js/240.22bca10d.js"><link rel="prefetch" href="/assets/js/241.2a279198.js"><link rel="prefetch" href="/assets/js/242.43b24484.js"><link rel="prefetch" href="/assets/js/243.fe9d5ea9.js"><link rel="prefetch" href="/assets/js/244.d39e950f.js"><link rel="prefetch" href="/assets/js/245.64db6d12.js"><link rel="prefetch" href="/assets/js/246.5b1f1745.js"><link rel="prefetch" href="/assets/js/247.d1ab0e2b.js"><link rel="prefetch" href="/assets/js/248.a19e36bd.js"><link rel="prefetch" href="/assets/js/249.3aa723c7.js"><link rel="prefetch" href="/assets/js/25.73570942.js"><link rel="prefetch" href="/assets/js/250.0f968bec.js"><link rel="prefetch" href="/assets/js/251.9ade3872.js"><link rel="prefetch" href="/assets/js/252.72e1aa12.js"><link rel="prefetch" href="/assets/js/254.44800bf9.js"><link rel="prefetch" href="/assets/js/255.06241cb8.js"><link rel="prefetch" href="/assets/js/256.bbeaafaa.js"><link rel="prefetch" href="/assets/js/257.14e8b661.js"><link rel="prefetch" href="/assets/js/258.0913e120.js"><link rel="prefetch" href="/assets/js/259.32bd3bf9.js"><link rel="prefetch" href="/assets/js/26.9a79c041.js"><link rel="prefetch" href="/assets/js/260.e5a40c02.js"><link rel="prefetch" href="/assets/js/261.4c8be7b1.js"><link rel="prefetch" href="/assets/js/262.0663f55e.js"><link rel="prefetch" href="/assets/js/263.cecc1123.js"><link rel="prefetch" href="/assets/js/264.d2209296.js"><link rel="prefetch" href="/assets/js/265.497bc01b.js"><link rel="prefetch" href="/assets/js/266.769ac5e0.js"><link rel="prefetch" href="/assets/js/267.6b97962f.js"><link rel="prefetch" href="/assets/js/268.fa6635c8.js"><link rel="prefetch" href="/assets/js/269.c1e74469.js"><link rel="prefetch" href="/assets/js/27.0dd62438.js"><link rel="prefetch" href="/assets/js/270.4e8f8d77.js"><link rel="prefetch" href="/assets/js/271.f27f2f56.js"><link rel="prefetch" href="/assets/js/272.d1349876.js"><link rel="prefetch" href="/assets/js/273.e967ea79.js"><link rel="prefetch" href="/assets/js/274.7c9df4ce.js"><link rel="prefetch" href="/assets/js/275.5b85e62c.js"><link rel="prefetch" href="/assets/js/276.c09ef549.js"><link rel="prefetch" href="/assets/js/277.58b59a93.js"><link rel="prefetch" href="/assets/js/278.e91f9b01.js"><link rel="prefetch" href="/assets/js/279.3159509a.js"><link rel="prefetch" href="/assets/js/28.685ccac3.js"><link rel="prefetch" href="/assets/js/280.8878bc0d.js"><link rel="prefetch" href="/assets/js/281.c7e08ecb.js"><link rel="prefetch" href="/assets/js/282.85066f7c.js"><link rel="prefetch" href="/assets/js/283.80120ef1.js"><link rel="prefetch" href="/assets/js/284.1f719606.js"><link rel="prefetch" href="/assets/js/285.b4a3cea5.js"><link rel="prefetch" href="/assets/js/286.2ebd0b34.js"><link rel="prefetch" href="/assets/js/287.8e141966.js"><link rel="prefetch" href="/assets/js/288.ea2f74f5.js"><link rel="prefetch" href="/assets/js/289.beba8c8e.js"><link rel="prefetch" href="/assets/js/29.d9a2cd59.js"><link rel="prefetch" href="/assets/js/290.fd587ae1.js"><link rel="prefetch" href="/assets/js/291.e0b87667.js"><link rel="prefetch" href="/assets/js/292.d86d8fa2.js"><link rel="prefetch" href="/assets/js/293.f176a900.js"><link rel="prefetch" href="/assets/js/294.536a81c8.js"><link rel="prefetch" href="/assets/js/295.54f88831.js"><link rel="prefetch" href="/assets/js/296.7c5ad5dd.js"><link rel="prefetch" href="/assets/js/297.cf9a4601.js"><link rel="prefetch" href="/assets/js/298.a844a174.js"><link rel="prefetch" href="/assets/js/299.809942fc.js"><link rel="prefetch" href="/assets/js/3.5dd59f66.js"><link rel="prefetch" href="/assets/js/30.1ca80117.js"><link rel="prefetch" href="/assets/js/300.bc9809ff.js"><link rel="prefetch" href="/assets/js/301.d677b5b5.js"><link rel="prefetch" href="/assets/js/302.aa40279f.js"><link rel="prefetch" href="/assets/js/303.070e632e.js"><link rel="prefetch" href="/assets/js/304.3d695df8.js"><link rel="prefetch" href="/assets/js/305.44e261e9.js"><link rel="prefetch" href="/assets/js/306.e2f7ad64.js"><link rel="prefetch" href="/assets/js/307.83982154.js"><link rel="prefetch" href="/assets/js/308.4db5bbe7.js"><link rel="prefetch" href="/assets/js/309.3aa975c1.js"><link rel="prefetch" href="/assets/js/31.440aa4c9.js"><link rel="prefetch" href="/assets/js/310.614e3c2f.js"><link rel="prefetch" href="/assets/js/311.ebda45a9.js"><link rel="prefetch" href="/assets/js/312.52cdf585.js"><link rel="prefetch" href="/assets/js/313.1f984642.js"><link rel="prefetch" href="/assets/js/314.fd4722eb.js"><link rel="prefetch" href="/assets/js/315.14d7045f.js"><link rel="prefetch" href="/assets/js/316.8f4cc226.js"><link rel="prefetch" href="/assets/js/317.21630e12.js"><link rel="prefetch" href="/assets/js/318.9a5c960e.js"><link rel="prefetch" href="/assets/js/319.06f7dacf.js"><link rel="prefetch" href="/assets/js/32.27f34442.js"><link rel="prefetch" href="/assets/js/320.e426fea5.js"><link rel="prefetch" href="/assets/js/321.46a426b9.js"><link rel="prefetch" href="/assets/js/322.7256b9c8.js"><link rel="prefetch" href="/assets/js/323.5b848b7f.js"><link rel="prefetch" href="/assets/js/324.e8eedaac.js"><link rel="prefetch" href="/assets/js/325.54947978.js"><link rel="prefetch" href="/assets/js/326.03bfd5b9.js"><link rel="prefetch" href="/assets/js/327.34a2ec4d.js"><link rel="prefetch" href="/assets/js/328.4e023633.js"><link rel="prefetch" href="/assets/js/329.b218e68f.js"><link rel="prefetch" href="/assets/js/33.f6658b03.js"><link rel="prefetch" href="/assets/js/330.a8a2750a.js"><link rel="prefetch" href="/assets/js/331.0df9ca3a.js"><link rel="prefetch" href="/assets/js/332.95c19161.js"><link rel="prefetch" href="/assets/js/333.c6e765b9.js"><link rel="prefetch" href="/assets/js/334.c79e3b52.js"><link rel="prefetch" href="/assets/js/335.49fcd3ab.js"><link rel="prefetch" href="/assets/js/336.5c2ccd1d.js"><link rel="prefetch" href="/assets/js/337.fd6692e6.js"><link rel="prefetch" href="/assets/js/338.e0f59f10.js"><link rel="prefetch" href="/assets/js/339.04196614.js"><link rel="prefetch" href="/assets/js/34.17b5b881.js"><link rel="prefetch" href="/assets/js/340.05e21d65.js"><link rel="prefetch" href="/assets/js/341.15ff2a62.js"><link rel="prefetch" href="/assets/js/342.ae7694ad.js"><link rel="prefetch" href="/assets/js/343.f4a5186c.js"><link rel="prefetch" href="/assets/js/344.4caf3fa0.js"><link rel="prefetch" href="/assets/js/345.214e2189.js"><link rel="prefetch" href="/assets/js/346.f613921f.js"><link rel="prefetch" href="/assets/js/347.626136bf.js"><link rel="prefetch" href="/assets/js/348.cf4b86a4.js"><link rel="prefetch" href="/assets/js/349.2a62c487.js"><link rel="prefetch" href="/assets/js/35.e99d5a01.js"><link rel="prefetch" href="/assets/js/350.389648a3.js"><link rel="prefetch" href="/assets/js/351.81305cad.js"><link rel="prefetch" href="/assets/js/352.d7a80ffa.js"><link rel="prefetch" href="/assets/js/353.0929bd7f.js"><link rel="prefetch" href="/assets/js/354.87d7184c.js"><link rel="prefetch" href="/assets/js/355.1dd69433.js"><link rel="prefetch" href="/assets/js/356.b969449b.js"><link rel="prefetch" href="/assets/js/357.16cecac1.js"><link rel="prefetch" href="/assets/js/358.ef6c9df0.js"><link rel="prefetch" href="/assets/js/359.8b33b863.js"><link rel="prefetch" href="/assets/js/36.8e7e289a.js"><link rel="prefetch" href="/assets/js/360.089cc7ad.js"><link rel="prefetch" href="/assets/js/361.9a59c5c5.js"><link rel="prefetch" href="/assets/js/362.a8026d31.js"><link rel="prefetch" href="/assets/js/363.c3bb2718.js"><link rel="prefetch" href="/assets/js/364.62014d33.js"><link rel="prefetch" href="/assets/js/365.00a229da.js"><link rel="prefetch" href="/assets/js/366.5c57901c.js"><link rel="prefetch" href="/assets/js/367.ad1d6755.js"><link rel="prefetch" href="/assets/js/368.64dc7bec.js"><link rel="prefetch" href="/assets/js/369.406cd3d7.js"><link rel="prefetch" href="/assets/js/37.4f733baf.js"><link rel="prefetch" href="/assets/js/370.750f2303.js"><link rel="prefetch" href="/assets/js/371.6cc0e13d.js"><link rel="prefetch" href="/assets/js/372.ed729131.js"><link rel="prefetch" href="/assets/js/373.c369c4c9.js"><link rel="prefetch" href="/assets/js/374.d3a57fb2.js"><link rel="prefetch" href="/assets/js/375.21d68193.js"><link rel="prefetch" href="/assets/js/376.25d9d5f3.js"><link rel="prefetch" href="/assets/js/377.c7ebd0c2.js"><link rel="prefetch" href="/assets/js/378.c733ec30.js"><link rel="prefetch" href="/assets/js/379.d6cf1c34.js"><link rel="prefetch" href="/assets/js/38.86de11d5.js"><link rel="prefetch" href="/assets/js/380.9abd3090.js"><link rel="prefetch" href="/assets/js/381.1fc3ec03.js"><link rel="prefetch" href="/assets/js/382.d0d2e795.js"><link rel="prefetch" href="/assets/js/383.bd308361.js"><link rel="prefetch" href="/assets/js/384.c2a5969a.js"><link rel="prefetch" href="/assets/js/385.20c11f56.js"><link rel="prefetch" href="/assets/js/386.631b9af2.js"><link rel="prefetch" href="/assets/js/387.8f59e0b5.js"><link rel="prefetch" href="/assets/js/388.5b1951cd.js"><link rel="prefetch" href="/assets/js/389.2e942f96.js"><link rel="prefetch" href="/assets/js/39.153b6ec6.js"><link rel="prefetch" href="/assets/js/390.341a807c.js"><link rel="prefetch" href="/assets/js/391.c9bd676c.js"><link rel="prefetch" href="/assets/js/392.ac05ebea.js"><link rel="prefetch" href="/assets/js/393.6989a857.js"><link rel="prefetch" href="/assets/js/394.744402ae.js"><link rel="prefetch" href="/assets/js/395.a0636831.js"><link rel="prefetch" href="/assets/js/396.9e92309a.js"><link rel="prefetch" href="/assets/js/397.867afb5d.js"><link rel="prefetch" href="/assets/js/398.261fe9bc.js"><link rel="prefetch" href="/assets/js/399.83573ac7.js"><link rel="prefetch" href="/assets/js/4.1b11a2b1.js"><link rel="prefetch" href="/assets/js/40.77cd485e.js"><link rel="prefetch" href="/assets/js/400.333909ad.js"><link rel="prefetch" href="/assets/js/401.9c9ae0ae.js"><link rel="prefetch" href="/assets/js/402.50b49502.js"><link rel="prefetch" href="/assets/js/403.c0d1aa14.js"><link rel="prefetch" href="/assets/js/404.24e4f5ba.js"><link rel="prefetch" href="/assets/js/405.09e8422c.js"><link rel="prefetch" href="/assets/js/406.1e91805d.js"><link rel="prefetch" href="/assets/js/407.2393ac65.js"><link rel="prefetch" href="/assets/js/408.e0df89f7.js"><link rel="prefetch" href="/assets/js/409.58e7dc26.js"><link rel="prefetch" href="/assets/js/41.67fda662.js"><link rel="prefetch" href="/assets/js/410.e9c06b6a.js"><link rel="prefetch" href="/assets/js/411.bbe28a09.js"><link rel="prefetch" href="/assets/js/412.44a068c9.js"><link rel="prefetch" href="/assets/js/413.b76704b3.js"><link rel="prefetch" href="/assets/js/414.32590ba0.js"><link rel="prefetch" href="/assets/js/415.60884e6d.js"><link rel="prefetch" href="/assets/js/416.119019d8.js"><link rel="prefetch" href="/assets/js/417.277cf86c.js"><link rel="prefetch" href="/assets/js/418.fb313fbc.js"><link rel="prefetch" href="/assets/js/419.3eba15ec.js"><link rel="prefetch" href="/assets/js/42.7e56f2cd.js"><link rel="prefetch" href="/assets/js/420.c6d3f2a0.js"><link rel="prefetch" href="/assets/js/421.0939406a.js"><link rel="prefetch" href="/assets/js/422.f9975cec.js"><link rel="prefetch" href="/assets/js/423.fb455c5f.js"><link rel="prefetch" href="/assets/js/424.01dea30b.js"><link rel="prefetch" href="/assets/js/425.ae78c193.js"><link rel="prefetch" href="/assets/js/426.01ffc131.js"><link rel="prefetch" href="/assets/js/427.ca692320.js"><link rel="prefetch" href="/assets/js/428.db29a47a.js"><link rel="prefetch" href="/assets/js/429.954aaaf1.js"><link rel="prefetch" href="/assets/js/43.d0246dae.js"><link rel="prefetch" href="/assets/js/430.b2c8abce.js"><link rel="prefetch" href="/assets/js/431.238123f0.js"><link rel="prefetch" href="/assets/js/432.459a70b6.js"><link rel="prefetch" href="/assets/js/433.ec112349.js"><link rel="prefetch" href="/assets/js/434.d11bf56d.js"><link rel="prefetch" href="/assets/js/435.98d79cdc.js"><link rel="prefetch" href="/assets/js/436.78b0e462.js"><link rel="prefetch" href="/assets/js/437.17bafd8b.js"><link rel="prefetch" href="/assets/js/438.462d1929.js"><link rel="prefetch" href="/assets/js/439.1f5c292d.js"><link rel="prefetch" href="/assets/js/44.eb3d088f.js"><link rel="prefetch" href="/assets/js/440.b139dc54.js"><link rel="prefetch" href="/assets/js/441.2fae1d62.js"><link rel="prefetch" href="/assets/js/45.39adc1d2.js"><link rel="prefetch" href="/assets/js/46.93061422.js"><link rel="prefetch" href="/assets/js/47.0dc9e596.js"><link rel="prefetch" href="/assets/js/48.68f070d6.js"><link rel="prefetch" href="/assets/js/49.a29d9572.js"><link rel="prefetch" href="/assets/js/5.37e3a575.js"><link rel="prefetch" href="/assets/js/50.0b46a629.js"><link rel="prefetch" href="/assets/js/51.c7712d08.js"><link rel="prefetch" href="/assets/js/52.8fdf333b.js"><link rel="prefetch" href="/assets/js/53.1e5f8a94.js"><link rel="prefetch" href="/assets/js/54.41216d39.js"><link rel="prefetch" href="/assets/js/55.34d14bf4.js"><link rel="prefetch" href="/assets/js/56.b7d3b6ca.js"><link rel="prefetch" href="/assets/js/57.9646b246.js"><link rel="prefetch" href="/assets/js/58.5446709c.js"><link rel="prefetch" href="/assets/js/59.0fac1fa2.js"><link rel="prefetch" href="/assets/js/6.41004de5.js"><link rel="prefetch" href="/assets/js/60.8a2d1be8.js"><link rel="prefetch" href="/assets/js/61.77eca8ce.js"><link rel="prefetch" href="/assets/js/62.277c8f17.js"><link rel="prefetch" href="/assets/js/63.8b203bb2.js"><link rel="prefetch" href="/assets/js/64.d466d2b9.js"><link rel="prefetch" href="/assets/js/65.7c4cb8d5.js"><link rel="prefetch" href="/assets/js/66.71b38fe1.js"><link rel="prefetch" href="/assets/js/67.e0b107a2.js"><link rel="prefetch" href="/assets/js/68.7d64bb4b.js"><link rel="prefetch" href="/assets/js/69.9cdbcfeb.js"><link rel="prefetch" href="/assets/js/7.67d94aac.js"><link rel="prefetch" href="/assets/js/70.eb1c9224.js"><link rel="prefetch" href="/assets/js/71.51e0c37c.js"><link rel="prefetch" href="/assets/js/72.cba6948f.js"><link rel="prefetch" href="/assets/js/73.6abd4dce.js"><link rel="prefetch" href="/assets/js/74.b5fa6c08.js"><link rel="prefetch" href="/assets/js/75.8f34d79a.js"><link rel="prefetch" href="/assets/js/76.5fc9c80d.js"><link rel="prefetch" href="/assets/js/77.6e4a5e93.js"><link rel="prefetch" href="/assets/js/78.bffd6a40.js"><link rel="prefetch" href="/assets/js/79.1a7f5d0e.js"><link rel="prefetch" href="/assets/js/8.e4995b94.js"><link rel="prefetch" href="/assets/js/80.b70c1106.js"><link rel="prefetch" href="/assets/js/81.4476a49e.js"><link rel="prefetch" href="/assets/js/82.f40aa218.js"><link rel="prefetch" href="/assets/js/83.d4c57d4f.js"><link rel="prefetch" href="/assets/js/84.d1dc86f7.js"><link rel="prefetch" href="/assets/js/85.dd779a2e.js"><link rel="prefetch" href="/assets/js/86.569cfbc2.js"><link rel="prefetch" href="/assets/js/87.938a5bd8.js"><link rel="prefetch" href="/assets/js/88.2d3dadd7.js"><link rel="prefetch" href="/assets/js/89.3aeee704.js"><link rel="prefetch" href="/assets/js/9.54a41cce.js"><link rel="prefetch" href="/assets/js/90.2b47965b.js"><link rel="prefetch" href="/assets/js/91.58aa3587.js"><link rel="prefetch" href="/assets/js/92.47d2a191.js"><link rel="prefetch" href="/assets/js/93.ff10ac69.js"><link rel="prefetch" href="/assets/js/94.a8d90c0c.js"><link rel="prefetch" href="/assets/js/95.15ae9c48.js"><link rel="prefetch" href="/assets/js/96.43aa4adb.js"><link rel="prefetch" href="/assets/js/97.4eb74c93.js"><link rel="prefetch" href="/assets/js/98.94686ad8.js"><link rel="prefetch" href="/assets/js/99.ceb4f2f1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.32e41c9b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">TaoPoppy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/learnMaterials/" class="nav-link">资料</a></div><div class="nav-item"><a href="https://github.com/taopoppy/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/construct/" class="nav-link">小技巧</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/WeiXin-Rumen/" class="nav-link">微信小程序入门和实战</a></li><li class="dropdown-item"><!----> <a href="/Weixin-quanzhan/" class="nav-link">微信小程序全栈开发实战</a></li><li class="dropdown-item"><!----> <a href="/WeiXin-Combat/" class="nav-link">微信小程序云开发实战</a></li><li class="dropdown-item"><!----> <a href="/WeiXin-money/" class="nav-link">微信支付和分享</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Jest/" class="nav-link">前端自动化测试</a></li><li class="dropdown-item"><!----> <a href="/Webpack/" class="nav-link">前端工程化</a></li><li class="dropdown-item"><!----> <a href="/Optimization/" class="nav-link">前端性能优化</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Go</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/go/" class="nav-link">go语言入门实践</a></li><li class="dropdown-item"><!----> <a href="/go-concurrent/" class="nav-link">go并发编程详解</a></li><li class="dropdown-item"><!----> <a href="/go-web/" class="nav-link">go与web编程实战</a></li><li class="dropdown-item"><!----> <a href="/go-reptile/" class="nav-link">go爬虫编程实战</a></li><li class="dropdown-item"><!----> <a href="/Beego/" class="nav-link">Beego框架入门</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">node</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">node入门</a></li><li class="dropdown-item"><!----> <a href="/node-RESTful/" class="nav-link">node与RESTful</a></li><li class="dropdown-item"><!----> <a href="/node-GraphQL/" class="nav-link">node与GraphQL</a></li><li class="dropdown-item"><!----> <a href="/node-BFF/" class="nav-link">node与BFF</a></li><li class="dropdown-item"><!----> <a href="/node-blog/" class="nav-link">node博客后台</a></li><li class="dropdown-item"><!----> <a href="/node-weibo/" class="nav-link">node实战微博</a></li><li class="dropdown-item"><!----> <a href="/node-microService/" class="nav-link">node微服务</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">react</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react-redux/" class="nav-link router-link-active">React+Redux入门详解</a></li><li class="dropdown-item"><!----> <a href="/react-typescript/" class="nav-link">React+TypeScript的完美结合</a></li><li class="dropdown-item"><!----> <a href="/react-webapp/" class="nav-link">React网易云Webapp</a></li><li class="dropdown-item"><!----> <a href="/react-ssr/" class="nav-link">React服务器渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/react-source/" class="nav-link">React深度剖析和源码解析</a></li><li class="dropdown-item"><!----> <a href="/react-antd/" class="nav-link">React+Typescript开发组件库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-ssr/" class="nav-link">Vue服务端渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/vue-interview/" class="nav-link">Vue3入门和实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Mysql/" class="nav-link">mysql</a></li><li class="dropdown-subitem"><a href="/Mysql-Architecture/" class="nav-link">mysql-Architecture</a></li></ul></li><li class="dropdown-item"><h4>linux操作系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Linux/" class="nav-link">linux</a></li><li class="dropdown-subitem"><a href="/Linux-Architecture/" class="nav-link">linux-Architecture</a></li></ul></li><li class="dropdown-item"><h4>网络协议</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Protocol/" class="nav-link">protocol</a></li><li class="dropdown-subitem"><a href="/react-redux/font-end-protocol.html" class="nav-link">font-end-protocol</a></li></ul></li><li class="dropdown-item"><h4>运维系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/prometheus/" class="nav-link">prometheus</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end/" class="nav-link">前端初级面试</a></li><li class="dropdown-item"><!----> <a href="/Front-advance/" class="nav-link">前端中级面试</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">究极全栈</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Big-Front-End/" class="nav-link">大前端</a></li><li class="dropdown-item"><!----> <a href="/Web-Architect/" class="nav-link">web架构课</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/learnMaterials/" class="nav-link">资料</a></div><div class="nav-item"><a href="https://github.com/taopoppy/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/construct/" class="nav-link">小技巧</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/WeiXin-Rumen/" class="nav-link">微信小程序入门和实战</a></li><li class="dropdown-item"><!----> <a href="/Weixin-quanzhan/" class="nav-link">微信小程序全栈开发实战</a></li><li class="dropdown-item"><!----> <a href="/WeiXin-Combat/" class="nav-link">微信小程序云开发实战</a></li><li class="dropdown-item"><!----> <a href="/WeiXin-money/" class="nav-link">微信支付和分享</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Jest/" class="nav-link">前端自动化测试</a></li><li class="dropdown-item"><!----> <a href="/Webpack/" class="nav-link">前端工程化</a></li><li class="dropdown-item"><!----> <a href="/Optimization/" class="nav-link">前端性能优化</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Go</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/go/" class="nav-link">go语言入门实践</a></li><li class="dropdown-item"><!----> <a href="/go-concurrent/" class="nav-link">go并发编程详解</a></li><li class="dropdown-item"><!----> <a href="/go-web/" class="nav-link">go与web编程实战</a></li><li class="dropdown-item"><!----> <a href="/go-reptile/" class="nav-link">go爬虫编程实战</a></li><li class="dropdown-item"><!----> <a href="/Beego/" class="nav-link">Beego框架入门</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">node</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">node入门</a></li><li class="dropdown-item"><!----> <a href="/node-RESTful/" class="nav-link">node与RESTful</a></li><li class="dropdown-item"><!----> <a href="/node-GraphQL/" class="nav-link">node与GraphQL</a></li><li class="dropdown-item"><!----> <a href="/node-BFF/" class="nav-link">node与BFF</a></li><li class="dropdown-item"><!----> <a href="/node-blog/" class="nav-link">node博客后台</a></li><li class="dropdown-item"><!----> <a href="/node-weibo/" class="nav-link">node实战微博</a></li><li class="dropdown-item"><!----> <a href="/node-microService/" class="nav-link">node微服务</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">react</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react-redux/" class="nav-link router-link-active">React+Redux入门详解</a></li><li class="dropdown-item"><!----> <a href="/react-typescript/" class="nav-link">React+TypeScript的完美结合</a></li><li class="dropdown-item"><!----> <a href="/react-webapp/" class="nav-link">React网易云Webapp</a></li><li class="dropdown-item"><!----> <a href="/react-ssr/" class="nav-link">React服务器渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/react-source/" class="nav-link">React深度剖析和源码解析</a></li><li class="dropdown-item"><!----> <a href="/react-antd/" class="nav-link">React+Typescript开发组件库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-ssr/" class="nav-link">Vue服务端渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/vue-interview/" class="nav-link">Vue3入门和实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Mysql/" class="nav-link">mysql</a></li><li class="dropdown-subitem"><a href="/Mysql-Architecture/" class="nav-link">mysql-Architecture</a></li></ul></li><li class="dropdown-item"><h4>linux操作系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Linux/" class="nav-link">linux</a></li><li class="dropdown-subitem"><a href="/Linux-Architecture/" class="nav-link">linux-Architecture</a></li></ul></li><li class="dropdown-item"><h4>网络协议</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Protocol/" class="nav-link">protocol</a></li><li class="dropdown-subitem"><a href="/react-redux/font-end-protocol.html" class="nav-link">font-end-protocol</a></li></ul></li><li class="dropdown-item"><h4>运维系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/prometheus/" class="nav-link">prometheus</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end/" class="nav-link">前端初级面试</a></li><li class="dropdown-item"><!----> <a href="/Front-advance/" class="nav-link">前端中级面试</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">究极全栈</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Big-Front-End/" class="nav-link">大前端</a></li><li class="dropdown-item"><!----> <a href="/Web-Architect/" class="nav-link">web架构课</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/react-redux/" class="sidebar-link">React + Redux入门详解</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react基础到进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react官网专题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redux基础到进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react架构设计理论</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>react架构设计实战</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react-redux/jiagou_project_one.html" class="active sidebar-link">前端架构设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#概念与案例分析" class="sidebar-link">概念与案例分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#_1-架构的概念" class="sidebar-link">1. 架构的概念</a></li><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#_2-前端架构" class="sidebar-link">2. 前端架构</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#工程化准备" class="sidebar-link">工程化准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#_1-技术选型和项目脚手架" class="sidebar-link">1. 技术选型和项目脚手架</a></li><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#_2-基本规范" class="sidebar-link">2. 基本规范</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#状态模块定义" class="sidebar-link">状态模块定义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#_1-redux模块两层化概念" class="sidebar-link">1. Redux模块两层化概念</a></li><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#_2-redux模块两层化实现" class="sidebar-link">2. Redux模块两层化实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#网络请求层封装" class="sidebar-link">网络请求层封装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#_1-请求方法和url" class="sidebar-link">1. 请求方法和URL</a></li><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#_2-redux中间件" class="sidebar-link">2. redux中间件</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#通用错误处理" class="sidebar-link">通用错误处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#_1-错误信息的组件" class="sidebar-link">1. 错误信息的组件</a></li><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#_2-错误状态" class="sidebar-link">2. 错误状态</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-redux/jiagou_project_one.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/react-redux/jiagou_jserror.html" class="sidebar-link">Javascript错误处理</a></li><li><a href="/react-redux/jiagou_axios.html" class="sidebar-link">异步请求封装</a></li><li><a href="/react-redux/jiagou_project_two.html" class="sidebar-link">首页开发</a></li><li><a href="/react-redux/jiagou_project_four.html" class="sidebar-link">团购详情页开发</a></li><li><a href="/react-redux/jiagou_project_six.html" class="sidebar-link">搜索页面开发</a></li><li><a href="/react-redux/jiagou_project_eight.html" class="sidebar-link">搜索结果页面开发</a></li><li><a href="/react-redux/jiagou_project_ten.html" class="sidebar-link">登录页面开发</a></li><li><a href="/react-redux/jiagou_project_twelve.html" class="sidebar-link">个人中心页面开发</a></li><li><a href="/react-redux/jiagou_project_fourtheen.html" class="sidebar-link">购买页面开发</a></li><li><a href="/react-redux/jiagou_project_sixteen.html" class="sidebar-link">优化和部署</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hooks基础到进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端架构设计"><a href="#前端架构设计" aria-hidden="true" class="header-anchor">#</a> 前端架构设计</h1> <h2 id="概念与案例分析"><a href="#概念与案例分析" aria-hidden="true" class="header-anchor">#</a> 概念与案例分析</h2> <h3 id="_1-架构的概念"><a href="#_1-架构的概念" aria-hidden="true" class="header-anchor">#</a> 1. 架构的概念</h3> <p>什么是软件架构，包含三个层次：<font color="#9400D3">抽象</font>、<font color="#9400D3">解耦</font>、<font color="#9400D3">组合</font></p> <p><font color="#DD1144">我们需要将来源于正式业务场景的需求进行抽象，然后需要对整个系统进行解耦，也就是将其模块化，然后根据业务场景的功能，将各个模块按照接口规范组合到一起，这样就有了不同的业务功能的体现。所以这三者就一般意义的构成了我们的架构。</font></p> <p><font color="#1E90FF">架构是最高层次的抽象，先有架构然后再去选取不同的框架和设计模式来实现架构，最后使用具体的代码来实现框架和设计模式</font></p> <h3 id="_2-前端架构"><a href="#_2-前端架构" aria-hidden="true" class="header-anchor">#</a> 2. 前端架构</h3> <p>前端架构有比较大的特殊性</p> <ul><li><p>因为前端不是一个独立的子系统，但是整个系统当中每个子系统中都会包含前端，所以前端又横跨整个系统</p></li> <li><p>前端在整个架构中具有<font color="#9400D3">分散性</font>的特点，所以需要前端工程化来解决这类问题，前端工程化需要我们做到下面这些事情</p> <ul><li><font color="#DD1144">可控</font>：脚手架，开发规范等</li> <li><font color="#DD1144">高效</font>：框架，组件库，Mock平台，构建部署工具等</li></ul></li> <li><p>前端的架构更多的是<font color="#9400D3">页面</font>的抽象，解耦和组合</p> <ul><li><font color="#9400D3">抽象</font> <ul><li><font color="#1E90FF">页面UI抽象</font> -&gt; <font color="#1E90FF">组件</font></li> <li><font color="#1E90FF">通用逻辑抽象</font> -&gt; <font color="#1E90FF">状态模块，网络请求，异常处理等</font></li></ul></li> <li><font color="#9400D3">解耦</font> <ul><li><font color="#1E90FF">UI层和状态层解耦（逻辑上）</font> -&gt; <font color="#1E90FF">使用redux</font></li> <li><font color="#1E90FF">UI层和状态层解耦（代码上）</font> -&gt; <font color="#1E90FF">使用react-redux</font></li> <li><font color="#1E90FF">UI层和状态层通过接口通信</font> -&gt; <font color="#1E90FF">Selectors/Reselect</font></li> <li><font color="#1E90FF">UI层和网络请求逻辑解耦</font> -&gt; <font color="#1E90FF">使用redux-thunk</font></li> <li><font color="#1E90FF">...</font></li></ul></li> <li><font color="#9400D3">组合</font> <ul><li><font color="#1E90FF">页面开发</font> -&gt; <font color="#1E90FF">就是组合，因为不同的页面就是不同的UI层、不同的逻辑层（状态层，网络请求、错误处理等）相互组合的结果</font></li> <li><font color="#1E90FF">功能开发</font> -&gt; <font color="#1E90FF">合理的使用第三方库的操作也是组合的一种</font></li> <li><font color="#1E90FF">部分优化</font> -&gt; <font color="#1E90FF">部分优化会借助到很多工具，这些工具要合理和有效的集成在项目中，也是一种组合行为</font></li></ul></li></ul></li></ul> <img src="/react_redux_jiagou_shizhan_jiagoutu.png" alt="架构图"> <p>所以像我们在一个复杂的页面当中进行分析，解耦出通用组件的过程，我们就是在做前端架构的事情，还有对通用的网络请求抽离封装，这也是前端架构的事情，<font color="#DD1144">所以如何进行架构设计呢？理解和梳理业务是架构的第一步，通常会根据需求文档和原型图来进行梳理，当然了没有这些你只能根据功能点来分析</font></p> <ul><li>展示：首页-&gt; 详情页</li> <li>搜索：搜索页 -&gt; 结果页</li> <li>购买：登录 -&gt; 下单 -&gt; 我的订单 -&gt; 注销</li></ul> <h2 id="工程化准备"><a href="#工程化准备" aria-hidden="true" class="header-anchor">#</a> 工程化准备</h2> <h3 id="_1-技术选型和项目脚手架"><a href="#_1-技术选型和项目脚手架" aria-hidden="true" class="header-anchor">#</a> 1. 技术选型和项目脚手架</h3> <p>技术选型考虑的三要素</p> <ul><li><font color="#1E90FF">业务满足程度</font></li> <li><font color="#1E90FF">技术栈的成熟度(使用人数，周边生态，仓库维护等)</font></li> <li><font color="#1E90FF">团队的熟悉度</font></li></ul> <p>我们的技术选型基本都是最成熟和最常用的</p> <ul><li><font color="#1E90FF">脚手架</font>：<code>create-react-app</code></li> <li><font color="#1E90FF">UI层</font>：<code>React</code></li> <li><font color="#1E90FF">路由</font>：<code>React Router</code></li> <li><font color="#1E90FF">状态管理</font>：<code>Redux</code></li></ul> <h3 id="_2-基本规范"><a href="#_2-基本规范" aria-hidden="true" class="header-anchor">#</a> 2. 基本规范</h3> <p>使用脚手架创建完项目，有了初始化的所有东西，我们就应该来考虑三个东西：<font color="#9400D3">目录结构</font>、<font color="#9400D3">构建体系</font>、<font color="#9400D3">Mock数据</font></p> <p><font color="#1E90FF"><strong>① 目录结构</strong></font></p> <ul><li><font color="#1E90FF">node_modules/</font></li> <li><font color="#1E90FF">public/</font> <ul><li><font color="#1E90FF">mock/</font>（Mock文件）
<ul><li><font color="#1E90FF">products/</font>（和产品相关的Mock数据）
<ul><li><font color="#9400D3">likes.json</font></li></ul></li></ul></li></ul></li> <li><font color="#1E90FF">src/</font> <ul><li><font color="#1E90FF">utils/</font>（工具类文件夹）</li> <li><font color="#1E90FF">images/</font>（图片文件夹）</li> <li><font color="#1E90FF">redux/</font> <ul><li><font color="#1E90FF">middleware/</font>（redux中间件文件夹）</li> <li><font color="#1E90FF">modules/</font>（redux模块文件夹）</li></ul></li> <li><font color="#1E90FF">components/</font>（全局通用性展示型组件文件夹）
<ul><li><font color="#1E90FF">Header/</font> <ul><li><font color="#9400D3">index.js</font>（Header通用组件的js代码文件）</li> <li><font color="#9400D3">style.css</font>（Header通用组件的css代码文件）</li></ul></li></ul></li> <li><font color="#1E90FF">containers/</font>（全局通用性容器型组件文件夹）
<ul><li><font color="#1E90FF">App/</font> <ul><li><font color="#9400D3">index.js</font></li> <li><font color="#9400D3">style.css</font></li></ul></li> <li><font color="#1E90FF">Home/</font> <ul><li><font color="#1E90FF">components/</font>（Home容器型组件中用到的私有展示型组件文件夹）</li> <li><font color="#9400D3">index.js</font></li> <li><font color="#9400D3">style.css</font></li></ul></li></ul></li></ul></li> <li><font color="#9400D3">.gitignore</font></li> <li><font color="#9400D3">package.json</font></li> <li><font color="#9400D3">README.md</font></li></ul> <p>基本上这个目录结构是一个比较好的结构了。关于最终的目录我们会在最后进行展示。</p> <p><font color="#1E90FF"><strong>② 构建体系</strong></font></p> <p>关于构建，其实使用到的命令就两个<code>npm start</code>和<code>npm build</code>，因为脚手架已经封装了<code>webpack</code>的配置，我们通常直接用即可。</p> <p><font color="#1E90FF"><strong>③ Mock数据</strong></font></p> <p>之前我们说的两个<code>Mock</code>的方法，我们这里直接采用第二种比较方便的方法，如果你想使用第一种，也可以参考我们前面讲的内容。</p> <h2 id="状态模块定义"><a href="#状态模块定义" aria-hidden="true" class="header-anchor">#</a> 状态模块定义</h2> <h3 id="_1-redux模块两层化概念"><a href="#_1-redux模块两层化概念" aria-hidden="true" class="header-anchor">#</a> 1. Redux模块两层化概念</h3> <p>我们知道<font color="#DD1144">状态是决定整个前端应用的展示以及前端数据流正常工作的核心</font>，我们前面已经说过前端架构的抽象大多是页面的抽象，页面UI的抽象就是组件，这是不需要我们抽象的，使用<code>react</code>本身就是组件化的抽象，那我们通用逻辑的抽象中的状态功能模块就有下面这些：</p> <ul><li><font color="#DD1144">领域实体</font>：商品，店铺，订单，评论等信息</li> <li><font color="#DD1144">各个页面的UI状态（普通的UI状态）</font>：多选框，输入框的内容等</li> <li><font color="#DD1144">前端基础状态（特殊的UI状态）</font>：登录态，全局异常信息，各个页面共享的UI状态，俗称通用前端状态</li></ul> <p>对于上面这三个状态，我们在<code>redux</code>状态设计的时候又可以将领域实体单独分一层，然后普通的UI状态和特殊的UI状态合并一层，统称UI状态层，这就是我们俗称的<font color="#9400D3">Redux模块两层化</font></p> <img src="/react_redux_jiagou_state.png" alt=""> <ul><li><p><font color="#1E90FF">容器组件可以根据页面状态和通用的前端状态获取到需要的状态信息，而页面状态又可以根据领域状态获取到领域信息，所以容器型组件只需要和第一层（页面状态和通用前端状态）交互即可</font></p></li> <li><p><font color="#DD1144">容器型组件需要的领域状态的信息就通过页面状态去获取即可，这样领域状态可以在各个页面之间进行复用，并且在页面状态调用领域状态的时候可以对领域状态进行一些预处理，比如说数据结构的转化等，获得符合容器组件显示规范的领域状态</font></p></li></ul> <h3 id="_2-redux模块两层化实现"><a href="#_2-redux模块两层化实现" aria-hidden="true" class="header-anchor">#</a> 2. Redux模块两层化实现</h3> <p>下面我们使用代码来实现<code>Redux</code>模块两层化，首先我们要来创建目录结构，这里只针对于<code>src/redux</code>进行目录的创建：</p> <ul><li><font color="#1E90FF">redux/</font> <ul><li><font color="#1E90FF">middleware/</font></li> <li><font color="#9400D3">store.js</font> （<font color="#DD1144">redux核心store总文件</font>）</li> <li><font color="#1E90FF">modules/</font> （状态模块总文件）
<ul><li><font color="#9400D3">index.js</font>  （UI状态层级和领域实体层级reducer合并文件）</li> <li><font color="#9400D3">app.js</font> 	 （<font color="#1E90FF">通用前端状态总文件</font>）</li> <li><font color="#9400D3">detail.js</font> （<font color="#1E90FF">详情页页面状态文件</font>）</li> <li><font color="#9400D3">home.js</font> 	 （<font color="#1E90FF">首页页面状态文件</font>）</li> <li><font color="#1E90FF">entities/</font> （<font color="#1E90FF">领域实体层级总文件</font>）
<ul><li><font color="#9400D3">index.js</font>    （领域实体reducer合并文件）</li> <li><font color="#9400D3">comments.js</font> （<font color="#3eaf7c">评论模块状态</font>）</li> <li><font color="#9400D3">orders.js</font>   （<font color="#3eaf7c">订单模块状态</font>）</li> <li><font color="#9400D3">products.js</font> （<font color="#3eaf7c">商品模块状态</font>）</li> <li><font color="#9400D3">shops.js</font>    （<font color="#3eaf7c">店铺模块状态</font>）</li></ul></li></ul></li></ul></li></ul> <p>然后我们从大到小的来看看相关的文件内容，这些代码和之前我们介绍的时候基本一样，所以就不做过多的注释和说明：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/index.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./redux/store.js'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./containers/App'</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/redux/store.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> applyMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span>
<span class="token keyword">import</span> rootReducer <span class="token keyword">from</span> <span class="token string">'./modules'</span>

<span class="token keyword">let</span> store

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&quot;production&quot;</span> <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 开发环境</span>
	<span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION_COMPOSE__
	store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	<span class="token comment">// 生产环境</span>
	store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/redux/modules/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> entities <span class="token keyword">from</span> <span class="token string">'./entities'</span>
<span class="token keyword">import</span> app <span class="token keyword">from</span> <span class="token string">'./app'</span>
<span class="token keyword">import</span> detail <span class="token keyword">from</span> <span class="token string">'./detail'</span>
<span class="token keyword">import</span> home <span class="token keyword">from</span> <span class="token string">'./home'</span>

<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	entities<span class="token punctuation">,</span>
	app<span class="token punctuation">,</span>
	detail<span class="token punctuation">,</span>
	home
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> rootReducer
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/redux/modules/entities/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> products <span class="token keyword">from</span> <span class="token string">'./products'</span>
<span class="token keyword">import</span> shops <span class="token keyword">from</span> <span class="token string">'./shops'</span>
<span class="token keyword">import</span> orders <span class="token keyword">from</span> <span class="token string">'./orders'</span>
<span class="token keyword">import</span> comments <span class="token keyword">from</span> <span class="token string">'./comments'</span>

<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	products<span class="token punctuation">,</span>
	shops<span class="token punctuation">,</span>
	orders<span class="token punctuation">,</span>
	comments
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> rootReducer
</code></pre></div><p>其余具体的<code>redux</code>状态文件，全部用下面代码进行临时填充：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> state
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> reducer
</code></pre></div><h2 id="网络请求层封装"><a href="#网络请求层封装" aria-hidden="true" class="header-anchor">#</a> 网络请求层封装</h2> <h3 id="_1-请求方法和url"><a href="#_1-请求方法和url" aria-hidden="true" class="header-anchor">#</a> 1. 请求方法和URL</h3> <p><font color="#1E90FF"><strong>① 请求方法</strong></font></p> <p>我们首先会对请求方法和<code>URL</code>进行封装，创建<code>src/utils/request.js</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 请求头对象</span>
<span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token string">&quot;Accept&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/json&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// GET方法封装</span>
<span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		method<span class="token punctuation">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
		headers<span class="token punctuation">:</span> headers
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">handleResponse</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> response<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request failed. Url = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Message=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			error<span class="token punctuation">:</span> <span class="token punctuation">{</span>
				message<span class="token punctuation">:</span> <span class="token string">&quot;Request failed.&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// POST方法封装</span>
<span class="token keyword">function</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		method<span class="token punctuation">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
		headers<span class="token punctuation">:</span> headers<span class="token punctuation">,</span>
		body<span class="token punctuation">:</span> data
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">handleResponse</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> response<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request failed. Url = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Message=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			error<span class="token punctuation">:</span> <span class="token punctuation">{</span>
				message<span class="token punctuation">:</span> <span class="token string">&quot;Request failed.&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 请求处理方法</span>
<span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request failed. Url = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			error<span class="token punctuation">:</span> <span class="token punctuation">{</span>
				message<span class="token punctuation">:</span> <span class="token string">&quot;Request failed due to server error&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token keyword">get</span><span class="token punctuation">,</span> post<span class="token punctuation">}</span>
</code></pre></div><p>这里我们就要好好研究一下封装网络请求的思路：<font color="#DD1144">网络请求首先从大体上分为两个情况，第一种就是请求发出去并且受到了响应，这成为请求成功，这种是宏观意义的成功，就是说先不管响应内容是啥，总之一来一回的路是走通了。第二种就是请求出问题，例如网络问题，被拦截，总之是服务器没有受到，这称为宏观意义上的失败。两种情况可以看到前者是使用fetch.then处理的，后者是用fetch.catch处理的，<font color="#9400D3">但是切记两者是都有返回值的，很多人这里都是只写打印log没有返回值导致通常程序到这里报错，页面整体显示不了，这不是一种良好的错误处理的方式</font></font></p> <p><font color="#1E90FF">接着在宏观意义的成功请求下，又分为微观的请求成功和微观的请求失败，这两者的定义不是规定死的，是需要我们和后端工程师进行约定的。如果按照自定义的方式，比如上面代码中的handleResponse处理函数中：一般来说返回码为200的才叫成功，哪怕响应错误信息都是写在200状态码的响应内容中，其他的状态码统统为失败，那么不成功的我们要打印出来并且也要有返回值。可是这套理论在restful风格的接口下就不成立，因为在restful风格的api当中，不同的错误由不同的状态码所标志，所以我们就需要在handleResponse函数当中根据不同的状态码来判断到底是失败还是成功</font></p> <img src="/react_redux_jiagou_fetch.png" alt="网络请求逻辑图"> <p>当然了关于请求方式还有很多库，比如说<code>axios</code>，那么在<code>axios</code>之上进行二次封装，这又是比较大的学问，这里我们就不展开来讲，感兴趣的看看这个<a href="https://mp.weixin.qq.com/s/xLQs63RSQk9Uy3LlhGXYdA" target="_blank" rel="noopener noreferrer">文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，或者上网查查其他的资料。</p> <p><font color="#1E90FF"><strong>② Url</strong></font></p> <p>然后创建<code>src/utils/url.js</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">getProductList</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">rowIndex<span class="token punctuation">,</span> pageSize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token string">`/mock/products/likes.json?rowIndex=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rowIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;pageSize=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageSize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
<span class="token punctuation">}</span>
</code></pre></div><p>其他的请求<code>url</code>也会在后续按照上面这种方式进行添加。</p> <p>按照这样的请求方式的封装，我们来简单的写一个在首页要展示的猜你喜欢的数据获取的异步<code>action</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/redux/modules/home.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../utils/request'</span>
<span class="token keyword">import</span> url <span class="token keyword">from</span> <span class="token string">'../../utils/url'</span>

<span class="token comment">// actionTypes</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token comment">// 获取猜你喜欢请求</span>
	<span class="token constant">FETCH_LIKE_REQUEST</span><span class="token punctuation">:</span> <span class="token string">&quot;HOME/FETCH_LIKE_REQUEST&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 获取猜你喜欢请求成功</span>
	<span class="token constant">FETCH_LIKE_SUCCESS</span><span class="token punctuation">:</span> <span class="token string">&quot;HOME/FETCH_LIKE_SUCCESS&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 获取猜你喜欢请求失败</span>
	<span class="token constant">FETCH_LIKE_FAILURE</span><span class="token punctuation">:</span> <span class="token string">&quot;HOME/FETCH_LIKE_FAILURE&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// actionCreators</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">loadLikes</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchLikesRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token keyword">get</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">getProductList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
				<span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchLikesSuccess</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchLikesFailure</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchLikesRequest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
	type<span class="token punctuation">:</span> types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKE_REQUEST</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchLikesSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
	type<span class="token punctuation">:</span> types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKE_REQUEST</span><span class="token punctuation">,</span>
	data
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchLikesFailure</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
	type<span class="token punctuation">:</span> types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKE_FAILURE</span><span class="token punctuation">,</span>
	error
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKE_REQUEST</span><span class="token punctuation">:</span>
			<span class="token comment">// todo</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKE_SUCCESS</span><span class="token punctuation">:</span>
			<span class="token comment">// todo</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKE_FAILURE</span><span class="token punctuation">:</span>
			<span class="token comment">// todo</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> state
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> reducer
</code></pre></div><h3 id="_2-redux中间件"><a href="#_2-redux中间件" aria-hidden="true" class="header-anchor">#</a> 2. redux中间件</h3> <p>可以看到啊，这只是首页的一个关于产品领域的状态请求，我们就要写这么多的代码，试想，首页如果有10多个乃至20多个请求，这些代码要重复写20遍，整个<code>redux</code>所有的代码加起来估价要上万了。<font color="#1E90FF">但是你可以看到这个一个请求的代码实际有点类似于模板，所有的请求几乎都是这个模式，所以我们需要将这种模板似的代码进行抽象，用一个action去描述，并且在中间件当中去处理呢</font></p> <p>我们使用一个<code>action</code>来描述对这种数据请求的处理，它的结构应该是这样的：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 普通的action</span>
action <span class="token operator">=</span> <span class="token punctuation">{</span>
	type<span class="token punctuation">:</span> <span class="token string">&quot;XXX&quot;</span><span class="token punctuation">,</span>
	data<span class="token punctuation">:</span> <span class="token string">&quot;yyy&quot;</span><span class="token punctuation">,</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token comment">// 数据请求的action</span>
action <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token constant">FETCH_DATA</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
		types<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token string">'success'</span><span class="token punctuation">,</span><span class="token string">'fail'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		endpoint<span class="token punctuation">:</span> url<span class="token punctuation">,</span>
		schema<span class="token punctuation">:</span> <span class="token punctuation">{</span>
			id<span class="token punctuation">:</span> <span class="token string">&quot;product_id&quot;</span><span class="token punctuation">,</span>
			name<span class="token punctuation">:</span> <span class="token string">&quot;products&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>FETCH_DATA</code>是用来表示获取数据的<code>action</code>，<code>types</code>数据中的三个元素分别代表请求中，请求成功，请求失败的<code>action</code>,<code>endpoint</code>表示请求的<code>url</code>地址是什么,<code>schema</code>是代表领域实体的结构，因为领域实体的数据需要做偏平化的处理，比如数组转化成<code>key-value</code>的数据结构,<code>id</code>就代表了在领域数据中哪个属性能够代表这个数据的<code>id</code>值，<code>name</code>表示当前处理的是哪个领域实体，所以这些<code>schema</code>应该定义在每个领域实体状态文件当中，比如商品领域：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/redux/modules/entities/products.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
	name<span class="token punctuation">:</span> <span class="token string">&quot;products&quot;</span><span class="token punctuation">,</span>
	id<span class="token punctuation">:</span> <span class="token string">&quot;id&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后我们来使用代码实现对<code>get</code>方法请求的实现，创建<code>src/redux/middleware/api.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/redux/middleware/api.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../utils/request'</span>

<span class="token comment">// 凡是action当中有这个属性的都要经过中间件的处理</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">FETCH_DATA</span> <span class="token operator">=</span> <span class="token string">&quot;FETCH DATA&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token parameter">store</span> <span class="token operator">=&gt;</span> <span class="token parameter">next</span> <span class="token operator">=&gt;</span> <span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> callAPI <span class="token operator">=</span> action<span class="token punctuation">[</span><span class="token constant">FETCH_DATA</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callAPI <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 说明不是请求数据的action，放过处理</span>
		<span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">const</span> <span class="token punctuation">{</span> endpoint<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> types <span class="token punctuation">}</span> <span class="token operator">=</span> callAPI
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> endpoint <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint必须为字符串类型的URL&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// schema属性也是必须的，否则不知道怎么做扁平化处理</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;必须指定领域实体的schema&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>types<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> types<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;需要指定一个包含3个action type的数组&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>types<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> type <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;action type必须为字符串类型&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 增强版的action,确保除了FETCH_DATA的其他属性可以传递下去</span>
	<span class="token keyword">const</span> <span class="token function-variable function">actionWith</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> finalAction <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>action<span class="token punctuation">,</span> <span class="token operator">...</span>data<span class="token punctuation">}</span>
		<span class="token keyword">delete</span> finalAction<span class="token punctuation">[</span><span class="token constant">FETCH_DATA</span><span class="token punctuation">]</span> <span class="token comment">// 删除掉FETCH_DATA属性</span>
		<span class="token keyword">return</span> finalAction
	<span class="token punctuation">}</span>

	<span class="token keyword">const</span> <span class="token punctuation">[</span>requestType<span class="token punctuation">,</span> successType<span class="token punctuation">,</span> failureType<span class="token punctuation">]</span> <span class="token operator">=</span> types


	<span class="token function">next</span><span class="token punctuation">(</span><span class="token function">actionWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span> requestType<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
		<span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token function">actionWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			type<span class="token punctuation">:</span> successType<span class="token punctuation">,</span>
			response
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token function">actionWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			type<span class="token punctuation">:</span> failureType<span class="token punctuation">,</span>
			error<span class="token punctuation">:</span> error<span class="token punctuation">.</span>message <span class="token operator">||</span> <span class="token string">&quot;获取数据失败&quot;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">)</span>
	<span class="token comment">// 下面这种写法也一样</span>
	<span class="token comment">// return fetchData(endpoint, schema)</span>
	<span class="token comment">// .then(</span>
	<span class="token comment">// 	response =&gt; next(actionWith({</span>
	<span class="token comment">// 		type: successType,</span>
	<span class="token comment">// 		response</span>
	<span class="token comment">// 	})),</span>
	<span class="token comment">// ).catch(</span>
	<span class="token comment">// 	error =&gt; next(actionWith({</span>
	<span class="token comment">// 		type: failureType,</span>
	<span class="token comment">// 		error: error.message || &quot;获取数据失败&quot;</span>
	<span class="token comment">// 	}))</span>
	<span class="token comment">// )</span>
<span class="token punctuation">}</span>

<span class="token comment">//执行网络请求</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">endpoint<span class="token punctuation">,</span> schema</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// 这里我们只用了get方法，实际上我们还可以在FETCH_DATA定义一个method来表示http请求是get还是post</span>
	<span class="token comment">// 然后传入fetchData的参数就是三个，method，endpoint, schema</span>
	<span class="token comment">// if (method === &quot;GET&quot;) return get(endpoint).then(...)</span>
	<span class="token comment">// if (method === &quot;POST&quot;) return post(endpoint).then(...)</span>
  <span class="token keyword">return</span> <span class="token keyword">get</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">normalizeData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> schema<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//根据schema, 将获取的数据扁平化处理</span>
<span class="token keyword">const</span> <span class="token function-variable function">normalizeData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> schema</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">,</span> name<span class="token punctuation">}</span> <span class="token operator">=</span> schema
  <span class="token keyword">let</span> kvObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 用于存储扁平化数据的变量</span>
  <span class="token keyword">let</span> ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 保存每个数据当中的id，维护有序性</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      kvObj<span class="token punctuation">[</span>item<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> item
      ids<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    kvObj<span class="token punctuation">[</span>data<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> data
    ids<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">:</span> kvObj<span class="token punctuation">,</span>
    ids
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接着我们按着封装的情况修改之前的<code>home.js</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/redux/modules/home.js</span>
<span class="token keyword">import</span> url <span class="token keyword">from</span> <span class="token string">&quot;../../utils/url&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">FETCH_DATA</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../middleware/api&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> schema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./entities/products&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//获取猜你喜欢请求</span>
  <span class="token constant">FETCH_LIKES_REQUEST</span><span class="token punctuation">:</span> <span class="token string">&quot;HOME/FETCH_LIKES_REQUEST&quot;</span><span class="token punctuation">,</span> 
  <span class="token comment">//获取猜你喜欢请求成功</span>
  <span class="token constant">FETCH_LIKES_SUCCESS</span><span class="token punctuation">:</span> <span class="token string">&quot;HOME/FETCH_LIKES_SUCCESS&quot;</span><span class="token punctuation">,</span> 
  <span class="token comment">//获取猜你喜欢请求失败</span>
  <span class="token constant">FETCH_LIKES_FAILURE</span><span class="token punctuation">:</span> <span class="token string">&quot;HOME/FETCH_LIKES_FAILURE&quot;</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">loadLikes</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> endpoint <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getProductList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchLikes</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 定义了一个包含[FETCH_DATA]数据请求的action结构</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchLikes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">endpoint</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">FETCH_DATA</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    types<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKES_REQUEST</span><span class="token punctuation">,</span>
      types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKES_SUCCESS</span><span class="token punctuation">,</span>
      types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKES_FAILURE</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    endpoint<span class="token punctuation">,</span>
    schema
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKES_REQUEST</span><span class="token punctuation">:</span>
    <span class="token comment">// todo</span>
    <span class="token keyword">case</span> types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKES_SUCCESS</span><span class="token punctuation">:</span>
    <span class="token comment">// todo</span>
    <span class="token keyword">case</span> types<span class="token punctuation">.</span><span class="token constant">FETCH_LIKES_FAILURE</span><span class="token punctuation">:</span>
    <span class="token comment">// todo</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> reducer<span class="token punctuation">;</span>
</code></pre></div><p>这样不仅节省了代码而且更重要的是，<font color="#1E90FF">这里反映了redux中通过第一层的页面状态去获取第二层领域状态的过程</font></p> <p>在首页请求到了数据后也应该保存在<code>products</code>领域的状态文件当中：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/redux/modules/entities/products.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'products'</span><span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// 因为一个action进入reducer，所有reducer的相关模块都要去判断这个action是否是需要自己处理</span>
	<span class="token comment">// 而一般根据action.type判断是否符合reducer处理的条件</span>
	<span class="token comment">// 但是这里是根据action的其他属性进行判断，同样合理，action.type的判断方式只是业界标准，并非程序标准</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>response <span class="token operator">&amp;&amp;</span> action<span class="token punctuation">.</span>response<span class="token punctuation">.</span>products<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token operator">...</span>action<span class="token punctuation">.</span>response<span class="token punctuation">.</span>products<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> reducer<span class="token punctuation">;</span>
</code></pre></div><p>到这里好多人都看不懂，我们需要一个流程图来仔细解释：</p> <img src="/react_redux_jiagou_middle_api.png" alt=""> <p><font color="#1E90FF">当在首页派发redux/home模块中的loadLikes这个异步action的时候，通过redux-thunk中间件的时候发现是异步的，就执行函数，函数执行的时候使用dispatch(这里不是next)派发了一个普通对象的action，这个action经过redux-thunk后进入我们自定义的api这个redux中间件，先使用next派发了一个type为HOME/FETCH_LIKES_REQUEST的action，进入store和reducer的处理，然后又向服务器发送请求，请求成功使用next派发一个type为HOME/FETCH_LIKES_SUCCESS的action，然后经过store后，在reducer处理的时候同时修改了home模块和entities/products模块这两个模块的状态</font></p> <p>最后，集成中间件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/redux/store.js</span>
<span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">'./middleware/api.js'</span> <span class="token comment">// 引入中间件</span>

<span class="token keyword">let</span> store

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&quot;production&quot;</span> <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION_COMPOSE__
	store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">,</span> api<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2. 在thunk中间件之后</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">,</span>api<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3. 在thunk中间件之后</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="通用错误处理"><a href="#通用错误处理" aria-hidden="true" class="header-anchor">#</a> 通用错误处理</h2> <p>错误处理是建立在前面的网络请求层当中的，我们先来理清网络请求的过程，首先在<code>src/utils/request.js</code>当中的<code>get</code>方法中返回一个<code>Promise</code>，然后到<code>src/redux/middleware/api.js</code>当中的<code>fetchData</code>方法中返回一个<code>Promise</code>,这里的<code>Promise</code>请注意，并没有<code>catch</code>，也就是说<code>get</code>当中发生的错误会继续传递下去，并最终在中间件<code>api</code>当中的执行<code>fetchData().then()</code>的时候走到<code>error</code>的处理函数中，那么关系整个<code>fetch</code>请求的知识点我们要讲一下：</p> <img src="/react_jiagou_fetch.png" alt=""> <p>可以很清楚的看到<code>get</code>方法返回一个<code>Promise</code>，其<code>Promise</code>携带的<code>then</code>和<code>catch</code>都有三种写法，各自的第一和第二种方法效果相同，不写的话，其<code>value</code>或者<code>err</code>就会原原本本传递到下一个<code>Promise</code>上。</p> <p><font color="#DD1144">但是特别要注意在catch的第三种写法中，如果写的是return err，那么这个err传递到下一个Promise当中就变成了下一个Promise中的value，所以要让错误继续传递下去，要么不写，要么就必须使用Promise.reject来携带这个err，这样才能在下一个Promise当中的catch中截获到这err</font></p> <p>通用错误处理包含两个内容：<font color="#9400D3">错误信息组件</font> 和 <font color="#9400D3">redux中设计错误状态</font></p> <h3 id="_1-错误信息的组件"><a href="#_1-错误信息的组件" aria-hidden="true" class="header-anchor">#</a> 1. 错误信息的组件</h3> <p>我们首先在公用组件文件夹<code>components</code>当中定义一个<code>ErrorToast</code>组件，然后书写代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/components/ErrorToast/index.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./style.css'</span>

<span class="token keyword">class</span> <span class="token class-name">ErrorToast</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
	<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token comment">// clearError函数可以将错误信息重置</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">clearError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span> msg <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;errorToast&quot;</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;errorToast_text&quot;</span><span class="token operator">&gt;</span>
					<span class="token punctuation">{</span> msg <span class="token punctuation">}</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> ErrorToast<span class="token punctuation">;</span>
</code></pre></div><p>这个组件是比较简单的，其中调用组件的时候，只需要传入<code>msg</code>和<code>clearError</code>这个清除错误的函数。样式的内容我们就不在这里展示了，有兴趣的话可以参照<a href="https://github.com/taopoppy/fontdemo/tree/master/dianping-react" target="_blank" rel="noopener noreferrer">taopoppy/fontdemo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_2-错误状态"><a href="#_2-错误状态" aria-hidden="true" class="header-anchor">#</a> 2. 错误状态</h3> <p>关于通用错误处理，我们需要知道，通用错误处理是基础前端的状态之一，所以我们需要在<code>app</code>这个模块当中去定义错误信息：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/redux/modules/app.js</span>

<span class="token comment">// actionTypes</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token constant">CLEAR_ERROR</span><span class="token punctuation">:</span> <span class="token string">&quot;APP/CLEAR_ERROR&quot;</span> <span class="token comment">// 清除错误</span>
<span class="token punctuation">}</span>

<span class="token comment">// actionCreators</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> actions <span class="token operator">=</span><span class="token punctuation">{</span>
	<span class="token function-variable function">clearError</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
		type<span class="token punctuation">:</span> types<span class="token punctuation">.</span><span class="token constant">CLEAR_ERROR</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
	error<span class="token punctuation">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> action
	<span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> types<span class="token punctuation">.</span><span class="token constant">CLEAR_ERROR</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> error<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 通过判断action对象当中是否含有error属性来进行判断</span>
		<span class="token comment">// 这是除了通过action.type的第二种判断action的方法</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> error<span class="token punctuation">:</span> error<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> state
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> reducer

<span class="token comment">// selector函数</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> state<span class="token punctuation">.</span>app<span class="token punctuation">.</span>error
<span class="token punctuation">}</span>
</code></pre></div><p>有了这样的状态定义，我们可以直接<code>redux.app.error</code>有值的时候，在全局调起我们前面书写的<code>ErrorToast</code>组件来显示错误；</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/containers/App/index.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ErrorToast <span class="token keyword">from</span> <span class="token string">'../../components/ErrorToast/index'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> actions <span class="token keyword">as</span> appActions <span class="token punctuation">,</span>getError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../redux/modules/app'</span>
<span class="token keyword">import</span> <span class="token string">'./style.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bindActionCreators <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> appActions<span class="token punctuation">:</span> <span class="token punctuation">{</span> clearError <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
				<span class="token punctuation">{</span>  error <span class="token operator">?</span> <span class="token operator">&lt;</span>ErrorToast msg<span class="token operator">=</span><span class="token punctuation">{</span>error<span class="token punctuation">}</span> clearError<span class="token operator">=</span><span class="token punctuation">{</span>clearError<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// state是redux的总state，props是当前容器型组件接收到的props</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		error<span class="token punctuation">:</span> <span class="token function">getError</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		<span class="token comment">// 使用bindActionCreators后可以直接在组件当中发送action，而不需要调用dispatch来发送action</span>
		<span class="token comment">// 因为直接从redux当中的app模块中的actionCreators拿了过来</span>
		appActions<span class="token punctuation">:</span> <span class="token function">bindActionCreators</span><span class="token punctuation">(</span>appActions<span class="token punctuation">,</span> dispatch<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span>mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <img src="/react_redux_jiagou_sign_mindmaster.png" alt="学习图谱"></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/15/2020, 4:43:55 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/react-redux/jiagou_sign_seven.html" class="prev">
          React架构设计高级思想
        </a></span> <span class="next"><a href="/react-redux/jiagou_jserror.html">
          Javascript错误处理
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1a394514.js" defer></script><script src="/assets/js/2.8304a06b.js" defer></script><script src="/assets/js/253.374cc99e.js" defer></script>
  </body>
</html>
