(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{199:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"beego入门案例（二-4）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#beego入门案例（二-4）","aria-hidden":"true"}},[t._v("#")]),t._v(" Beego入门案例（二-4）")]),t._v(" "),s("h2",{attrs:{id:"独立部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#独立部署","aria-hidden":"true"}},[t._v("#")]),t._v(" 独立部署")]),t._v(" "),s("h3",{attrs:{id:"_1-设置环境参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-设置环境参数","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 设置环境参数")]),t._v(" "),s("p",[t._v("首先到当前项目的目录下面关注两个环境变量："),s("font",{attrs:{color:"#DD1144"}},[t._v("GOOS")]),t._v("和"),s("font",{attrs:{color:"#DD1144"}},[t._v("GOARCH")])],1),t._v(" "),s("ul",[s("li",[s("code",[t._v("GOOS")]),t._v("表示当前打包的项目要执行在什么操作系统中，有三个值，分别是："),s("font",{attrs:{color:"#1E90FF"}},[t._v("darwin（MAC系统）")]),t._v("、"),s("font",{attrs:{color:"#1E90FF"}},[t._v("linux（Linux系统）")]),t._v("、"),s("font",{attrs:{color:"#1E90FF"}},[t._v("windows（Windows操作系统）")])],1),t._v(" "),s("li",[s("code",[t._v("GOARCH")]),t._v("表示的"),s("code",[t._v("cpu")]),t._v("参数，也就是项目运行在什么"),s("code",[t._v("cpu")]),t._v("的架构之下，我们现在一般的都是"),s("code",[t._v("amd64")]),t._v("，如果这个参数你不确定，可以通过在目标服务器上安装好"),s("code",[t._v("Go")]),t._v("环境之后，使用"),s("code",[t._v("go env")]),t._v("来查看")])]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("set GOOS"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("linux\nset GOARCH"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("amd64\n")])])]),s("h3",{attrs:{id:"_2-打包项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-打包项目","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 打包项目")]),t._v(" "),s("p",[t._v("我们其实可以使用"),s("code",[t._v("go build")]),t._v("来打包项目，这样在项目中直接会包含一个可执行文件，但是在"),s("code",[t._v("Beego")]),t._v("中有它自己的一个打包方式：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("bee pack\n")])])]),s("p",[t._v("使用上面的命令后，我们的项目总目录是"),s("code",[t._v("xcms")]),t._v(",会给我们生成一个"),s("code",[t._v("xcms.tar.gz")]),t._v("在项目文件中，这个文件的背后实际上做了很多额外的事情：")]),t._v(" "),s("ul",[s("li",[t._v("首先也会像"),s("code",[t._v("go build")]),t._v("一样创建一个可执行文件")]),t._v(" "),s("li",[t._v("然后将项目当中的静态文件和配置文件全部打包到一起")])]),t._v(" "),s("h3",{attrs:{id:"_3-执行项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-执行项目","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 执行项目")]),t._v(" "),s("p",[t._v("我们刚才打包出了一个"),s("code",[t._v("xcms.tar.gz")]),t._v("的压缩包，现在我们将其解压:")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("tar "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("xzvf xcms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gz\n")])])]),s("p",[t._v("然后我们会得到一些文件：")]),t._v(" "),s("ul",[s("li",[s("font",{attrs:{color:"#1E90FF"}},[t._v("README.md")]),t._v("：说明文件")],1),t._v(" "),s("li",[s("font",{attrs:{color:"#1E90FF"}},[t._v("static")]),t._v("：静态资源目录")],1),t._v(" "),s("li",[s("font",{attrs:{color:"#1E90FF"}},[t._v("xcms")]),t._v("：可执行文件")],1),t._v(" "),s("li",[s("font",{attrs:{color:"#1E90FF"}},[t._v("views")]),t._v("：视图文件的目录")],1),t._v(" "),s("li",[s("font",{attrs:{color:"#1E90FF"}},[t._v("conf")]),t._v("：配置文件的目录")],1)]),t._v(" "),s("p",[t._v("这里要说明的就是："),s("font",{attrs:{color:"#DD1144"}},[t._v("解压后的xcms这个可执行文件它的执行已经不依赖我们开发时候的那些在GOPATH/src中的文件和代码了，它只依赖于我们解压的这些文件")]),t._v("，所以比如我们在"),s("code",[t._v("windows")]),t._v("下面开发这些项目，打包好后直接上传到"),s("code",[t._v("linux")]),t._v("服务器的某个目录下，然后解压后在解压后的文件夹下执行下面的命令：")],1),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("nohup "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("xcms "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n")])])]),s("p",[t._v("然后在项目文件中会生成一个"),s("code",[t._v("nohup.out")]),t._v(",把之前在命令行输出的内容都放在了这个里面，我们可以使用下面的命令来查看：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("tail nohup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out\n")])])]),s("p",[t._v("此时我们的项目就已经启动起来了。")]),t._v(" "),s("h2",{attrs:{id:"nginx-双机服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-双机服务","aria-hidden":"true"}},[t._v("#")]),t._v(" Nginx+双机服务")]),t._v(" "),s("h3",{attrs:{id:"_1-nginx的好处"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-nginx的好处","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. Nginx的好处")]),t._v(" "),s("img",{attrs:{src:t.$withBase("/beego_one_nginxgo.png"),alt:"双机服务"}}),t._v(" "),s("p",[t._v("使用"),s("code",[t._v("Nginx")]),t._v("和双机部署有两个好处：")]),t._v(" "),s("ul",[s("li",[s("font",{attrs:{color:"#1E90FF"}},[t._v("用户请求量大的时候，瓶颈又在服务端，"),s("code",[t._v("Nginx")]),t._v("可以分发请求，从而起到一个分流的作用")])],1),t._v(" "),s("li",[s("font",{attrs:{color:"#1E90FF"}},[t._v("另外Nginx是负责负载均衡的，在多台机器可用的时候控制负载均衡，同时当发现其中有机器故障的时候还会自动将这个机器踢出去，起到保护的作用")])],1)]),t._v(" "),s("h3",{attrs:{id:"_2-单台服务nginx配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-单台服务nginx配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 单台服务Nginx配置")]),t._v(" "),s("p",[t._v("说道代理呢，实际上我们知道有两种代理："),s("font",{attrs:{color:"#1E90FF"}},[t._v("普通代理")]),t._v(" 和 "),s("font",{attrs:{color:"#1E90FF"}},[t._v("反向代理")])],1),t._v(" "),s("ul",[s("li",[s("font",{attrs:{color:"#3eaf7c"}},[t._v("普通代理")]),t._v("：它的中间代理是在用户客户端这里配置的，也就是客户知道无论是自己发还是代理发，目标服务都是那个我们知道的源服务。这个一般在翻墙中运用广泛。")],1),t._v(" "),s("li",[s("font",{attrs:{color:"#3eaf7c"}},[t._v("反向代理")]),t._v("：反向代理的中间代理是在服务端这里配置的，那就是说用户是不知道自己请求的到底是真正的源服务还是中间代理")],1)]),t._v(" "),s("p",[t._v("在安装好"),s("code",[t._v("nginx")]),t._v("以后使用"),s("code",[t._v("nginx -t")]),t._v("命令来查询配置文件的地址，然后打开配置文件所在的目录，你会发现有很多文件，有"),s("font",{attrs:{color:"#1E90FF"}},[t._v("nginx.conf")]),t._v("，还有"),s("font",{attrs:{color:"#1E90FF"}},[t._v("servers")]),t._v("这个文件夹，"),s("code",[t._v("servers")]),t._v("文件夹下面所有以"),s("code",[t._v(".conf")]),t._v("结尾的文件中配置都会被包含在"),s("code",[t._v("nginx.conf")]),t._v("的主配置文件中，以为在"),s("code",[t._v("nginx.conf")]),t._v("中的最后一行有这样的代码：")],1),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("include servers"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*;\n")])])])]),s("p",[t._v("所以我们直接在"),s("code",[t._v("servers")]),t._v("文件目录下面使用下面的命令：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("vi xcms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n")])])]),s("p",[t._v("新创建一个"),s("code",[t._v("xcms.conf")]),t._v("的配置文件来开启一个新的代理服务，文件内容如下：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 端口")]),t._v("\n  server_name localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 域名")]),t._v("\n  location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    try_files "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" _not_existes_ @backend"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  location @backend"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8091")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("然后使用"),s("code",[t._v("nginx -t")]),t._v("检查一下是否语法正确，然后使用"),s("code",[t._v("nginx")]),t._v("命令启动反向代理，然后我们将项目启动到8091端口（修改"),s("code",[t._v("conf/app.conf")]),t._v("文件），因为我们在"),s("code",[t._v("nginx")]),t._v("中配置的是8090代理8091，也就是你实际访问的是"),s("code",[t._v("nginx")]),t._v("的8090，它帮你访问跑在8091的"),s("code",[t._v("go")]),t._v("服务。")]),t._v(" "),s("h3",{attrs:{id:"_3-多台服务nginx配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-多台服务nginx配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 多台服务Nginx配置")]),t._v(" "),s("p",[t._v("我们在上面的那个单台服务的"),s("code",[t._v("Nginx")]),t._v("配置稍微做一下改动即可，修改"),s("code",[t._v("xcms.conf")]),t._v("文件如下：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("upstream mysrv "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ip_hash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8091")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n  server "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8092")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实际的配置是这些都是不同的ip地址")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    try_files "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" _not_existes_ @backend"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  location @backend"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mysrv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("然后我们重启一下"),s("code",[t._v("nginx")]),t._v(":"),s("code",[t._v("nginx -s reload")]),t._v(",我们特别要在"),s("code",[t._v("upstream mysrv")]),t._v("中的"),s("code",[t._v("ip_hash")]),t._v("的配置。以为负载均衡的原则是将当前请求分发到最少请求数量的服务器，比如我们登陆，我们会先访问到8091来显示我们的登陆页面，输入用户名和密码登陆的请求会因为"),s("code",[t._v("nginx")]),t._v("的负载均衡分发到8092，所以我们当前的用户的只保存在了8092的"),s("code",[t._v("session")]),t._v("，而下一个重定向的请求又发回了8091，而8091的"),s("code",[t._v("session")]),t._v("中没有保存当前用户，所以就会产生登陆不上去的现象。")]),t._v(" "),s("p",[t._v("配置了"),s("code",[t._v("ip_hash")]),t._v("后，给每个用户的请求都标识一个哈希，这样同一个用户的所有请求都会分发到同一台机器，这样就解决了这个问题。")])])},[],!1,null,null,null);a.default=e.exports}}]);