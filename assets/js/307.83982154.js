(window.webpackJsonp=window.webpackJsonp||[]).push([[307],{495:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署","aria-hidden":"true"}},[t._v("#")]),t._v(" 部署")]),t._v(" "),s("h2",{attrs:{id:"部署和总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署和总结","aria-hidden":"true"}},[t._v("#")]),t._v(" 部署和总结")]),t._v(" "),s("h3",{attrs:{id:"_1-提交远程仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-提交远程仓库","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 提交远程仓库")]),t._v(" "),s("p",[t._v("如果你一开始就创建了一个远程仓库，然后开发的过程一直是开发和提交，现在就不需要这个过程了。")]),t._v(" "),s("p",[t._v("如果你一直是在本地开发，我们需要先将代码提交到某个仓库，现在项目的根目录执行：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("git init\n")])])]),s("p",[t._v("然后添加"),s("code",[t._v(".gitignore")]),t._v("文件，将"),s("code",[t._v(".next")]),t._v("和"),s("code",[t._v("node_modules")]),t._v("忽略，因为这两个是不应该提交到服务器上面的，接着我们提交到本地的工作区：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("git add "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\ngit commit "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'init project'")]),t._v("\n")])])]),s("p",[t._v("接着我们去线上提交，那提交的话你需要到"),s("code",[t._v("git")]),t._v("或者"),s("code",[t._v("gitee")]),t._v("上面创建一个空的项目，从项目当中拿到"),s("code",[t._v("ssh")]),t._v("的提交地址，但是光有地址不行，你还要有权限，你需要在"),s("code",[t._v("git")]),t._v("或者"),s("code",[t._v("gitee")]),t._v("上面的"),s("code",[t._v("ssh公钥")]),t._v("的地方添加一个你本地的公钥和线上服务器的公钥。")]),t._v(" "),s("p",[t._v("这个公钥怎么生成呢?")]),t._v(" "),s("ul",[s("li",[t._v("在命令中执行"),s("code",[t._v("ssh keygen.exe")]),t._v("，一路"),s("code",[t._v("enter")]),t._v("即可")]),t._v(" "),s("li",[t._v("然后在执行"),s("code",[t._v("cat C:\\Users\\Administrator\\.ssh\\id_rsa.pub")]),t._v("，就会在命令行中显示你的公钥，当然你也可以直接去文件中，打开文件复制这个公钥码")]),t._v(" "),s("li",[t._v("添加这个码到"),s("code",[t._v("git")]),t._v("或者"),s("code",[t._v("gitee")]),t._v("上面的公钥设置即可")])]),t._v(" "),s("p",[t._v("接着回到项目根目录，添加远程仓库地址，然后提交")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("git remote add origin 你的远程仓库的ssh地址\ngit push origin master\n")])])]),s("h3",{attrs:{id:"_2-部署前的修改"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-部署前的修改","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 部署前的修改")]),t._v(" "),s("p",[t._v("在部署之，我们还要改一些内容")]),t._v(" "),s("p",[s("font",{attrs:{color:"#1E90FF"}},[s("strong",[t._v("① 修改正式环境的启动命令")])])],1),t._v(" "),s("p",[t._v("修改"),s("code",[t._v("package.json")]),t._v("中的"),s("code",[t._v("start")]),t._v("命令：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"start"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cross-env NODE_ENV=production node server.js"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("font",{attrs:{color:"#1E90FF"}},[s("strong",[t._v("② 修改回调地址")])])],1),t._v(" "),s("p",[t._v("回到"),s("code",[t._v("github")]),t._v("的设置当中去修改之前的回调地址，在"),s("code",[t._v("OAuth APPS")]),t._v("当中修改"),s("code",[t._v("Homepage URL")]),t._v("和"),s("code",[t._v("Authorization callback URL")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 修改前")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Homepage URL"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authorization callback URL"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("auth\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 修改后")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Homepage URL"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("你的域名\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authorization callback URL"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("你的域名"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("auth\n")])])]),s("p",[t._v("然后点击"),s("code",[t._v("Update Application")]),t._v("来更新设置")]),t._v(" "),s("p",[s("font",{attrs:{color:"#1E90FF"}},[s("strong",[t._v("③ 添加pm2的配置文件")])])],1),t._v(" "),s("p",[t._v("创建"),s("code",[t._v("ecosystem.config.js")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// pm2配置文件")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tapps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'next-project'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动在pm2的项目名称")]),t._v("\n\t\t\tscript"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./server.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动文件")]),t._v("\n\t\t\tinstance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1个实例")]),t._v("\n\t\t\tautorestart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 自动重启")]),t._v("\n\t\t\twatch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\tmax_memory_restart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1G'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用内存超过1G就重启")]),t._v("\n\t\t\tenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动server.js携带环境变量")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("以上的关于项目内容的修改，在修改后记得重新提交。")]),t._v(" "),s("h3",{attrs:{id:"_3-连接服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-连接服务器","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 连接服务器")]),t._v(" "),s("p",[s("font",{attrs:{color:"#1E90FF"}},[s("strong",[t._v("① 克隆项目")])])],1),t._v(" "),s("p",[t._v("在本地执行下面的命令：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("ssh 你的服务器的ip地址\n")])])]),s("p",[t._v("然后输入密码进入即可，当然也可以通过"),s("code",[t._v("X-shell")]),t._v("工具连接服务器都是可以的,然后将远程仓库中的项目克隆到服务器上面：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("git clone 你的远程仓库的ssh地址\n")])])]),s("p",[t._v("然后进入项目，使用下面的命令下载安装包：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("yarn\nyarn build\n")])])]),s("p",[s("font",{attrs:{color:"#1E90FF"}},[s("strong",[t._v("② nginx代理")])])],1),t._v(" "),s("p",[t._v("项目直接启动时无法通过外网访问的，因为"),s("code",[t._v("Linux")]),t._v("是一个安全的服务器，你要主动开启端口才行，但是我们可以使用"),s("code",[t._v("nginx")]),t._v("去代理")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("yum install nginx\ncd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])])]),s("p",[t._v("进入到"),s("code",[t._v("nginx")]),t._v("的文件目录可以看到有两个比较重要的文件是"),s("code",[t._v("conf.d")]),t._v("和"),s("code",[t._v("default.d")]),t._v("文件，然后"),s("code",[t._v("cd conf.d")]),t._v("中创建一个"),s("code",[t._v("next.conf")]),t._v("的文件，内容如下：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tlisten "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tlisten "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tserver_name 你的域名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\tlocation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tproxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tproxy_set_header Host $host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$server_port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("然后执行下面的命令重启"),s("code",[t._v("nginx")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("service reload nginx\n")])])]),s("p",[s("font",{attrs:{color:"#1E90FF"}},[s("strong",[t._v("③ 启动redis服务")])])],1),t._v(" "),s("p",[t._v("更新安装源来安装最新的包")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("sudo yum install epel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("release\nsudo yum update\n")])])]),s("p",[t._v("安装"),s("code",[t._v("redis")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("sudo yum install redis\n")])])]),s("p",[t._v("后台启动"),s("code",[t._v("redis")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("sudo systemctl start redis\n")])])]),s("p",[t._v("设置开机启动"),s("code",[t._v("redis")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("sudo systemctl enable redis\n")])])]),s("p",[t._v("如果是"),s("code",[t._v("ubuntu")]),t._v("我们就将上面所有命令当中的"),s("code",[t._v("yum")]),t._v("改成"),s("code",[t._v("apt-get")]),t._v("即可。")]),t._v(" "),s("p",[s("font",{attrs:{color:"#1E90FF"}},[s("strong",[t._v("④ pm2启动项目")])])],1),t._v(" "),s("p",[t._v("首先下载"),s("code",[t._v("pm2")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("npm i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g pm2\n")])])]),s("p",[t._v("然后在项目的根路径中启动：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("pm2 start ecosystem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n")])])]),s("p",[t._v("然后可以通过"),s("code",[t._v("pm2 list")]),t._v("来查看我们启动是否正确，正确的话，应该在列表中有"),s("code",[t._v("next-project")]),t._v("的启动状态为"),s("code",[t._v("online")])])])},[],!1,null,null,null);a.default=e.exports}}]);