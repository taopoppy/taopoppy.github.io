<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nextjs的基本使用 | TaoPoppy</title>
    <meta name="description" content="陶振川">
    <link rel="icon" href="/meta.png">
    
    <link rel="preload" href="/assets/css/0.styles.32e41c9b.css" as="style"><link rel="preload" href="/assets/js/app.1a394514.js" as="script"><link rel="preload" href="/assets/js/2.8304a06b.js" as="script"><link rel="preload" href="/assets/js/306.e2f7ad64.js" as="script"><link rel="prefetch" href="/assets/js/10.7aef26de.js"><link rel="prefetch" href="/assets/js/100.b6a5dbe3.js"><link rel="prefetch" href="/assets/js/101.4cf14517.js"><link rel="prefetch" href="/assets/js/102.a10509c8.js"><link rel="prefetch" href="/assets/js/103.725c83f9.js"><link rel="prefetch" href="/assets/js/104.4cf52e25.js"><link rel="prefetch" href="/assets/js/105.fa93d42c.js"><link rel="prefetch" href="/assets/js/106.bc4f6131.js"><link rel="prefetch" href="/assets/js/107.720518ec.js"><link rel="prefetch" href="/assets/js/108.73134973.js"><link rel="prefetch" href="/assets/js/109.074b05fb.js"><link rel="prefetch" href="/assets/js/11.0781fb51.js"><link rel="prefetch" href="/assets/js/110.fa287650.js"><link rel="prefetch" href="/assets/js/111.66cf0003.js"><link rel="prefetch" href="/assets/js/112.ec18ad13.js"><link rel="prefetch" href="/assets/js/113.45a7c13a.js"><link rel="prefetch" href="/assets/js/114.8ac723f2.js"><link rel="prefetch" href="/assets/js/115.519d8940.js"><link rel="prefetch" href="/assets/js/116.c52bde55.js"><link rel="prefetch" href="/assets/js/117.35c583ff.js"><link rel="prefetch" href="/assets/js/118.6b209cf4.js"><link rel="prefetch" href="/assets/js/119.a3bd3fcb.js"><link rel="prefetch" href="/assets/js/12.75f1c153.js"><link rel="prefetch" href="/assets/js/120.45c18f2c.js"><link rel="prefetch" href="/assets/js/121.f1335403.js"><link rel="prefetch" href="/assets/js/122.4ddc6efe.js"><link rel="prefetch" href="/assets/js/123.3fedcfb9.js"><link rel="prefetch" href="/assets/js/124.57c3d5fd.js"><link rel="prefetch" href="/assets/js/125.98bb56f7.js"><link rel="prefetch" href="/assets/js/126.b4e3e7bc.js"><link rel="prefetch" href="/assets/js/127.aa4e7f95.js"><link rel="prefetch" href="/assets/js/128.08be9111.js"><link rel="prefetch" href="/assets/js/129.c32609eb.js"><link rel="prefetch" href="/assets/js/13.a3141dde.js"><link rel="prefetch" href="/assets/js/130.a0c93b04.js"><link rel="prefetch" href="/assets/js/131.dfae9fea.js"><link rel="prefetch" href="/assets/js/132.74845e19.js"><link rel="prefetch" href="/assets/js/133.cb7fc263.js"><link rel="prefetch" href="/assets/js/134.f9ae184c.js"><link rel="prefetch" href="/assets/js/135.273e7372.js"><link rel="prefetch" href="/assets/js/136.1da93b8e.js"><link rel="prefetch" href="/assets/js/137.198dbe16.js"><link rel="prefetch" href="/assets/js/138.64fac690.js"><link rel="prefetch" href="/assets/js/139.ac7f9fdf.js"><link rel="prefetch" href="/assets/js/14.023d10f2.js"><link rel="prefetch" href="/assets/js/140.a6685c82.js"><link rel="prefetch" href="/assets/js/141.96f04b23.js"><link rel="prefetch" href="/assets/js/142.cc5f5520.js"><link rel="prefetch" href="/assets/js/143.9b28c5f0.js"><link rel="prefetch" href="/assets/js/144.b0527ead.js"><link rel="prefetch" href="/assets/js/145.dad8d1ad.js"><link rel="prefetch" href="/assets/js/146.37619b4e.js"><link rel="prefetch" href="/assets/js/147.51353321.js"><link rel="prefetch" href="/assets/js/148.b7dbbadc.js"><link rel="prefetch" href="/assets/js/149.01c189f9.js"><link rel="prefetch" href="/assets/js/15.1ead8c76.js"><link rel="prefetch" href="/assets/js/150.6999137d.js"><link rel="prefetch" href="/assets/js/151.36a45175.js"><link rel="prefetch" href="/assets/js/152.f4c8c0a3.js"><link rel="prefetch" href="/assets/js/153.f04f1cfa.js"><link rel="prefetch" href="/assets/js/154.11f667b0.js"><link rel="prefetch" href="/assets/js/155.3df246f1.js"><link rel="prefetch" href="/assets/js/156.95c2a81f.js"><link rel="prefetch" href="/assets/js/157.4c4e453a.js"><link rel="prefetch" href="/assets/js/158.ea143735.js"><link rel="prefetch" href="/assets/js/159.1851c143.js"><link rel="prefetch" href="/assets/js/16.588b8a18.js"><link rel="prefetch" href="/assets/js/160.8623fd27.js"><link rel="prefetch" href="/assets/js/161.9f3dde39.js"><link rel="prefetch" href="/assets/js/162.ec8ada30.js"><link rel="prefetch" href="/assets/js/163.578cd511.js"><link rel="prefetch" href="/assets/js/164.5f326c38.js"><link rel="prefetch" href="/assets/js/165.d6055e4f.js"><link rel="prefetch" href="/assets/js/166.a4b38932.js"><link rel="prefetch" href="/assets/js/167.6a25e6a6.js"><link rel="prefetch" href="/assets/js/168.11291db9.js"><link rel="prefetch" href="/assets/js/169.3a6aec97.js"><link rel="prefetch" href="/assets/js/17.dbb0117f.js"><link rel="prefetch" href="/assets/js/170.c1b92e05.js"><link rel="prefetch" href="/assets/js/171.f06cccdb.js"><link rel="prefetch" href="/assets/js/172.26661658.js"><link rel="prefetch" href="/assets/js/173.ce718757.js"><link rel="prefetch" href="/assets/js/174.425859ee.js"><link rel="prefetch" href="/assets/js/175.b334be38.js"><link rel="prefetch" href="/assets/js/176.d29c1ef4.js"><link rel="prefetch" href="/assets/js/177.61e20b4a.js"><link rel="prefetch" href="/assets/js/178.f79fe9c5.js"><link rel="prefetch" href="/assets/js/179.8ab2f01b.js"><link rel="prefetch" href="/assets/js/18.5178d2f1.js"><link rel="prefetch" href="/assets/js/180.e1f584e7.js"><link rel="prefetch" href="/assets/js/181.384f8b65.js"><link rel="prefetch" href="/assets/js/182.675d4534.js"><link rel="prefetch" href="/assets/js/183.a5314419.js"><link rel="prefetch" href="/assets/js/184.49a4f95b.js"><link rel="prefetch" href="/assets/js/185.39566276.js"><link rel="prefetch" href="/assets/js/186.faf772f8.js"><link rel="prefetch" href="/assets/js/187.5e40a002.js"><link rel="prefetch" href="/assets/js/188.e9a85c75.js"><link rel="prefetch" href="/assets/js/189.4f6300fd.js"><link rel="prefetch" href="/assets/js/19.a3a8a3b2.js"><link rel="prefetch" href="/assets/js/190.5395a82d.js"><link rel="prefetch" href="/assets/js/191.c37e69d9.js"><link rel="prefetch" href="/assets/js/192.49c5336c.js"><link rel="prefetch" href="/assets/js/193.8358c1f7.js"><link rel="prefetch" href="/assets/js/194.f3baad75.js"><link rel="prefetch" href="/assets/js/195.9b64acde.js"><link rel="prefetch" href="/assets/js/196.af79cfd2.js"><link rel="prefetch" href="/assets/js/197.83502b3c.js"><link rel="prefetch" href="/assets/js/198.79a30060.js"><link rel="prefetch" href="/assets/js/199.4a4580d8.js"><link rel="prefetch" href="/assets/js/20.f7956ee9.js"><link rel="prefetch" href="/assets/js/200.ea5edefe.js"><link rel="prefetch" href="/assets/js/201.ba9f6baf.js"><link rel="prefetch" href="/assets/js/202.a684e81a.js"><link rel="prefetch" href="/assets/js/203.f6ae36b1.js"><link rel="prefetch" href="/assets/js/204.1b7d15f6.js"><link rel="prefetch" href="/assets/js/205.886aa300.js"><link rel="prefetch" href="/assets/js/206.4c920afb.js"><link rel="prefetch" href="/assets/js/207.84ff34f5.js"><link rel="prefetch" href="/assets/js/208.869b1786.js"><link rel="prefetch" href="/assets/js/209.46e7bcd8.js"><link rel="prefetch" href="/assets/js/21.a7419b80.js"><link rel="prefetch" href="/assets/js/210.8ae86200.js"><link rel="prefetch" href="/assets/js/211.8f174712.js"><link rel="prefetch" href="/assets/js/212.13a1cfde.js"><link rel="prefetch" href="/assets/js/213.2623c8b3.js"><link rel="prefetch" href="/assets/js/214.5f6c13ce.js"><link rel="prefetch" href="/assets/js/215.239ee6c0.js"><link rel="prefetch" href="/assets/js/216.bb2ce7ff.js"><link rel="prefetch" href="/assets/js/217.0708a1bc.js"><link rel="prefetch" href="/assets/js/218.9b44a3a0.js"><link rel="prefetch" href="/assets/js/219.872ef7dc.js"><link rel="prefetch" href="/assets/js/22.c95b31e3.js"><link rel="prefetch" href="/assets/js/220.d16ceb67.js"><link rel="prefetch" href="/assets/js/221.405b655a.js"><link rel="prefetch" href="/assets/js/222.fcbd0075.js"><link rel="prefetch" href="/assets/js/223.e48f31f2.js"><link rel="prefetch" href="/assets/js/224.f5562fa5.js"><link rel="prefetch" href="/assets/js/225.4c58f939.js"><link rel="prefetch" href="/assets/js/226.84e6ccf6.js"><link rel="prefetch" href="/assets/js/227.307e3114.js"><link rel="prefetch" href="/assets/js/228.f4bc2989.js"><link rel="prefetch" href="/assets/js/229.96ea2ba2.js"><link rel="prefetch" href="/assets/js/23.a75f3ddc.js"><link rel="prefetch" href="/assets/js/230.2ae85257.js"><link rel="prefetch" href="/assets/js/231.78d7510d.js"><link rel="prefetch" href="/assets/js/232.f5bf4f67.js"><link rel="prefetch" href="/assets/js/233.9102fdaa.js"><link rel="prefetch" href="/assets/js/234.a9e5e11a.js"><link rel="prefetch" href="/assets/js/235.71426295.js"><link rel="prefetch" href="/assets/js/236.03474465.js"><link rel="prefetch" href="/assets/js/237.48aed7b3.js"><link rel="prefetch" href="/assets/js/238.6a271b50.js"><link rel="prefetch" href="/assets/js/239.28d2a86b.js"><link rel="prefetch" href="/assets/js/24.84641855.js"><link rel="prefetch" href="/assets/js/240.22bca10d.js"><link rel="prefetch" href="/assets/js/241.2a279198.js"><link rel="prefetch" href="/assets/js/242.43b24484.js"><link rel="prefetch" href="/assets/js/243.fe9d5ea9.js"><link rel="prefetch" href="/assets/js/244.d39e950f.js"><link rel="prefetch" href="/assets/js/245.64db6d12.js"><link rel="prefetch" href="/assets/js/246.5b1f1745.js"><link rel="prefetch" href="/assets/js/247.d1ab0e2b.js"><link rel="prefetch" href="/assets/js/248.a19e36bd.js"><link rel="prefetch" href="/assets/js/249.3aa723c7.js"><link rel="prefetch" href="/assets/js/25.73570942.js"><link rel="prefetch" href="/assets/js/250.0f968bec.js"><link rel="prefetch" href="/assets/js/251.9ade3872.js"><link rel="prefetch" href="/assets/js/252.72e1aa12.js"><link rel="prefetch" href="/assets/js/253.374cc99e.js"><link rel="prefetch" href="/assets/js/254.44800bf9.js"><link rel="prefetch" href="/assets/js/255.06241cb8.js"><link rel="prefetch" href="/assets/js/256.bbeaafaa.js"><link rel="prefetch" href="/assets/js/257.14e8b661.js"><link rel="prefetch" href="/assets/js/258.0913e120.js"><link rel="prefetch" href="/assets/js/259.32bd3bf9.js"><link rel="prefetch" href="/assets/js/26.9a79c041.js"><link rel="prefetch" href="/assets/js/260.e5a40c02.js"><link rel="prefetch" href="/assets/js/261.4c8be7b1.js"><link rel="prefetch" href="/assets/js/262.0663f55e.js"><link rel="prefetch" href="/assets/js/263.cecc1123.js"><link rel="prefetch" href="/assets/js/264.d2209296.js"><link rel="prefetch" href="/assets/js/265.497bc01b.js"><link rel="prefetch" href="/assets/js/266.769ac5e0.js"><link rel="prefetch" href="/assets/js/267.6b97962f.js"><link rel="prefetch" href="/assets/js/268.fa6635c8.js"><link rel="prefetch" href="/assets/js/269.c1e74469.js"><link rel="prefetch" href="/assets/js/27.0dd62438.js"><link rel="prefetch" href="/assets/js/270.4e8f8d77.js"><link rel="prefetch" href="/assets/js/271.f27f2f56.js"><link rel="prefetch" href="/assets/js/272.d1349876.js"><link rel="prefetch" href="/assets/js/273.e967ea79.js"><link rel="prefetch" href="/assets/js/274.7c9df4ce.js"><link rel="prefetch" href="/assets/js/275.5b85e62c.js"><link rel="prefetch" href="/assets/js/276.c09ef549.js"><link rel="prefetch" href="/assets/js/277.58b59a93.js"><link rel="prefetch" href="/assets/js/278.e91f9b01.js"><link rel="prefetch" href="/assets/js/279.3159509a.js"><link rel="prefetch" href="/assets/js/28.685ccac3.js"><link rel="prefetch" href="/assets/js/280.8878bc0d.js"><link rel="prefetch" href="/assets/js/281.c7e08ecb.js"><link rel="prefetch" href="/assets/js/282.85066f7c.js"><link rel="prefetch" href="/assets/js/283.80120ef1.js"><link rel="prefetch" href="/assets/js/284.1f719606.js"><link rel="prefetch" href="/assets/js/285.b4a3cea5.js"><link rel="prefetch" href="/assets/js/286.2ebd0b34.js"><link rel="prefetch" href="/assets/js/287.8e141966.js"><link rel="prefetch" href="/assets/js/288.ea2f74f5.js"><link rel="prefetch" href="/assets/js/289.beba8c8e.js"><link rel="prefetch" href="/assets/js/29.d9a2cd59.js"><link rel="prefetch" href="/assets/js/290.fd587ae1.js"><link rel="prefetch" href="/assets/js/291.e0b87667.js"><link rel="prefetch" href="/assets/js/292.d86d8fa2.js"><link rel="prefetch" href="/assets/js/293.f176a900.js"><link rel="prefetch" href="/assets/js/294.536a81c8.js"><link rel="prefetch" href="/assets/js/295.54f88831.js"><link rel="prefetch" href="/assets/js/296.7c5ad5dd.js"><link rel="prefetch" href="/assets/js/297.cf9a4601.js"><link rel="prefetch" href="/assets/js/298.a844a174.js"><link rel="prefetch" href="/assets/js/299.809942fc.js"><link rel="prefetch" href="/assets/js/3.5dd59f66.js"><link rel="prefetch" href="/assets/js/30.1ca80117.js"><link rel="prefetch" href="/assets/js/300.bc9809ff.js"><link rel="prefetch" href="/assets/js/301.d677b5b5.js"><link rel="prefetch" href="/assets/js/302.aa40279f.js"><link rel="prefetch" href="/assets/js/303.070e632e.js"><link rel="prefetch" href="/assets/js/304.3d695df8.js"><link rel="prefetch" href="/assets/js/305.44e261e9.js"><link rel="prefetch" href="/assets/js/307.83982154.js"><link rel="prefetch" href="/assets/js/308.4db5bbe7.js"><link rel="prefetch" href="/assets/js/309.3aa975c1.js"><link rel="prefetch" href="/assets/js/31.440aa4c9.js"><link rel="prefetch" href="/assets/js/310.614e3c2f.js"><link rel="prefetch" href="/assets/js/311.ebda45a9.js"><link rel="prefetch" href="/assets/js/312.52cdf585.js"><link rel="prefetch" href="/assets/js/313.1f984642.js"><link rel="prefetch" href="/assets/js/314.fd4722eb.js"><link rel="prefetch" href="/assets/js/315.14d7045f.js"><link rel="prefetch" href="/assets/js/316.8f4cc226.js"><link rel="prefetch" href="/assets/js/317.21630e12.js"><link rel="prefetch" href="/assets/js/318.9a5c960e.js"><link rel="prefetch" href="/assets/js/319.06f7dacf.js"><link rel="prefetch" href="/assets/js/32.27f34442.js"><link rel="prefetch" href="/assets/js/320.e426fea5.js"><link rel="prefetch" href="/assets/js/321.46a426b9.js"><link rel="prefetch" href="/assets/js/322.7256b9c8.js"><link rel="prefetch" href="/assets/js/323.5b848b7f.js"><link rel="prefetch" href="/assets/js/324.e8eedaac.js"><link rel="prefetch" href="/assets/js/325.54947978.js"><link rel="prefetch" href="/assets/js/326.03bfd5b9.js"><link rel="prefetch" href="/assets/js/327.34a2ec4d.js"><link rel="prefetch" href="/assets/js/328.4e023633.js"><link rel="prefetch" href="/assets/js/329.b218e68f.js"><link rel="prefetch" href="/assets/js/33.f6658b03.js"><link rel="prefetch" href="/assets/js/330.a8a2750a.js"><link rel="prefetch" href="/assets/js/331.0df9ca3a.js"><link rel="prefetch" href="/assets/js/332.95c19161.js"><link rel="prefetch" href="/assets/js/333.c6e765b9.js"><link rel="prefetch" href="/assets/js/334.c79e3b52.js"><link rel="prefetch" href="/assets/js/335.49fcd3ab.js"><link rel="prefetch" href="/assets/js/336.5c2ccd1d.js"><link rel="prefetch" href="/assets/js/337.fd6692e6.js"><link rel="prefetch" href="/assets/js/338.e0f59f10.js"><link rel="prefetch" href="/assets/js/339.04196614.js"><link rel="prefetch" href="/assets/js/34.17b5b881.js"><link rel="prefetch" href="/assets/js/340.05e21d65.js"><link rel="prefetch" href="/assets/js/341.15ff2a62.js"><link rel="prefetch" href="/assets/js/342.ae7694ad.js"><link rel="prefetch" href="/assets/js/343.f4a5186c.js"><link rel="prefetch" href="/assets/js/344.4caf3fa0.js"><link rel="prefetch" href="/assets/js/345.214e2189.js"><link rel="prefetch" href="/assets/js/346.f613921f.js"><link rel="prefetch" href="/assets/js/347.626136bf.js"><link rel="prefetch" href="/assets/js/348.cf4b86a4.js"><link rel="prefetch" href="/assets/js/349.2a62c487.js"><link rel="prefetch" href="/assets/js/35.e99d5a01.js"><link rel="prefetch" href="/assets/js/350.389648a3.js"><link rel="prefetch" href="/assets/js/351.81305cad.js"><link rel="prefetch" href="/assets/js/352.d7a80ffa.js"><link rel="prefetch" href="/assets/js/353.0929bd7f.js"><link rel="prefetch" href="/assets/js/354.87d7184c.js"><link rel="prefetch" href="/assets/js/355.1dd69433.js"><link rel="prefetch" href="/assets/js/356.b969449b.js"><link rel="prefetch" href="/assets/js/357.16cecac1.js"><link rel="prefetch" href="/assets/js/358.ef6c9df0.js"><link rel="prefetch" href="/assets/js/359.8b33b863.js"><link rel="prefetch" href="/assets/js/36.8e7e289a.js"><link rel="prefetch" href="/assets/js/360.089cc7ad.js"><link rel="prefetch" href="/assets/js/361.9a59c5c5.js"><link rel="prefetch" href="/assets/js/362.a8026d31.js"><link rel="prefetch" href="/assets/js/363.c3bb2718.js"><link rel="prefetch" href="/assets/js/364.62014d33.js"><link rel="prefetch" href="/assets/js/365.00a229da.js"><link rel="prefetch" href="/assets/js/366.5c57901c.js"><link rel="prefetch" href="/assets/js/367.ad1d6755.js"><link rel="prefetch" href="/assets/js/368.64dc7bec.js"><link rel="prefetch" href="/assets/js/369.406cd3d7.js"><link rel="prefetch" href="/assets/js/37.4f733baf.js"><link rel="prefetch" href="/assets/js/370.750f2303.js"><link rel="prefetch" href="/assets/js/371.6cc0e13d.js"><link rel="prefetch" href="/assets/js/372.ed729131.js"><link rel="prefetch" href="/assets/js/373.c369c4c9.js"><link rel="prefetch" href="/assets/js/374.d3a57fb2.js"><link rel="prefetch" href="/assets/js/375.21d68193.js"><link rel="prefetch" href="/assets/js/376.25d9d5f3.js"><link rel="prefetch" href="/assets/js/377.c7ebd0c2.js"><link rel="prefetch" href="/assets/js/378.c733ec30.js"><link rel="prefetch" href="/assets/js/379.d6cf1c34.js"><link rel="prefetch" href="/assets/js/38.86de11d5.js"><link rel="prefetch" href="/assets/js/380.9abd3090.js"><link rel="prefetch" href="/assets/js/381.1fc3ec03.js"><link rel="prefetch" href="/assets/js/382.d0d2e795.js"><link rel="prefetch" href="/assets/js/383.bd308361.js"><link rel="prefetch" href="/assets/js/384.c2a5969a.js"><link rel="prefetch" href="/assets/js/385.20c11f56.js"><link rel="prefetch" href="/assets/js/386.631b9af2.js"><link rel="prefetch" href="/assets/js/387.8f59e0b5.js"><link rel="prefetch" href="/assets/js/388.5b1951cd.js"><link rel="prefetch" href="/assets/js/389.2e942f96.js"><link rel="prefetch" href="/assets/js/39.153b6ec6.js"><link rel="prefetch" href="/assets/js/390.341a807c.js"><link rel="prefetch" href="/assets/js/391.c9bd676c.js"><link rel="prefetch" href="/assets/js/392.ac05ebea.js"><link rel="prefetch" href="/assets/js/393.6989a857.js"><link rel="prefetch" href="/assets/js/394.744402ae.js"><link rel="prefetch" href="/assets/js/395.a0636831.js"><link rel="prefetch" href="/assets/js/396.9e92309a.js"><link rel="prefetch" href="/assets/js/397.867afb5d.js"><link rel="prefetch" href="/assets/js/398.261fe9bc.js"><link rel="prefetch" href="/assets/js/399.83573ac7.js"><link rel="prefetch" href="/assets/js/4.1b11a2b1.js"><link rel="prefetch" href="/assets/js/40.77cd485e.js"><link rel="prefetch" href="/assets/js/400.333909ad.js"><link rel="prefetch" href="/assets/js/401.9c9ae0ae.js"><link rel="prefetch" href="/assets/js/402.50b49502.js"><link rel="prefetch" href="/assets/js/403.c0d1aa14.js"><link rel="prefetch" href="/assets/js/404.24e4f5ba.js"><link rel="prefetch" href="/assets/js/405.09e8422c.js"><link rel="prefetch" href="/assets/js/406.1e91805d.js"><link rel="prefetch" href="/assets/js/407.2393ac65.js"><link rel="prefetch" href="/assets/js/408.e0df89f7.js"><link rel="prefetch" href="/assets/js/409.58e7dc26.js"><link rel="prefetch" href="/assets/js/41.67fda662.js"><link rel="prefetch" href="/assets/js/410.e9c06b6a.js"><link rel="prefetch" href="/assets/js/411.bbe28a09.js"><link rel="prefetch" href="/assets/js/412.44a068c9.js"><link rel="prefetch" href="/assets/js/413.b76704b3.js"><link rel="prefetch" href="/assets/js/414.32590ba0.js"><link rel="prefetch" href="/assets/js/415.60884e6d.js"><link rel="prefetch" href="/assets/js/416.119019d8.js"><link rel="prefetch" href="/assets/js/417.277cf86c.js"><link rel="prefetch" href="/assets/js/418.fb313fbc.js"><link rel="prefetch" href="/assets/js/419.3eba15ec.js"><link rel="prefetch" href="/assets/js/42.7e56f2cd.js"><link rel="prefetch" href="/assets/js/420.c6d3f2a0.js"><link rel="prefetch" href="/assets/js/421.0939406a.js"><link rel="prefetch" href="/assets/js/422.f9975cec.js"><link rel="prefetch" href="/assets/js/423.fb455c5f.js"><link rel="prefetch" href="/assets/js/424.01dea30b.js"><link rel="prefetch" href="/assets/js/425.ae78c193.js"><link rel="prefetch" href="/assets/js/426.01ffc131.js"><link rel="prefetch" href="/assets/js/427.ca692320.js"><link rel="prefetch" href="/assets/js/428.db29a47a.js"><link rel="prefetch" href="/assets/js/429.954aaaf1.js"><link rel="prefetch" href="/assets/js/43.d0246dae.js"><link rel="prefetch" href="/assets/js/430.b2c8abce.js"><link rel="prefetch" href="/assets/js/431.238123f0.js"><link rel="prefetch" href="/assets/js/432.459a70b6.js"><link rel="prefetch" href="/assets/js/433.ec112349.js"><link rel="prefetch" href="/assets/js/434.d11bf56d.js"><link rel="prefetch" href="/assets/js/435.98d79cdc.js"><link rel="prefetch" href="/assets/js/436.78b0e462.js"><link rel="prefetch" href="/assets/js/437.17bafd8b.js"><link rel="prefetch" href="/assets/js/438.462d1929.js"><link rel="prefetch" href="/assets/js/439.1f5c292d.js"><link rel="prefetch" href="/assets/js/44.eb3d088f.js"><link rel="prefetch" href="/assets/js/440.b139dc54.js"><link rel="prefetch" href="/assets/js/441.2fae1d62.js"><link rel="prefetch" href="/assets/js/45.39adc1d2.js"><link rel="prefetch" href="/assets/js/46.93061422.js"><link rel="prefetch" href="/assets/js/47.0dc9e596.js"><link rel="prefetch" href="/assets/js/48.68f070d6.js"><link rel="prefetch" href="/assets/js/49.a29d9572.js"><link rel="prefetch" href="/assets/js/5.37e3a575.js"><link rel="prefetch" href="/assets/js/50.0b46a629.js"><link rel="prefetch" href="/assets/js/51.c7712d08.js"><link rel="prefetch" href="/assets/js/52.8fdf333b.js"><link rel="prefetch" href="/assets/js/53.1e5f8a94.js"><link rel="prefetch" href="/assets/js/54.41216d39.js"><link rel="prefetch" href="/assets/js/55.34d14bf4.js"><link rel="prefetch" href="/assets/js/56.b7d3b6ca.js"><link rel="prefetch" href="/assets/js/57.9646b246.js"><link rel="prefetch" href="/assets/js/58.5446709c.js"><link rel="prefetch" href="/assets/js/59.0fac1fa2.js"><link rel="prefetch" href="/assets/js/6.41004de5.js"><link rel="prefetch" href="/assets/js/60.8a2d1be8.js"><link rel="prefetch" href="/assets/js/61.77eca8ce.js"><link rel="prefetch" href="/assets/js/62.277c8f17.js"><link rel="prefetch" href="/assets/js/63.8b203bb2.js"><link rel="prefetch" href="/assets/js/64.d466d2b9.js"><link rel="prefetch" href="/assets/js/65.7c4cb8d5.js"><link rel="prefetch" href="/assets/js/66.71b38fe1.js"><link rel="prefetch" href="/assets/js/67.e0b107a2.js"><link rel="prefetch" href="/assets/js/68.7d64bb4b.js"><link rel="prefetch" href="/assets/js/69.9cdbcfeb.js"><link rel="prefetch" href="/assets/js/7.67d94aac.js"><link rel="prefetch" href="/assets/js/70.eb1c9224.js"><link rel="prefetch" href="/assets/js/71.51e0c37c.js"><link rel="prefetch" href="/assets/js/72.cba6948f.js"><link rel="prefetch" href="/assets/js/73.6abd4dce.js"><link rel="prefetch" href="/assets/js/74.b5fa6c08.js"><link rel="prefetch" href="/assets/js/75.8f34d79a.js"><link rel="prefetch" href="/assets/js/76.5fc9c80d.js"><link rel="prefetch" href="/assets/js/77.6e4a5e93.js"><link rel="prefetch" href="/assets/js/78.bffd6a40.js"><link rel="prefetch" href="/assets/js/79.1a7f5d0e.js"><link rel="prefetch" href="/assets/js/8.e4995b94.js"><link rel="prefetch" href="/assets/js/80.b70c1106.js"><link rel="prefetch" href="/assets/js/81.4476a49e.js"><link rel="prefetch" href="/assets/js/82.f40aa218.js"><link rel="prefetch" href="/assets/js/83.d4c57d4f.js"><link rel="prefetch" href="/assets/js/84.d1dc86f7.js"><link rel="prefetch" href="/assets/js/85.dd779a2e.js"><link rel="prefetch" href="/assets/js/86.569cfbc2.js"><link rel="prefetch" href="/assets/js/87.938a5bd8.js"><link rel="prefetch" href="/assets/js/88.2d3dadd7.js"><link rel="prefetch" href="/assets/js/89.3aeee704.js"><link rel="prefetch" href="/assets/js/9.54a41cce.js"><link rel="prefetch" href="/assets/js/90.2b47965b.js"><link rel="prefetch" href="/assets/js/91.58aa3587.js"><link rel="prefetch" href="/assets/js/92.47d2a191.js"><link rel="prefetch" href="/assets/js/93.ff10ac69.js"><link rel="prefetch" href="/assets/js/94.a8d90c0c.js"><link rel="prefetch" href="/assets/js/95.15ae9c48.js"><link rel="prefetch" href="/assets/js/96.43aa4adb.js"><link rel="prefetch" href="/assets/js/97.4eb74c93.js"><link rel="prefetch" href="/assets/js/98.94686ad8.js"><link rel="prefetch" href="/assets/js/99.ceb4f2f1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.32e41c9b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">TaoPoppy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/learnMaterials/" class="nav-link">资料</a></div><div class="nav-item"><a href="https://github.com/taopoppy/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/construct/" class="nav-link">小技巧</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/WeiXin-Rumen/" class="nav-link">微信小程序入门和实战</a></li><li class="dropdown-item"><!----> <a href="/Weixin-quanzhan/" class="nav-link">微信小程序全栈开发实战</a></li><li class="dropdown-item"><!----> <a href="/WeiXin-Combat/" class="nav-link">微信小程序云开发实战</a></li><li class="dropdown-item"><!----> <a href="/WeiXin-money/" class="nav-link">微信支付和分享</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Jest/" class="nav-link">前端自动化测试</a></li><li class="dropdown-item"><!----> <a href="/Webpack/" class="nav-link">前端工程化</a></li><li class="dropdown-item"><!----> <a href="/Optimization/" class="nav-link">前端性能优化</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Go</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/go/" class="nav-link">go语言入门实践</a></li><li class="dropdown-item"><!----> <a href="/go-concurrent/" class="nav-link">go并发编程详解</a></li><li class="dropdown-item"><!----> <a href="/go-web/" class="nav-link">go与web编程实战</a></li><li class="dropdown-item"><!----> <a href="/go-reptile/" class="nav-link">go爬虫编程实战</a></li><li class="dropdown-item"><!----> <a href="/Beego/" class="nav-link">Beego框架入门</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">node</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">node入门</a></li><li class="dropdown-item"><!----> <a href="/node-RESTful/" class="nav-link">node与RESTful</a></li><li class="dropdown-item"><!----> <a href="/node-GraphQL/" class="nav-link">node与GraphQL</a></li><li class="dropdown-item"><!----> <a href="/node-BFF/" class="nav-link">node与BFF</a></li><li class="dropdown-item"><!----> <a href="/node-blog/" class="nav-link">node博客后台</a></li><li class="dropdown-item"><!----> <a href="/node-weibo/" class="nav-link">node实战微博</a></li><li class="dropdown-item"><!----> <a href="/node-microService/" class="nav-link">node微服务</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">react</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react-redux/" class="nav-link">React+Redux入门详解</a></li><li class="dropdown-item"><!----> <a href="/react-typescript/" class="nav-link">React+TypeScript的完美结合</a></li><li class="dropdown-item"><!----> <a href="/react-webapp/" class="nav-link">React网易云Webapp</a></li><li class="dropdown-item"><!----> <a href="/react-ssr/" class="nav-link router-link-active">React服务器渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/react-source/" class="nav-link">React深度剖析和源码解析</a></li><li class="dropdown-item"><!----> <a href="/react-antd/" class="nav-link">React+Typescript开发组件库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-ssr/" class="nav-link">Vue服务端渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/vue-interview/" class="nav-link">Vue3入门和实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Mysql/" class="nav-link">mysql</a></li><li class="dropdown-subitem"><a href="/Mysql-Architecture/" class="nav-link">mysql-Architecture</a></li></ul></li><li class="dropdown-item"><h4>linux操作系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Linux/" class="nav-link">linux</a></li><li class="dropdown-subitem"><a href="/Linux-Architecture/" class="nav-link">linux-Architecture</a></li></ul></li><li class="dropdown-item"><h4>网络协议</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Protocol/" class="nav-link">protocol</a></li><li class="dropdown-subitem"><a href="/react-ssr/font-end-protocol.html" class="nav-link">font-end-protocol</a></li></ul></li><li class="dropdown-item"><h4>运维系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/prometheus/" class="nav-link">prometheus</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end/" class="nav-link">前端初级面试</a></li><li class="dropdown-item"><!----> <a href="/Front-advance/" class="nav-link">前端中级面试</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">究极全栈</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Big-Front-End/" class="nav-link">大前端</a></li><li class="dropdown-item"><!----> <a href="/Web-Architect/" class="nav-link">web架构课</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/learnMaterials/" class="nav-link">资料</a></div><div class="nav-item"><a href="https://github.com/taopoppy/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/construct/" class="nav-link">小技巧</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/WeiXin-Rumen/" class="nav-link">微信小程序入门和实战</a></li><li class="dropdown-item"><!----> <a href="/Weixin-quanzhan/" class="nav-link">微信小程序全栈开发实战</a></li><li class="dropdown-item"><!----> <a href="/WeiXin-Combat/" class="nav-link">微信小程序云开发实战</a></li><li class="dropdown-item"><!----> <a href="/WeiXin-money/" class="nav-link">微信支付和分享</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Jest/" class="nav-link">前端自动化测试</a></li><li class="dropdown-item"><!----> <a href="/Webpack/" class="nav-link">前端工程化</a></li><li class="dropdown-item"><!----> <a href="/Optimization/" class="nav-link">前端性能优化</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Go</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/go/" class="nav-link">go语言入门实践</a></li><li class="dropdown-item"><!----> <a href="/go-concurrent/" class="nav-link">go并发编程详解</a></li><li class="dropdown-item"><!----> <a href="/go-web/" class="nav-link">go与web编程实战</a></li><li class="dropdown-item"><!----> <a href="/go-reptile/" class="nav-link">go爬虫编程实战</a></li><li class="dropdown-item"><!----> <a href="/Beego/" class="nav-link">Beego框架入门</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">node</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">node入门</a></li><li class="dropdown-item"><!----> <a href="/node-RESTful/" class="nav-link">node与RESTful</a></li><li class="dropdown-item"><!----> <a href="/node-GraphQL/" class="nav-link">node与GraphQL</a></li><li class="dropdown-item"><!----> <a href="/node-BFF/" class="nav-link">node与BFF</a></li><li class="dropdown-item"><!----> <a href="/node-blog/" class="nav-link">node博客后台</a></li><li class="dropdown-item"><!----> <a href="/node-weibo/" class="nav-link">node实战微博</a></li><li class="dropdown-item"><!----> <a href="/node-microService/" class="nav-link">node微服务</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">react</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react-redux/" class="nav-link">React+Redux入门详解</a></li><li class="dropdown-item"><!----> <a href="/react-typescript/" class="nav-link">React+TypeScript的完美结合</a></li><li class="dropdown-item"><!----> <a href="/react-webapp/" class="nav-link">React网易云Webapp</a></li><li class="dropdown-item"><!----> <a href="/react-ssr/" class="nav-link router-link-active">React服务器渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/react-source/" class="nav-link">React深度剖析和源码解析</a></li><li class="dropdown-item"><!----> <a href="/react-antd/" class="nav-link">React+Typescript开发组件库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-ssr/" class="nav-link">Vue服务端渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/vue-interview/" class="nav-link">Vue3入门和实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Mysql/" class="nav-link">mysql</a></li><li class="dropdown-subitem"><a href="/Mysql-Architecture/" class="nav-link">mysql-Architecture</a></li></ul></li><li class="dropdown-item"><h4>linux操作系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Linux/" class="nav-link">linux</a></li><li class="dropdown-subitem"><a href="/Linux-Architecture/" class="nav-link">linux-Architecture</a></li></ul></li><li class="dropdown-item"><h4>网络协议</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Protocol/" class="nav-link">protocol</a></li><li class="dropdown-subitem"><a href="/react-ssr/font-end-protocol.html" class="nav-link">font-end-protocol</a></li></ul></li><li class="dropdown-item"><h4>运维系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/prometheus/" class="nav-link">prometheus</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end/" class="nav-link">前端初级面试</a></li><li class="dropdown-item"><!----> <a href="/Front-advance/" class="nav-link">前端中级面试</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">究极全栈</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Big-Front-End/" class="nav-link">大前端</a></li><li class="dropdown-item"><!----> <a href="/Web-Architect/" class="nav-link">web架构课</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/react-ssr/" class="sidebar-link">React 服务端渲染</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React_SSR_原理基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React_SSR_原理进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React_SSR_原理高级</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React_SSR_实战基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react-ssr/ssr_combat_project_one.html" class="sidebar-link">项目搭建流程</a></li><li><a href="/react-ssr/ssr_combat_project_two.html" class="active sidebar-link">nextjs的基本使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#目录结构" class="sidebar-link">目录结构</a></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#路由相关" class="sidebar-link">路由相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#_1-页面跳转" class="sidebar-link">1. 页面跳转</a></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#_2-动态路由" class="sidebar-link">2. 动态路由</a></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#_3-路由映射" class="sidebar-link">3. 路由映射</a></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#_4-路由变化的钩子" class="sidebar-link">4. 路由变化的钩子</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#获取数据" class="sidebar-link">获取数据</a></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#自定义" class="sidebar-link">自定义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#_1-app自定义" class="sidebar-link">1. App自定义</a></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#_2-document自定义" class="sidebar-link">2. Document自定义</a></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#_3-样式自定义" class="sidebar-link">3. 样式自定义</a></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#_4-继承styled-components" class="sidebar-link">4. 继承styled-components</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#异步和组件加载" class="sidebar-link">异步和组件加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#_1-异步加载模块" class="sidebar-link">1. 异步加载模块</a></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#_2-异步加载组件" class="sidebar-link">2. 异步加载组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#配置项" class="sidebar-link">配置项</a></li><li class="sidebar-sub-header"><a href="/react-ssr/ssr_combat_project_two.html#nextjs渲染流程" class="sidebar-link">nextjs渲染流程</a></li></ul></li><li><a href="/react-ssr/ssr_combat_project_three.html" class="sidebar-link">Hook新特性</a></li><li><a href="/react-ssr/ssr_combat_project_four.html" class="sidebar-link">引入Redux</a></li><li><a href="/react-ssr/ssr_combat_project_five.html" class="sidebar-link">OAuth接入</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React_SSR_实战项目</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nextjs的基本使用"><a href="#nextjs的基本使用" aria-hidden="true" class="header-anchor">#</a> nextjs的基本使用</h1> <h2 id="目录结构"><a href="#目录结构" aria-hidden="true" class="header-anchor">#</a> 目录结构</h2> <p>在<code>next</code>项目当中，<code>Pages</code>目录是特别重要的一个目录，<font color="#DD1144">这里面所有的文件都会对应于一个页面，next为我们生成的路由的配置是根据pages文件夹下面的文件目录来产生的</font>，其中的<code>index.js</code>文件是默认的访问根路径的页面，也就是说访问<code>localhost:3000/</code>和<code>localhost:3000/index</code>都访问的是这个页面。还比如访问<code>localhost:3000/a</code>这个路径实际上访问的就是项目当中<code>pages/a.js</code>当中的内容，还比如访问<code>localhost:3000/text/b</code>，实际上访问的就是<code>pages</code>文件夹中的<code>text</code>文件夹中的<code>b.js</code>文件中的内容</p> <p>但是也有例外，<code>pages/_app.js</code>和<code>pages/_document.js</code>这两个文件是个例外，这两个文件我们在后面再具体解释它的含义的作用。我们来解释一下项目中其他文件夹的作用：</p> <ul><li><font color="#9400D3">components</font>：存放公用性的组件</li> <li><font color="#9400D3">lib</font>：存放其他非组件性的公用性代码，比如一些工具代码，类库代码</li> <li><font color="#9400D3">static</font>：存放静态资源代码</li></ul> <p>上面这些我们自己创建的文件夹的名称都可以自定义，因为在<code>pages</code>中的<code>js</code>文件使用他们都是通过相对路径的方式去引入的，所以比较灵活。还有一些其他的文件：</p> <ul><li><font color="#9400D3">.next</font>：<code>next.js</code>框架自己生成的文件夹，启动服务后<code>next</code>编译后的东西都会放在这里，实际上在生产环境的时候也是通过<code>next build</code>生成这样一个<code>.next</code>的文件夹，通过里面的东西提供服务和页面显示，是根据你自己书写的代码实时改变的，所以我们不应该随便修改它。</li></ul> <h2 id="路由相关"><a href="#路由相关" aria-hidden="true" class="header-anchor">#</a> 路由相关</h2> <h3 id="_1-页面跳转"><a href="#_1-页面跳转" aria-hidden="true" class="header-anchor">#</a> 1. 页面跳转</h3> <p><font color="#1E90FF"><strong>① Link组件</strong></font></p> <p>如何进行页面跳转呢，需要使用到<code>next</code>提供给我们的一个<font color="#DD1144">Link</font>组件:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/index.js</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span> <span class="token comment">// 1. 引入Link组件</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
	<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">'/a'</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>index<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token comment">/*2. 使用Link组件，Link本身不渲染任何东西*/</span><span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><ul><li><font color="#DD1144">next当中的页面跳转是没有浏览器重新加载页面的过程的，而是前端跳转</font></li> <li><font color="#DD1144">next提供的Link标签本身是不渲染任何内容的，并不是a标签的封装，所以需要制定渲染内容，它自己只负责监听渲染内容的点击事件而已，凡是可以接收onClick事件的组件都可以作为渲染内容传入Link</font></li> <li><font color="#DD1144">Link标签只能接受一个根节点内容</font></li></ul> <p><font color="#1E90FF"><strong>② Router模块</strong></font></p> <p>还有一种方式是通过<code>Router</code>模块去跳转，<font color="#DD1144">实际上Link的本质也是Router模块方法的封装，隐藏了一些方法的调用，让开发者更方便的使用而已</font>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/index.js</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'next/router'</span> <span class="token comment">// 1. 引入Router模块</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">function</span> <span class="token function">gotoTestB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		Router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/test/b'</span><span class="token punctuation">)</span> <span class="token comment">// 2. 使用Router.push进行路由的跳转</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">'/a'</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>index<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span>gotoTestB<span class="token punctuation">}</span><span class="token operator">&gt;</span>text b<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-动态路由"><a href="#_2-动态路由" aria-hidden="true" class="header-anchor">#</a> 2. 动态路由</h3> <p>在路由跳转的时候，有的时候我们是希望携带一些信息过去的，页面上的信息可以根据路由上携带的信息动态的显示的，所以是动态路由，<font color="#1E90FF">而在next当中想实现路由的信息附带是只能通过query的，而不能像react-router当中可以在路由当中定义params的的。因为next当中的路由实际上是根据pages当中的文件结构生成的，所以无法做到/:id这种parmas形式的路由</font></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/index.js</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'next/router'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">function</span> <span class="token function">gotoTestB</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">===</span> <span class="token string">'b'</span><span class="token punctuation">)</span> Router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/test/b?id=b'</span><span class="token punctuation">)</span>  <span class="token comment">// 字符串形式的路由:localhost:3000/test/b?id=b</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">===</span> <span class="token string">'c'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			Router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>   <span class="token comment">// 对象形式的路由:localhost:3000/test/b?id=c</span>
				pathname<span class="token punctuation">:</span> <span class="token string">'/test/b'</span><span class="token punctuation">,</span>
				query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
					id<span class="token punctuation">:</span> <span class="token string">'c'</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">'/a?id=a'</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>index<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token comment">/*可以直接在Link当中书写完整的路径 */</span><span class="token punctuation">}</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">gotoTestB</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>text b<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">gotoTestB</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>text c<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>那么跳转的时候携带了信息，到了被跳转的页面中，怎么拿到前页面携带来的信息呢?</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/a.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> withRouter<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/router'</span> <span class="token comment">// 1. 引入withRouer</span>

<span class="token keyword">const</span> <span class="token function-variable function">A</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> router <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span> <span class="token constant">A</span> <span class="token punctuation">{</span> router<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span> <span class="token comment">// 3. 拿到路由参数并使用</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span> <span class="token comment">// 2. 用withRouter来给组件导入路由参数</span>
</code></pre></div><h3 id="_3-路由映射"><a href="#_3-路由映射" aria-hidden="true" class="header-anchor">#</a> 3. 路由映射</h3> <p>什么是路由映射呢？按照<code>react</code>当中的<code>params</code>定义的路由，我们定义路由为<code>localhost:3000/a/:id</code>，具体访问就是<code>localhost：3000/a/1</code>或者<code>localhost：3000/a/4</code>这种，但是在<code>next</code>当中是无法定义这种<code>params</code>的路由的，它显示的就是<code>query</code>形式的路由，比如<code>localhost:3000/a?id=1</code>，这种不太好看，<font color="#1E90FF">所以我们需要路由映射将next中的localhost:3000/a?id=1映射成为localhost:3000/a/1</font></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/index.js</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'next/router'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">function</span> <span class="token function">gotoTestB</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">===</span> <span class="token string">'2'</span><span class="token punctuation">)</span> Router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/test/b?id=2'</span><span class="token punctuation">,</span><span class="token string">'test/b/2'</span><span class="token punctuation">)</span> <span class="token comment">// Router(String): 给push添加第二个参数</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">===</span> <span class="token string">'3'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			Router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>   <span class="token comment">// Router(Object)：给push添加第二个参数</span>
				pathname<span class="token punctuation">:</span> <span class="token string">'/test/b'</span><span class="token punctuation">,</span>
				query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
					id
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'/text/b/3'</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">'/a?id=1'</span> <span class="token keyword">as</span><span class="token operator">=</span><span class="token string">&quot;/a/1&quot;</span> title<span class="token operator">=</span><span class="token string">'AAA'</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token comment">/* Link： 通过as属性定义在映射关系，访问的实际上是/a?id=1,映射在浏览器中就显示/a/1 */</span><span class="token punctuation">}</span>
				<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>index<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">gotoTestB</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>text b<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">gotoTestB</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>text c<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，通过路由映射，我们在浏览器中路由跳转就能跳转到<code>localhost:3000/a/1</code>或者<code>localhost:3000/test/b/2</code>，但是有个很大的问题：<font color="#DD1144">当我们从localhost:3000跳转到localhost:3000/a/1是没有问题的，但是在后者页面中刷新页面，页面就变成了404，原因是在页面跳转过程中，走的前端渲染的路线，前端路由做好了映射关系，但是重新刷新localhost:3000/a/1，就走了服务端渲染的路线，会重新请求服务端，而在服务端next当中pages不存在a文件夹，也不存在1.js，从而也就访问不到a/1这个路径的页面</font></p> <p><font color="#9400D3">说白了，终究原因就是服务端渲染只发生在第一次访问页面，所以我们需要在路由映射的情况下处理404的问题，然而next当中确实没有pages/a/1这个文件存在，那么localhost:3000/a/1这个请求发过来怎么处理？好在next是作为koa的中间件使用的，next处理不了，我们可以在koa当中处理</font></p> <p>处理的思路是什么呢？实际上想服务器请求<code>localhost:3000/a/1</code>实际上还是想访问<code>localhost:3000/a?id=1</code>，所以进入服务器的时候，通过<code>koa</code>定义的<code>/a/:id</code>路由拦截到这个请求，拿到<code>id</code>，然后重新用<code>next</code>处理<code>/a?id=1</code>这个请求即可：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// server.js</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> dev <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dev <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> handle <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1. 定义路由</span>

	router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/a/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 2. 路由定义/a/:id匹配请求</span>
		<span class="token keyword">const</span> id <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
		<span class="token keyword">await</span> <span class="token function">handle</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>req<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>res<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">// 3. 重新用next处理/a?id=1的请求</span>
			pathname<span class="token punctuation">:</span> <span class="token string">'/a'</span><span class="token punctuation">,</span>
			query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
				id
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		ctx<span class="token punctuation">.</span>respond <span class="token operator">=</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 4. koa中间件使用koa-router</span>

	server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">await</span> <span class="token function">handle</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>req<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>res<span class="token punctuation">)</span>
		ctx<span class="token punctuation">.</span>respond <span class="token operator">=</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;koa server listening on 3000&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>至于<code>ctx.respond=false</code>，是为了绕过<code>Koa</code>的内置<code>response</code>处理，想要写入原始的<code>res</code> 对象而不是让<code>Koa</code>处理你的<code>response</code>,<font color="#1E90FF">说白了从始至终都是node中的ctx.res和ctx.req，而不适用koa当中自己的ctx.response和ctx.request</font>，如果有问题，可以到<a href="https://koa.bootcss.com/" target="_blank" rel="noopener noreferrer">koa官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上查看<code>ctx.res</code>和<code>ctx.response</code>的区别，以及<code>ctx.req</code>和<code>ctx.request</code></p> <h3 id="_4-路由变化的钩子"><a href="#_4-路由变化的钩子" aria-hidden="true" class="header-anchor">#</a> 4. 路由变化的钩子</h3> <p>什么是<code>router</code>的钩子呢? <font color="#1E90FF">在router变化的时候，在变化的前中后都会触发一下不同的事件，通过监听事件我们可以做很多事情</font>，我们在<code>pages/index.js</code>当中添加下面的代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 路由的6个钩子</span>
<span class="token keyword">const</span> events <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token string">'routeChangeStart'</span><span class="token punctuation">,</span>
	<span class="token string">'routeChangeComplete'</span><span class="token punctuation">,</span>
	<span class="token string">'routeChangeError'</span><span class="token punctuation">,</span>
	<span class="token string">'beforeHistoryChange'</span><span class="token punctuation">,</span>
	<span class="token string">'hashChangeStart'</span><span class="token punctuation">,</span>
	<span class="token string">'hashChangeComplete'</span>
<span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">makeEvent</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

events<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	Router<span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token function">makeEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在正常的路由跳转都会执行三个路由的钩子：<font color="#9400D3">routeChangeStart</font>、<font color="#9400D3">beforeHistoryChange</font>、<font color="#9400D3">routeChangeComplete</font>，接收的参数也都只有一个，就是新的路由路径，比如从<code>localhost:3000</code>跳转到<code>localhost:3000/a/1</code>，则这些钩子函数能接受到的参数就是<code>/a/1</code>。</p> <p>而<code>routeChangeError</code>一般是在路由发生错误的时候触发，这个一般也不常用，而哈希路由变化的时候会触发两个钩子，分别是<font color="#9400D3">hashChangeStart</font>、<font color="#9400D3">hashChangeComplete</font></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/a.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> withRouter<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/router'</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span>

<span class="token keyword">const</span> <span class="token function-variable function">A</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> router <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;#AAA&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span> <span class="token constant">AAA</span> <span class="token punctuation">{</span>router<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;#BBB&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span> <span class="token constant">BBB</span> <span class="token punctuation">{</span>router<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span>
</code></pre></div><p>可以看到，哈希实际上是在一个页面用来定位的，当我们点击上面的<code>Link</code>标签，就会打印出<code>hashChangeStart</code>和<code>hashChangeComplete</code>。</p> <h2 id="获取数据"><a href="#获取数据" aria-hidden="true" class="header-anchor">#</a> 获取数据</h2> <p>接下来我们来学习一下获取数据，<font color="#DD1144">getInitialProps</font>方法，<font color="#9400D3">getInitialProps方式是挂载在组件上的一个静态的方法，能够帮助我们完成数据获取的工作，我们可以在进入到某个页面中的时候提前通过这个方法获取数据，同时也可以在App当中获取全局的数据</font></p> <p>这个方法为什么这么重要，<font color="#DD1144">因为这个方法可以完成客户端和服务端之间数据的同步，这个功能实际上是整个服务端渲染技术当中最大的痛点之一。</font></p> <p>所以这个方法实际上是<code>nextjs</code>的数据获取规范，我们应该按照规范把数据获取的代码写在这里面。另外<code>nextjs</code>还有很多规范在里面，如果你发现按照规范你无法实现你的功能，你可能就要思考换别的框架了，毕竟<code>nextjs</code>在众多规范下使用确实比较狭隘。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/a.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> withRouter<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/router'</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span>

<span class="token keyword">const</span> <span class="token function-variable function">A</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> router<span class="token punctuation">,</span>name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;#AAA&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span> <span class="token constant">AAA</span> <span class="token punctuation">{</span>router<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;#BBB&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span> <span class="token constant">BBB</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token comment">// 给组件定义getInitialProps方法</span>
<span class="token constant">A</span><span class="token punctuation">.</span><span class="token function-variable function">getInitialProps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				name<span class="token punctuation">:</span> <span class="token string">'Jokcy'</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token keyword">await</span> promise
<span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p><font color="#DD1144">首先要注意的就是getInitialProps方法返回的内容都会作为A组件的props被传入进A组件，可以看到在上述代码当中返回的是一个对象，对象中有name属性，在A中就会拿到name属性</font></p></li> <li><p><font color="#DD1144">给组件定义getInitialProps方法这种行为只能在pages文件夹中的组件中出现，因为nextjs对pages文件夹下的文件有特殊的路由处理，而在其他文件夹，比如components下的公用组件中定义getInitialProps方法就没啥用</font></p></li> <li><p><font color="#DD1144">这个方法在服务端和客户端都会执行，当然都会执行的意思是如果当前页面是客户端渲染（通过前端路由跳转进入），那就会在客户端执行了一次。如果是服务端渲染（刷新当前页面），那么在服务端执行一次，在客户端不会执行，会直接复用服务端的数据，所以这也是客户端和服务端数据能够同步的关键。</font></p></li> <li><p><font color="#1E90FF">另外我们还能获取App全局的数据，这个是什么意思呢，就是在pages/_app.js当中获取，这个文件是个顶层app的组件，所有在pages当中的其他组件都要调用它，至于到底怎么使用我们在下面的自定义app当中会详细介绍</font></p></li></ul> <h2 id="自定义"><a href="#自定义" aria-hidden="true" class="header-anchor">#</a> 自定义</h2> <h3 id="_1-app自定义"><a href="#_1-app自定义" aria-hidden="true" class="header-anchor">#</a> 1. App自定义</h3> <p>我们在<code>pages</code>当中创建一个<code>_app.js</code>文件能够覆盖<code>next</code>当中的默认的<code>app.js</code>文件。那么这个<code>_app.js</code>有哪些作用呢？</p> <ul><li><font color="#9400D3">固定Layout</font>：如果所有页面都有相同的东西或者布局，我们可以在这里进行处理</li> <li><font color="#9400D3">保持一些公用的状态</font>：使用<code>redux</code>的时候，关于初始化和一些数据的处理我们会在<code>_app.js</code>当中进行</li> <li><font color="#9400D3">给页面传入自定义数据</font>：页面在切换的时候都可以给页面传入一些想要传递的数据</li> <li><font color="#9400D3">自定义错误处理</font>：错误处理的代码也可以在这里书写</li></ul> <p><font color="#1E90FF"><strong>① 自定义数据和状态</strong></font></p> <p>我们最开始写的<code>_app.js</code>内容如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/_app.js</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'next/app'</span>
<span class="token keyword">import</span> <span class="token string">'antd/dist/antd.css'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App
</code></pre></div><p>这种写法基本上就是啥作用都没有，和<code>next.js</code>当中默认的<code>app.js</code>是一模一样的，所以如果我们要自定义的话，就不能直接导出<code>App</code>，而要换新的写法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/_app.js</span>
<span class="token keyword">import</span> App<span class="token punctuation">,</span> <span class="token punctuation">{</span> Container <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/app'</span>
<span class="token keyword">import</span> <span class="token string">'antd/dist/antd.css'</span>

<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>

	<span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getInitialProps</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>Component<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 1. MyApp.getInitialProps中能通过Component拿到具体要渲染页面的getInitialProps方法</span>
		<span class="token comment">// 2. 执行具体页面的getInitialProps方法，拿到数据，将数据传入给render当中要渲染的具体页面</span>
		<span class="token keyword">let</span> pageProps
		<span class="token keyword">if</span><span class="token punctuation">(</span>Component<span class="token punctuation">.</span>getInitialProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pageProps <span class="token operator">=</span> <span class="token keyword">await</span> Component<span class="token punctuation">.</span><span class="token function">getInitialProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			pageProps
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 重新定义render方法</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> pageProps <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token comment">// 3. Component实际就是要渲染的页面</span>

		<span class="token keyword">return</span><span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>Container<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>pageProps<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token comment">/* 4. 将数据传入给要渲染的组件或者页面*/</span><span class="token punctuation">}</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Container<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MyApp
</code></pre></div><ul><li><font color="#DD1144">可以看到我们在代码中的注释，我们自定义App必须要走上面的这4步才能正确的渲染出具体的页面</font></li> <li><font color="#DD1144">其次，每次页面的切换都会调用MyApp当中的getInitialProps方法</font></li></ul> <p><font color="#1E90FF"><strong>② 自定义布局</strong></font></p> <p>比如我们要在每个页面都定义一个头部，用于导航，我们可以先<code>components/layout.jsx</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// components/layout.jsx</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
	<span class="token operator">&lt;</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>header<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/a?id=1&quot;</span> <span class="token keyword">as</span><span class="token operator">=</span><span class="token string">&quot;/a/1&quot;</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span><span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/test/b&quot;</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span><span class="token constant">B</span><span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
		<span class="token punctuation">{</span>children<span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>接着我们在<code>pages/_app.js</code>当中引入即可：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/_app.js</span>
<span class="token keyword">import</span> App<span class="token punctuation">,</span> <span class="token punctuation">{</span> Container <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/app'</span>
<span class="token keyword">import</span> <span class="token string">'antd/dist/antd.css'</span>
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'../components/layout'</span>  <span class="token comment">// 1. 引入Layout组件</span>

<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getInitialProps</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> pageProps
		<span class="token keyword">const</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token operator">=</span> ctx
		<span class="token keyword">if</span><span class="token punctuation">(</span>Component<span class="token punctuation">.</span>getInitialProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pageProps <span class="token operator">=</span> <span class="token keyword">await</span> Component<span class="token punctuation">.</span><span class="token function">getInitialProps</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			pageProps
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> pageProps <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>Container<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token comment">/* 2. 使用组件*/</span><span class="token punctuation">}</span>
					<span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>pageProps<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Container<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MyApp
</code></pre></div><h3 id="_2-document自定义"><a href="#_2-document自定义" aria-hidden="true" class="header-anchor">#</a> 2. Document自定义</h3> <p>接下来我们说一下自定义<code>document</code>文件，<font color="#DD1144">这个文件是只有在服务端渲染的时候才会被调用，用来修改服务端渲染的文档内容，一般用来配合第三方css-in-js方案中使用</font></p> <p>所以我们需要在<code>pages</code>当中来创建<code>_document.js</code>来使用:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/_document.js</span>
<span class="token keyword">import</span> Document<span class="token punctuation">,</span> <span class="token punctuation">{</span> Html<span class="token punctuation">,</span> Head<span class="token punctuation">,</span> Main<span class="token punctuation">,</span> NextScript<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/document'</span>

<span class="token keyword">class</span> <span class="token class-name">MyDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getInitialProps</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token keyword">await</span> Document<span class="token punctuation">.</span><span class="token function">getInitialProps</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>

		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token operator">...</span>props
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>Html<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>Main <span class="token operator">/</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>NextScript <span class="token operator">/</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Html<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> MyDocument
</code></pre></div><p>要注意的是：<font color="#1E90FF">我们可以在extends的时候不去重写render和getInitialProps方法，但是一旦你要重写render和getInitialProps方法就要按照上述代码的形式和结构，Html, Head, Main, NextScript一个都不能少，包括执行Document.getInitialProps(ctx)的环节也不能少</font></p> <h3 id="_3-样式自定义"><a href="#_3-样式自定义" aria-hidden="true" class="header-anchor">#</a> 3. 样式自定义</h3> <p><font color="#1E90FF">next默认是不支持去load一个css文件的，要通过修改配置引入一个模块来帮助next去加载css文件，既然它本身不支持css文件的加载，它本身是用css-in-js的方案</font></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/a.js</span>
<span class="token keyword">const</span> <span class="token function-variable function">A</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> router<span class="token punctuation">,</span>name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
	<span class="token operator">&lt;</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;#AAA&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span><span class="token constant">A</span> <span class="token punctuation">{</span>router<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;#BBB&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a className<span class="token operator">=</span><span class="token string">&quot;link&quot;</span><span class="token operator">&gt;</span><span class="token constant">A</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>style jsx<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token comment">/* 局部css-in-js方案*/</span><span class="token punctuation">}</span>
			<span class="token punctuation">{</span><span class="token template-string"><span class="token string">`
				a { color: blue; }
				.link { color: green;}
			`</span></span><span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>style jsx global<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token comment">/* 全局css-in-js方案*/</span><span class="token punctuation">}</span>
			<span class="token punctuation">{</span><span class="token template-string"><span class="token string">`
				a { color: red;}
			`</span></span><span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>这种方案能够保证在组件和组件之间的<code>css</code>是隔离的，无论是标签集或者是<code>class</code>集的样式都不会影响其他组件当中的样式，<font color="#1E90FF">但是有一点要注意，按照上面的写法，在浏览器当中看到的节点是这样的</font>：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jsx-50986021<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AAA<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jsx-50986021 link<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AAA<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><font color="#DD1144">但是jsx-50986021并不是一个样式class，而是当前节点所属文件的固定标识符，也就是说真正起作用的样式不是jsx-50986021和link，两个a标签起作用的样式分别是a.jsx-50986021和.link.jsx-50986021，所以实际上因为有了jsx-50986021这种文件标识，才能使得每个文件当中的样式不会互相影响，比如你在a.js和b.js中同时设置颜色样式，在浏览器中你到a页面看到的样式是span.jsx-12584965，到b页面看到的样式实际是span.jsx-84965823</font></p> <p>当然了，在页面当中可以定义页面独有的样式，也可以定义全局的样式：只不过在这种全局样式只有在组件起作用的时候才有效，组件被卸载后其中定义的全局样式也随之消失，比如从a页面跳转到b页面，a页面中的组件就被卸载了，a页面中的全局样式也就不起作用了。这个就是<code>css-in-js</code>的好处之一。</p> <h3 id="_4-继承styled-components"><a href="#_4-继承styled-components" aria-hidden="true" class="header-anchor">#</a> 4. 继承styled-components</h3> <p><font color="#1E90FF"><strong>① 构造代码模式</strong></font></p> <p>上面讲了<code>next</code>当中默认集成的<code>styled-jsx</code>的<code>css-in-js</code>方案，我们现在来说一下如何集成一下第三方的<code>css-in-js</code>方案，集成第三方的<code>css-in-js</code>方案，我们需要在代码当中构造一种模式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// _dcoument.js</span>
<span class="token keyword">import</span> Document<span class="token punctuation">,</span> <span class="token punctuation">{</span> Html<span class="token punctuation">,</span> Head<span class="token punctuation">,</span> Main<span class="token punctuation">,</span> NextScript<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/document'</span>

<span class="token comment">// 强化组件的函数</span>
<span class="token keyword">function</span> <span class="token function">withLog</span><span class="token punctuation">(</span><span class="token parameter">Comp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token comment">// 这里可以做额外的工作</span>
		<span class="token keyword">return</span> <span class="token operator">&lt;</span>Comp <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getInitialProps</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 记录原始的renderPage方法</span>
		<span class="token keyword">const</span> originalRenderPage <span class="token operator">=</span> ctx<span class="token punctuation">.</span>renderPage

		<span class="token comment">// 给ctx.renderPage定义新的方法</span>
		ctx<span class="token punctuation">.</span><span class="token function-variable function">renderPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">originalRenderPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token function-variable function">enhanceApp</span><span class="token punctuation">:</span> <span class="token parameter">App</span> <span class="token operator">=&gt;</span> <span class="token function">withLog</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 强化App（_app.js当中的App）</span>
			<span class="token function-variable function">enhanceComponent</span><span class="token punctuation">:</span> <span class="token parameter">Component</span> <span class="token operator">=&gt;</span> <span class="token function">withLog</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span> <span class="token comment">// 强化具体页面组件（pages文件夹下的每个页面）</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> MyDocument
</code></pre></div><p>通过上面的这种写法，我们可以在强化函数当中书写额外的代码来对组件做额外的工作，那么就可以在这里进行集成
<code>css-in-js</code>的东西。<font color="#DD1144">css-in-js的方案主要就是解决在服务端渲染当中拿到某一个页面当中的最终渲染出来的css文本，我们要拿到它将其加入到header里面生成完成的html返回去，这个工作是在_document.js当中要完成的</font></p> <p><font color="#1E90FF"><strong>② 配置styled-components</strong></font></p> <p>我们的<code>css-in-js</code>方案在<a href="www.styled-components.com">www.styled-components.com</a>官网上有详细的说明，这里就不赘述，我们直接来下载需要的包：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add styled<span class="token operator">-</span>components@<span class="token number">4.2</span><span class="token number">.0</span> babel<span class="token operator">-</span>plugin<span class="token operator">-</span>styled<span class="token operator">-</span>components@<span class="token number">1.10</span><span class="token number">.0</span>
</code></pre></div><p>然后我们去<code>.babelrc</code>当中去添加一下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;plugins&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">[</span>
			<span class="token string">&quot;styled-components&quot;</span><span class="token punctuation">,</span>
			<span class="token punctuation">{</span>
				<span class="token string">&quot;ssr&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><font color="#1E90FF"><strong>③ 集成styled-components</strong></font></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/_document.js</span>
<span class="token keyword">import</span> Document<span class="token punctuation">,</span> <span class="token punctuation">{</span> Html<span class="token punctuation">,</span> Head<span class="token punctuation">,</span> Main<span class="token punctuation">,</span> NextScript<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/document'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ServerStyleSheet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'styled-components'</span> <span class="token comment">// 1. 引入styled-compoennts</span>

<span class="token keyword">class</span> <span class="token class-name">MyDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getInitialProps</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 2. 创建sheet对象</span>
		<span class="token keyword">const</span> sheet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerStyleSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">const</span> originalRenderPage <span class="token operator">=</span> ctx<span class="token punctuation">.</span>renderPage

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">// 3. 给ctx.renderPage定义新的方法</span>
			ctx<span class="token punctuation">.</span><span class="token function-variable function">renderPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">originalRenderPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token comment">//4. 将渲染完成的css样式挂载到sheet对象上</span>
				<span class="token function-variable function">enhanceApp</span><span class="token punctuation">:</span> <span class="token parameter">App</span> <span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sheet<span class="token punctuation">.</span><span class="token function">collectStyles</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>

			<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token keyword">await</span> Document<span class="token punctuation">.</span><span class="token function">getInitialProps</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
			<span class="token comment">// 5. 将sheet对象上的样式和next内部本身的jsx-styled样式同时返回</span>
			<span class="token comment">// {props.styles}是next内部默认的jsx-styled的css-in-js的方案</span>
			<span class="token comment">// {sheet.getStyleElement()}是我们集成styled-components第三方的css-in-js方案</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
				<span class="token operator">...</span>props<span class="token punctuation">,</span>
				styles<span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>styles<span class="token punctuation">}</span><span class="token punctuation">{</span>sheet<span class="token punctuation">.</span><span class="token function">getStyleElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
			sheet<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> MyDocument
</code></pre></div><p>使用上面这种方法依旧是按照对<code>App</code>增强的方式进行的集成，它可以和<code>next.js</code>当中的默认的<code>css-in-js</code>方案<code>jsx-styled</code>共同使用，至于集成的流程你看看就行了，不需要深究。</p> <p><font color="#1E90FF"><strong>④ 使用styled-components</strong></font></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/a.js</span>
<span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">'styled-components'</span> <span class="token comment">// 1. 引入styled-components</span>

<span class="token comment">// 2. 创造一个带有样式的h1标签</span>
<span class="token keyword">const</span> Title <span class="token operator">=</span> styled<span class="token punctuation">.</span>h1<span class="token template-string"><span class="token string">`
	color: yellow;
	font-size: 40px
`</span></span>

<span class="token keyword">const</span> <span class="token function-variable function">A</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> router<span class="token punctuation">,</span>name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
	<span class="token operator">&lt;</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>Title<span class="token operator">&gt;</span><span class="token keyword">this</span> is title<span class="token operator">&lt;</span><span class="token operator">/</span>Title<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token comment">/*3. 使用带有样式的标签*/</span><span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><h2 id="异步和组件加载"><a href="#异步和组件加载" aria-hidden="true" class="header-anchor">#</a> 异步和组件加载</h2> <p><font color="#DD1144">LazyLoading</font>是<code>next.js</code>当中的非常强大的一个功能，<font color="#1E90FF">在next当中默认已经将每个页面的模块做了切割，也就是在实际访问的时候才会去加载访问的页面，所以next默认的懒加载已经是足够用了，但是有时候我们希望自己能够控制某些模块使用的时候再去加载</font></p> <p>异步加载分为<font color="#1E90FF">异步加载模块</font>和<font color="#1E90FF">异步加载组件</font>，下面我们分别来说。</p> <h3 id="_1-异步加载模块"><a href="#_1-异步加载模块" aria-hidden="true" class="header-anchor">#</a> 1. 异步加载模块</h3> <p>首先来下载一个<code>moment.js</code>的包：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add moment@<span class="token number">2.24</span><span class="token number">.0</span>
</code></pre></div><p>然后我们来看一个例子，假如我们要使用这个<code>moment</code>这个包，一般的做法是这样：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/a.js</span>
<span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span> <span class="token comment">// 1. 引入包</span>

<span class="token constant">A</span><span class="token punctuation">.</span><span class="token function-variable function">getInitialProps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				name<span class="token punctuation">:</span> <span class="token string">'Jokcy'</span><span class="token punctuation">,</span>
				time<span class="token punctuation">:</span> <span class="token function">moment</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2. 使用包</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token keyword">await</span> promise
<span class="token punctuation">}</span>
</code></pre></div><p>正常的包的使用写法都是上述这样的，在多个页面中都如果使用到了<code>moment</code>这个包，那么<code>nextjs</code>会将其进行提取，提取出来之后会作为公用的包放入<code>vender.js</code>这个文件当中作为一开始就请求的<code>js</code>文件，而实际上我们想让用户访问到用到<code>moment</code>的页面的时候再去加载<code>moment.js</code>这个包，所以我们需要将其异步引入，异步的引入要放在<code>getInitialProps</code>函数当中，其写法也有所变化：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/a.js</span>
<span class="token constant">A</span><span class="token punctuation">.</span><span class="token function-variable function">getInitialProps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span> <span class="token comment">// 1. 用到的时候才加载</span>

	<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				name<span class="token punctuation">:</span> <span class="token string">'Jokcy'</span><span class="token punctuation">,</span>
				time<span class="token punctuation">:</span> moment<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2. 使用moment.default</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token keyword">await</span> promise
<span class="token punctuation">}</span>
</code></pre></div><p>按照上面这样的写法，当我们访问<code>pages/a</code>页面的时候会加载两个<code>js</code>文件，一个是<code>a.js</code>，一个是<code>1.js</code>,这样实际上<code>1.js</code>当中就放的是<code>moment.js</code>经过<code>webpack</code>打包后的代码，因为比较多，既不会放在<code>a.js</code>当中，也不会放在公用打包<code>js</code>文件当中，从而实现了代码分离和异步加载。</p> <p>这种懒加载的方式我们经常在<font color="#DD1144">使用率比较小，但是内存比较大的模块上使用</font>，<font color="#1E90FF">另外将懒加载的代码放在getInitialProps当中不会影响页面的渲染，因为getInitialProps也是异步的方法</font></p> <h3 id="_2-异步加载组件"><a href="#_2-异步加载组件" aria-hidden="true" class="header-anchor">#</a> 2. 异步加载组件</h3> <p>异步加载组件实际上更简单，比如我们在<code>components/comp.jsx</code>有这样一段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// components/comp.jsx</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>sapn<span class="token operator">&gt;</span>Lazy Component<span class="token operator">&lt;</span><span class="token operator">/</span>sapn<span class="token operator">&gt;</span>
</code></pre></div><p>然后我们在<code>pages/a.js</code>当中要引入这个公用组件，我们就这样做：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// pages/a.js</span>
<span class="token keyword">import</span> dynamic <span class="token keyword">from</span> <span class="token string">'next/dynamic'</span>  <span class="token comment">// 1. 引入dynamic</span>

<span class="token keyword">const</span> Comp <span class="token operator">=</span> <span class="token function">dynamic</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/comp'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2. 异步加载组件</span>

<span class="token keyword">const</span> <span class="token function-variable function">A</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> router<span class="token punctuation">,</span>name<span class="token punctuation">,</span>time <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
	<span class="token operator">&lt;</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>Title<span class="token operator">&gt;</span><span class="token keyword">this</span> is title <span class="token punctuation">{</span> time<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Title<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>Comp <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token comment">/* 3. 加载组件*/</span><span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>特别要注意的是，<font color="#DD1144">当页面加载js文件的时候，异步组件的代码并不会执行，只有真正页面执行到，或者渲染到Comp组件的时候才会去异步加载组件</font>，所以我们结合上面的异步模块的引入我们来理清一下<code>pages/a.js</code>整个页面的加载文件和加载顺序：</p> <ul><li><font color="#9400D3">首先加载a.js</font>：<code>a.js</code>当中包含了页面本身的<code>js</code>和<code>react</code>代码</li> <li><font color="#9400D3">再者加载1.js</font>：因为先要执行<code>getInitialProps</code>方法，在这方法中我们异步引入了<code>moment.js</code>，所以实际上<code>1.js</code>中就是<code>webpack</code>打包<code>moment.js</code>的内容</li> <li><font color="#9400D3">最后加载2.js</font>：<code>getInitialProps</code>方法执行完开始渲染A组件，渲染到<code>Comp</code>发现是个异步组件，所以<code>2.js</code>实际上是异步组件<code>Comp.jsx</code>当中打包后的内容</li></ul> <p>所以你也可以通过异步加载组件和异步加载模块来优化实际的项目</p> <h2 id="配置项"><a href="#配置项" aria-hidden="true" class="header-anchor">#</a> 配置项</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> configs <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token comment">// 编译文件的输出目录(默认是在.next当中)</span>
	distDir<span class="token punctuation">:</span> <span class="token string">'dest'</span><span class="token punctuation">,</span>

	<span class="token comment">// 是否给每个路由生成Etag(缓存标识,默认为true)</span>
	<span class="token comment">// 两次请求如果Etag一样，服务器就会让浏览器直接返回缓存</span>
	<span class="token comment">// 如果你使用nginx中的Etag，就可以关闭这个nextjs当中Etag</span>
	generateEtags<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

	<span class="token comment">// 页面内容缓存配置（开发环境有效）</span>
	onDemandEntries<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// 内容在内存中缓存的时长（ms）</span>
		<span class="token comment">// 在配置的时间内访问同一页面，不再重走服务端流程，直接内存返回</span>
		maxInactiveAge<span class="token punctuation">:</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
		<span class="token comment">// 同时缓存多少个页面</span>
		pagesBufferLength<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 在pages目录下哪种后缀的文件会被认为是页面</span>
	pageExtensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'jsx'</span><span class="token punctuation">,</span><span class="token string">'js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

	<span class="token comment">// 配置buildId(一般不会用到，只用同一个项目在多个节点部署的时候会用到)</span>
	<span class="token function-variable function">generateBuildId</span><span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">YOUR_BUILD_ID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">YOUR_BUILD_ID</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 返回null,则使用的默认的unique id</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 手动修改webpack config</span>
	<span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> config
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 修改webpackDevMiddleware配置</span>
	<span class="token function-variable function">webpackDevMiddleware</span><span class="token punctuation">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> config
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 可以在页面上通过process.env.customKey 获取value</span>
	env<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		customKey<span class="token punctuation">:</span> <span class="token string">'value'</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 下面两个要通过`next/config`来读取</span>
	<span class="token comment">// const config from 'next/config';</span>
	<span class="token comment">// const { serverRuntimeConfig, publicRuntimeConfig } = config</span>
	<span class="token comment">// 只有在服务端渲染时才会获取的配置</span>
	serverRuntimeConfig<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		mySecret<span class="token punctuation">:</span> <span class="token string">'secret'</span><span class="token punctuation">,</span>
		secondSecret<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SECOND_SECRET</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 在服务端渲染和客户端渲染都可以获取的配置</span>
	publicRuntimeConfig<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		staticFolder<span class="token punctuation">:</span> <span class="token string">'/static'</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>关于<code>next</code>常用的配置项就这么多，上面这些配置在<code>next.config,js</code>当中实际要这样用：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// next.config.js</span>
<span class="token keyword">const</span> withCss <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@zeit/next-css'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> require <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	require<span class="token punctuation">.</span>extensions<span class="token punctuation">[</span><span class="token string">'.css'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">withCss</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// 在这里写所有的配置项,比如distDir</span>
	distDir<span class="token punctuation">:</span> <span class="token string">'dest'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="nextjs渲染流程"><a href="#nextjs渲染流程" aria-hidden="true" class="header-anchor">#</a> nextjs渲染流程</h2> <p>当我们熟悉了<code>next</code>的一些知识点后，我们回头来看这个图：</p> <img src="/react_nextjs_liucheng.png" alt="next流程图"></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/24/2020, 9:51:42 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/react-ssr/ssr_combat_project_one.html" class="prev">
          项目搭建流程
        </a></span> <span class="next"><a href="/react-ssr/ssr_combat_project_three.html">
          Hook新特性
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1a394514.js" defer></script><script src="/assets/js/2.8304a06b.js" defer></script><script src="/assets/js/306.e2f7ad64.js" defer></script>
  </body>
</html>
