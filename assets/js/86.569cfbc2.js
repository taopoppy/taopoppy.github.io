(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{270:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"lazy-loading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lazy-loading","aria-hidden":"true"}},[t._v("#")]),t._v(" Lazy-Loading")]),t._v(" "),a("h2",{attrs:{id:"什么是lazy-loading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是lazy-loading","aria-hidden":"true"}},[t._v("#")]),t._v(" 什么是Lazy-Loading")]),t._v(" "),a("p",[t._v("其实"),a("code",[t._v("Lazy-Loading")]),t._v("虽然此时拿出来好像是个新概念，但是我们之前就已经使用到了,比如说我们前面写的两段效果相同的代码：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 同步加载方式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" _ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lodash'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" element "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nelement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'taopoppy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("element"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 异步加载方式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/*webpackChunkName:"lodash"*/')]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lodash'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" element "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\telement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'taopoppy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" element\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("element")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tdocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("element"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("那么我们为什么要使用这种异步的方式呢？"),a("font",{attrs:{color:"#1E90FF"}},[t._v("因为异步的方式能实现懒加载")]),t._v(",比如我们现在修改一下上面的异步加载的代码：")],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/*webpackChunkName:"lodash"*/')]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lodash'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" element "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\telement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'taopoppy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" element\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" element "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tdocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("element"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("上面的代码就很好理解，因为打包出来的有三个文件："),a("font",{attrs:{color:"#1E90FF"}},[t._v("index.html")]),t._v("、"),a("font",{attrs:{color:"#1E90FF"}},[t._v("main.js")]),t._v("、"),a("font",{attrs:{color:"#1E90FF"}},[t._v("vendors~lodash.js")]),t._v(",我们打开浏览器加载"),a("code",[t._v("index.html")]),t._v("，你会发现它只会加载"),a("code",[t._v("index.html")]),t._v("和"),a("code",[t._v("main.js")]),t._v("，当我们点击网页任何一处，才会去加载"),a("code",[t._v("vendors~lodash.js")]),t._v("文件。所以我们通过这样的简单的例子就能知道懒加载的含义："),a("font",{attrs:{color:"#DD1144"}},[t._v("懒加载是通过异步加载模块的方式来加载模块，具体的执行时间不确定，依据书写的代码决定")])],1),t._v(" "),a("p",[t._v("那么懒加载的好处在哪里？ "),a("font",{attrs:{color:"#1E90FF"}},[t._v("减少首页加载文件的数量和大小，减少首页展示的时间，增加访问的速率")]),t._v("，这个很好理解，你想，如果按照同步的方式，对于首页来讲要加载3个文件，但是实际上"),a("code",[t._v("vendors~lodash.js")]),t._v("是和首页无关的代码，是我们点击操作后才要执行的代码，而异步加载后首页只需要加载首页需要的两个文件即可，加载的文件数量减少了，首页访问速率和加载速率不就提高了么。")],1),t._v(" "),a("p",[t._v("再举个例子，在"),a("code",[t._v("vue")]),t._v("当中的路由也有懒加载的概念，如果是同步加载，那么首页会将其他详情页，列表页的内容都加载一遍，那么首屏的展示速度会大大降低。所以。"),a("font",{attrs:{color:"#1E90FF"}},[t._v("懒加载的核心思想是将加载时间平均分配到项目的各个地方，实现什么时候需要什么时候加载的目的")])],1),t._v(" "),a("p",[t._v("那么懒加载和"),a("code",[t._v("webpack")]),t._v("有关系么？"),a("font",{attrs:{color:"#1E90FF"}},[t._v("lazy-loading和webpack一点关系都没有，而是es当中的概念，webpack只不过是能识别这样的语法，然后对其代码分割而已。")]),t._v("。")],1),t._v(" "),a("h2",{attrs:{id:"chunk和打包分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chunk和打包分析","aria-hidden":"true"}},[t._v("#")]),t._v(" Chunk和打包分析")]),t._v(" "),a("p",[t._v("经过打包后，其实每个"),a("code",[t._v("javascript")]),t._v("文件都是一个"),a("code",[t._v("chunk")]),t._v(",比如说"),a("code",[t._v("main.js")]),t._v("的"),a("code",[t._v("Chunk Names")]),t._v("叫做"),a("code",[t._v("main")]),t._v(","),a("code",[t._v("vendors~lodash.js")]),t._v("的"),a("code",[t._v("Chunk Names")]),t._v("叫做"),a("code",[t._v("vendors~lodash")])]),t._v(" "),a("p",[t._v("这里主要要区分的就是，经过上面我们的讲解，很多人会把模块和"),a("code",[t._v("Chunk")]),t._v("混淆，因为我们的代码简单，"),a("code",[t._v("vendors~lodash")]),t._v("这个"),a("code",[t._v("Chunk")]),t._v("里面只有一个模块"),a("code",[t._v("lodash")]),t._v("，但其实在正式的项目当中，一个"),a("code",[t._v("Chunk")]),t._v("指的就是打包出来的一个单独的"),a("code",[t._v("javascript")]),t._v("文件，它可以包含一个或者多个模块。")]),t._v(" "),a("p",[t._v("关于打包后的"),a("code",[t._v("Chunk")]),t._v("，我们也可以借助一些专业的工具来分析，进入到"),a("a",{attrs:{href:"www.github.com/webpack/analyse"}},[a("code",[t._v("www.github.com/webpack/analyse")])]),t._v("这个仓库，按照它说的，修改我们的启动开发环境的启动命令：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// package.json")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dev-build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpack --profile --json > stats.json --config ./build/webpack.dev.js "')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这样修改后，我们再启动"),a("code",[t._v("npm run dev-build")]),t._v("的时候，会把我们打包的信息和详情打包到一个"),a("code",[t._v("stats.json")]),t._v("的文件，然后把这个文件拿到官方提供的分析网站："),a("a",{attrs:{href:"http://webpack.github.io/analyse/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://webpack.github.io/analyse/"),a("OutboundLink")],1),t._v("，在这里就能得到分析，另外还有几个比较好的分析工具，在官网上也有提及：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://alexkuz.github.io/webpack-chart/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://alexkuz.github.io/webpack-chart/"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://chrisbateman.github.io/webpack-visualizer/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://chrisbateman.github.io/webpack-visualizer/"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/webpack-contrib/webpack-bundle-analyzer",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/webpack-contrib/webpack-bundle-analyzer"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"preloading-prefetching"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preloading-prefetching","aria-hidden":"true"}},[t._v("#")]),t._v(" Preloading&&Prefetching")]),t._v(" "),a("h3",{attrs:{id:"_1-preloading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-preloading","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. Preloading")]),t._v(" "),a("p",[t._v("我们之前说代码分割，官方在"),a("code",[t._v("splitChunks")]),t._v("中的默认配置有一大堆，其中"),a("code",[t._v("chunks")]),t._v("的默认配置是"),a("code",[t._v("async")]),t._v("，这个就非常奇怪，为什么？我们会觉得想"),a("code",[t._v("jquery")]),t._v(","),a("code",[t._v("lodash")]),t._v("这些第三方包不是分离出去，然后会借助缓存提高第二次访问速率么？虽然是这样，但是我们想一个问题："),a("font",{attrs:{color:"#DD1144"}},[t._v("提高第二次的访问速率固然重要，但是重要的的是用户第一次访问的时候加载的速率")]),t._v("，"),a("font",{attrs:{color:"#1E90FF"}},[t._v("所以在同步的情况下，分割代码只对第二次有效，第一次访问却没有提升")]),t._v("，而"),a("code",[t._v("webpack")]),t._v("希望你的网页第一次访问就比较快，所以首当其冲的便是不能加载太多文件，所以希望你用异步的方式减少首次加载的文件数量。所以"),a("code",[t._v("splitChunks")]),t._v("的默认值是"),a("code",[t._v("async")])],1),t._v(" "),a("p",[t._v("我们举个例子，在"),a("code",[t._v("index.js")]),t._v("当中写这样一段代码：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// index.js")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" element "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\telement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello taopoppy'")]),t._v("\n\tdocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("element"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("然后打包文成后，去浏览器打开"),a("code",[t._v("dist/index.html")]),t._v("，"),a("font",{attrs:{color:"#1E90FF"}},[t._v("打开控制台，按住ctrl + shift + p，输入'coverage'，然后打开show coverage，点击左上角的按钮，等待按钮变成红色，刷新页面")]),t._v("，然后就有代码使用率的显示：\n"),a("img",{attrs:{src:t.$withBase("/webpack_three_proloading.png"),alt:"代码使用率"}})],1),t._v(" "),a("p",[t._v("可以很清楚的看到，代码未使用率(红色线)有"),a("code",[t._v("74.5%")]),t._v("，首屏加载的时候我们在"),a("code",[t._v("index.js")]),t._v("当中写的代码压根就没有用，因为属于交互代码，所以也被加载进去了,所以我们这样写：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// index.js")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/*webpackChunkName:"click"*/')]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./click.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// click.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleClick")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" element "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\telement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello taopoppy'")]),t._v("\n\tdocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("element"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" handleClick\n")])])]),a("p",[t._v("然后重新打包，按照刚才的顺序测试一下代码使用率，可以看到\n"),a("img",{attrs:{src:t.$withBase("/webpack_three_proloaded.png"),alt:"代码使用率"}})]),t._v(" "),a("p",[t._v("可以清楚的看到未使用率上升到"),a("code",[t._v("78.6")]),t._v(",说明"),a("code",[t._v("main.js")]),t._v("又有很多代码没有执行，如图所示的936行到941行是我们交互的代码，在首屏加载的时候并没有执行，这就是对的，因为这段代码不属于首屏加载时的执行代码，而是我们点击交互时执行的代码。")]),t._v(" "),a("h3",{attrs:{id:"_2-prefetching"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-prefetching","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. Prefetching")]),t._v(" "),a("p",[t._v("优化到此结束了吗？没有。"),a("font",{attrs:{color:"#1E90FF"}},[t._v("Preloading能在我们发生交互的时候去重新加载所需要的代码和库，但是这种比起我们不用Proloading的时候，Preloading的首屏有用代码的使用率提高了，可是发生交互的时候再去加载库和文件不是使交互速度变慢了么")]),t._v("，"),a("font",{attrs:{color:"#DD1144"}},[t._v("是的，此时就是Prefetching正式出场了")])],1),t._v(" "),a("p",[a("font",{attrs:{color:"#DD1144"}},[t._v("Prefetching是将我们不在首屏加载的代码偷偷在空闲时间去加载")])],1),t._v(" "),a("p",[t._v("你可能会疑惑，什么是偷偷？什么又是空闲时间，我们想假如一个页面有个登录按钮，点击会弹出一个登录框，对于首屏加载，肯定不会包含登录按钮的逻辑和登录框里面的样式代码和逻辑代码，"),a("font",{attrs:{color:"#1E90FF"}},[t._v("但是首屏加载完毕后，网络代码空闲了，此时用户在干嘛，其实用户在发呆，发了一会呆，欣赏了半天优美的页面，然后才找到登录按钮，那么在首屏加载完毕和用户点击登录按钮的之间，是用户发呆和欣赏的这段时间，而这段时间，就能用来加载登录按钮的逻辑和登录框的逻辑、样式代码，不是么？")]),t._v("，这就是偷偷在空闲时间加载非首屏代码的的含义，这样才能保证点击登录的交互速度和以前一样快。")],1),t._v(" "),a("p",[t._v("然后我们保存"),a("code",[t._v("click.js")]),t._v("不动，来修改"),a("code",[t._v("index.js")]),t._v("中的代码，"),a("font",{attrs:{color:"#1E90FF"}},[t._v("使用魔法注释来帮助我们添加prefetch功能")])],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// index.js")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/*webpackChunkName:"click"*/')]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*webpackPrefetch:true*/")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./click.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("接着我们到浏览器上看看效果：\n"),a("img",{attrs:{src:t.$withBase("/webpack_three_prefetching.png"),alt:"prefetch加载"}})]),t._v(" "),a("p",[t._v("可以很清楚的看到，代码使用率没有发生大的改变，在首屏需要的"),a("code",[t._v("main.js")]),t._v("和"),a("code",[t._v("index.html")]),t._v("加载完毕后，"),a("font",{attrs:{color:"#DD1144"}},[t._v("利用空闲的时间花了26ms加载了click.js，并且保存在浏览器的内存当中，当我们真正点击发生交互的时候，click.js直接从内存中拿了出来，所以只花了1ms")]),t._v("。"),a("font",{attrs:{color:"#1E90FF"}},[t._v("假如没有prefetching，发生点击交互的时候一定要花26ms")]),t._v("。在复杂的项目当中，利用"),a("code",[t._v("Prefetching")]),t._v("的特性可以大大优化交互速率。而且更重要的一点就是："),a("font",{attrs:{color:"#DD1144"}},[t._v("在项目优化的时候，我们不应该只把眼光放在缓存中来优化项目，更重要的是挺高代码的利用率来优化项目")]),t._v(",所以我们下面的一小节会说浏览器缓存。")],1),t._v(" "),a("h2",{attrs:{id:"code-splitting-lazy-loading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#code-splitting-lazy-loading","aria-hidden":"true"}},[t._v("#")]),t._v(" Code-Splitting&&Lazy-Loading")]),t._v(" "),a("p",[t._v("在说浏览器缓存之前，我们还是来清楚的分解一下"),a("code",[t._v("lazy-Loading")]),t._v("和"),a("code",[t._v("Code-splitting")]),t._v("两者的关系，虽然他们名字不一样，但是关系很密切：我们采用的"),a("code",[t._v("webpack")]),t._v("配置是"),a("code",[t._v("webpack.common.js")]),t._v("的同步异步都支持的模式：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack.common.js")]),t._v("\noptimization"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    splitChunks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      chunks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      minSize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      minChunks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      maxAsyncRequests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      maxInitialRequests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      automaticNameDelimiter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'~'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      cacheGroups"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        vendors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/[\\\\/]node_modules[\\\\/]/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          priority"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// name: 'vendors'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          minChunks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          priority"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          reuseExistingChunk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("img",{attrs:{src:t.$withBase("/webpack_three_codeSplit&lazyLoad.png"),alt:"懒加载和代码分割"}}),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("① 同步分割")])])],1),t._v(" "),a("p",[t._v("同步分割在首屏加载就加载了"),a("font",{attrs:{color:"#1E90FF"}},[t._v("index.html")]),t._v("、"),a("font",{attrs:{color:"#1E90FF"}},[t._v("vendors~main.js")]),t._v("、"),a("font",{attrs:{color:"#1E90FF"}},[t._v("main.js")]),t._v("这个是按照顺序加载的，但是实际上"),a("code",[t._v("vendors~main.js")]),t._v("是和交互相关的代码，所以并不是首屏展示的时候需要的代码，这就导致了"),a("code",[t._v("main.js")]),t._v("的代码使用率才有"),a("code",[t._v("30%")])],1),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("② 异步分割(preloading)")])])],1),t._v(" "),a("p",[t._v("异步分割的的写法如上展示，首屏只加载了"),a("font",{attrs:{color:"#1E90FF"}},[t._v("index.html")]),t._v("、"),a("font",{attrs:{color:"#1E90FF"}},[t._v("main.js")]),t._v(",代码利用率高达"),a("code",[t._v("81.2%")]),t._v("，点击屏幕进行交互，才开始加载"),a("code",[t._v("vendors~lodash.js")]),t._v("和"),a("code",[t._v("click.js")]),t._v("文件。")],1),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("③ Prefetching")])])],1),t._v(" "),a("p",[a("code",[t._v("Prefetching")]),t._v("的配置只需要添加魔法注释即可，首屏在加载"),a("font",{attrs:{color:"#1E90FF"}},[t._v("index.html")]),t._v("、"),a("font",{attrs:{color:"#1E90FF"}},[t._v("main.js")]),t._v("就完成了展示，但是利用首屏完成和你点击屏幕的这段空闲时间进行了加载，"),a("font",{attrs:{color:"#1E90FF"}},[t._v("所以你点击屏幕的时候vendors~main.js和click.js还会加载一次，但是因为空闲时加载了一次已经存在了缓存，所以点击交互的时候加载就直接从缓存里拿现成的，交互速度更快")]),t._v("，"),a("font",{attrs:{color:"#DD1144"}},[t._v("所以prefetching在首屏代码利用率和preloading保持一致的情况下提高了交互速率")])],1),t._v(" "),a("h2",{attrs:{id:"browser-caching"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#browser-caching","aria-hidden":"true"}},[t._v("#")]),t._v(" Browser-Caching")]),t._v(" "),a("p",[t._v("我们之前打包出来的文件名字都是固定的，那么问题就来了，比如我们现在打包的文件上传到了服务器，我们第一次请求没有问题，但是此时服务器修改文件，打包出来的文件名依旧没有变，那么浏览器就会去拿缓存中的值，不会知道你的内容发生了变化，所以对于这样的问题，"),a("font",{attrs:{color:"#DD1144"}},[t._v("开发环境我们其实不用管，因为会开启服务器调试，但是生产环境我们需要下面这样配置")]),t._v("：")],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack.prod.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].[contenthash].js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    chunkFilename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].[contenthash].js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("根据内容的不同，生成不同的哈希值，这样请求的文件名称变了，浏览器就不能直接从缓存中取文件，必须到服务器上拿新的文件来，这就是"),a("code",[t._v("[contenthash]")]),t._v("这个占位符的作用。所以这样的修改也同样适用我们在"),a("code",[t._v("css")]),t._v("代码分割里那个"),a("code",[t._v("MiniCssExtractPlugin")]),t._v("插件的配置：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack.common.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tplugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MiniCssExtractPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \tfilename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].[contenthash].css'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \t\tchunkFilename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].[contenthash].css'")]),t._v("\n\t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("另外有的老版本的"),a("code",[t._v("webpack")]),t._v("重新打包后的两个哈希值一样的，这个是因为"),a("code",[t._v("webpack")]),t._v("有关于在浏览器中连接模块一些相关的代码，它如果被缓存成为一样的也会导致打包出来的哈希值一样，所以我们这里一定要配置下面的内容，"),a("font",{attrs:{color:"#DD1144"}},[t._v("因为这个内容和单独分离webpack也有关系")]),t._v("：")],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack.common.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  optimization"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    runtimeChunk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'runtime'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("参考资料")])]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://www.webpackjs.com/guides/code-splitting/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.webpackjs.com/guides/code-splitting/"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.webpackjs.com/guides/lazy-loading/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.webpackjs.com/guides/lazy-loading/"),a("OutboundLink")],1)])])])},[],!1,null,null,null);s.default=e.exports}}]);