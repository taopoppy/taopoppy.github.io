(window.webpackJsonp=window.webpackJsonp||[]).push([[188],{373:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"数据库简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库简介","aria-hidden":"true"}},[t._v("#")]),t._v(" 数据库简介")]),t._v(" "),a("h2",{attrs:{id:"nosql介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nosql介绍","aria-hidden":"true"}},[t._v("#")]),t._v(" NoSQL介绍")]),t._v(" "),a("p",[a("code",[t._v("NoSQL")]),t._v(":"),a("font",{attrs:{color:"#3eaf7c"}},[t._v("对不同于传统的关系型数据库的数据库管理系统的统称")])],1),t._v(" "),a("p",[a("code",[t._v("NoSQL")]),t._v("有那些呢？")]),t._v(" "),a("ul",[a("li",[t._v("列存储（"),a("code",[t._v("HBase")]),t._v("）: 按列存储")]),t._v(" "),a("li",[t._v("文档存储（"),a("code",[t._v("MongoDB")]),t._v("）: 就是"),a("code",[t._v("json")]),t._v("存储，一段"),a("code",[t._v("json")]),t._v("就是一篇文档")]),t._v(" "),a("li",[t._v("Key-Value存储（"),a("code",[t._v("Redis")]),t._v("）")]),t._v(" "),a("li",[t._v("图存储（"),a("code",[t._v("FlockDB")]),t._v("）")]),t._v(" "),a("li",[t._v("对象存储（"),a("code",[t._v("db4o")]),t._v("）")]),t._v(" "),a("li",[t._v("XML存储（"),a("code",[t._v("BaseX")]),t._v("）")])]),t._v(" "),a("p",[t._v("为什么要使用"),a("code",[t._v("NoSQL")]),t._v("?")]),t._v(" "),a("ul",[a("li",[t._v("简单（没有原子性，一致性，隔离性等复杂规则）")]),t._v(" "),a("li",[t._v("便于横向拓展")]),t._v(" "),a("li",[t._v("适合超大规模数据的存储")]),t._v(" "),a("li",[t._v("很灵活的存储复杂解构的数据（schema free）")])]),t._v(" "),a("h2",{attrs:{id:"mongodb简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb简介","aria-hidden":"true"}},[t._v("#")]),t._v(" MongoDB简介")]),t._v(" "),a("p",[a("code",[t._v("MongoDB")]),t._v("来自于英文单词"),a("code",[t._v("Homongous")]),t._v("，中文含义是"),a("font",{attrs:{color:"#3eaf7c"}},[t._v("庞大")]),t._v("的意思，这也意味着它能存储大量的数据。")],1),t._v(" "),a("p",[a("code",[t._v("MongoDB")]),t._v("是面向文档存储的开源数据库，说白了就是当"),a("code",[t._v("json")]),t._v("存储，"),a("font",{attrs:{color:"#3eaf7c"}},[t._v(" 一个文档就一段"),a("code",[t._v("json")]),t._v("，多个文档就构成了集合")]),t._v("，比如说一个用户列表就是一个集合，而某个特定用户就是其中一段文档。同时"),a("code",[t._v("MongoDB")]),t._v("是由"),a("code",[t._v("C++")]),t._v("编写的，支持多种语言进行操作，"),a("code",[t._v("MongoDB")]),t._v("的本地安装我们可以参考"),a("a",{attrs:{href:"https://www.taopoppy.cn/Full-Stack-FriendCircle/ready2.html#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85mongodb",target:"_blank",rel:"noopener noreferrer"}},[t._v("文章"),a("OutboundLink")],1),t._v(",但是我们下面会使用"),a("code",[t._v("云MongoDB")])],1),t._v(" "),a("p",[t._v("为什么要用"),a("code",[t._v("MongoDB")])]),t._v(" "),a("ul",[a("li",[t._v("性能好（内存计算）")]),t._v(" "),a("li",[t._v("大规模的数据存储（可拓展性）")]),t._v(" "),a("li",[t._v("可靠安全（本地复制，自动故障转移）")]),t._v(" "),a("li",[t._v("方便存储复杂的数据结构（schema Free）")])]),t._v(" "),a("p",[a("code",[t._v("云MongoDB")])]),t._v(" "),a("ul",[a("li",[t._v("概念：就是将"),a("code",[t._v("MongoDB")]),t._v("安装在远程的服务器上，是那种服务商家提供的服务器，并向外暴露一个链接地址，我们通过链接地址连接数据库并进行操作")]),t._v(" "),a("li",[t._v("好处：数据存储的规模更大，而且更安全，因为有很多节点和集群，如果安装到自己的服务器，服务器一坏，数据库的数据也没有了，而且也不用我们自己维护")]),t._v(" "),a("li",[t._v("种类：国内有阿里云和腾讯云，都是收费的，我们这里使用"),a("code",[t._v("MongoDB Atlas")]),t._v("（免费+收费）")])]),t._v(" "),a("h2",{attrs:{id:"mongodb-atlas"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-atlas","aria-hidden":"true"}},[t._v("#")]),t._v(" MongoDB Atlas")]),t._v(" "),a("h3",{attrs:{id:"_1-注册用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-注册用户","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 注册用户")]),t._v(" "),a("ul",[a("li",[t._v("打开"),a("a",{attrs:{href:"https://www.mongodb.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB官网"),a("OutboundLink")],1),t._v("然后点击顶部导航栏中的"),a("code",[t._v("Product")]),t._v("，选择第一个"),a("code",[t._v("MongoDB Atlas")])]),t._v(" "),a("li",[t._v("进入页面点击"),a("code",[t._v("start free")]),t._v("，然后页面会自动移动到底部让你填邮箱，姓名和密码，你如实注册即可")]),t._v(" "),a("li",[t._v("然后点击"),a("code",[t._v("get started free")]),t._v("就会跳转到创建"),a("code",[t._v("cluster")]),t._v("界面，如果你不是第一次，它会跳转到管理界面，在管理界面左下角的"),a("code",[t._v("Get Started")]),t._v("的按钮中也能找到"),a("code",[t._v("Build your first cluster")]),t._v("的选项")])]),t._v(" "),a("h3",{attrs:{id:"_2-创建集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建集群","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 创建集群")]),t._v(" "),a("p",[t._v("可以将集群理解成为一个虚拟的服务器，上面已经安装好了一个"),a("code",[t._v("MongoDB")])]),t._v(" "),a("ul",[a("li",[t._v("进入到创建集群的页面后，我们点击"),a("code",[t._v("Build my frist cluster")])]),t._v(" "),a("li",[t._v("选择"),a("code",[t._v("aws")]),t._v("亚马逊，然后选择新加坡"),a("code",[t._v("Singapore")]),t._v(",最后在"),a("code",[t._v("Cluster Name")]),t._v("那一栏中修改集群名称，点击"),a("code",[t._v("Create Cluster")]),t._v("即可")]),t._v(" "),a("li",[t._v("创建集群大概需要7分钟左右的时间，另外这个是外国的官网，速度很慢，你可能需要翻墙，翻墙的教程我也在博客中有提到，你可以点击"),a("a",{attrs:{href:"https://www.taopoppy.cn/construct/science_online.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),a("OutboundLink")],1),t._v("查看")])]),t._v(" "),a("h3",{attrs:{id:"_3-添加数据库用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-添加数据库用户","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 添加数据库用户")]),t._v(" "),a("ul",[a("li",[t._v("集群创建完毕后悔到管理界面，我们在左下角点击"),a("code",[t._v("Get Started")]),t._v("，进行其中的第二部，"),a("code",[t._v("Create your first database user")]),t._v("，也就是创建数据库用户。")]),t._v(" "),a("li",[t._v("点击了之后它会给你提示，你就按照提示的点击响应的内容，最后会让你点击"),a("code",[t._v("ADD NEW USER")])]),t._v(" "),a("li",[t._v("然后在添加用户的面板中填写"),a("code",[t._v("username")]),t._v("和密码，在下面的"),a("code",[t._v("User Privileges")]),t._v("（权限）中选择第二个读写权限，然后选择添加")])]),t._v(" "),a("h3",{attrs:{id:"_4-设置ip地址白名单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-设置ip地址白名单","aria-hidden":"true"}},[t._v("#")]),t._v(" 4. 设置IP地址白名单")]),t._v(" "),a("ul",[a("li",[t._v("添加了数据库用户后会在左下角弹出第三步"),a("code",[t._v("Whitelist you IP address")]),t._v("，就是将你的IP地址添加到白名单，点击它")]),t._v(" "),a("li",[t._v("根据提示一步一步点击到最后点击的按钮是"),a("code",[t._v("ADD IP ADDRESS")])]),t._v(" "),a("li",[t._v("在弹出的面板中选择"),a("code",[t._v("ALLOW ACCESS FROM ANYWHERE")]),t._v(",就是可以从任何地址访问，因为如果你的IP地址经常变动，最好选择这个，不要选择第一个"),a("code",[t._v("ADD CURRENT IP ADDRESS")]),t._v("（当前IP）")]),t._v(" "),a("li",[t._v("添加后下一步是"),a("code",[t._v("Load Sample Data")]),t._v(",这个是可选的，我们可以跳过")])]),t._v(" "),a("h3",{attrs:{id:"_5-获取连接地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-获取连接地址","aria-hidden":"true"}},[t._v("#")]),t._v(" 5. 获取连接地址")]),t._v(" "),a("ul",[a("li",[t._v("点击"),a("code",[t._v("Connect to your cluster")]),t._v(",选择"),a("code",[t._v("connect Your Application")])]),t._v(" "),a("li",[t._v("在"),a("code",[t._v("Connection String Only")]),t._v("中的那个地址就是我们后面要在"),a("code",[t._v("mongoose")]),t._v("中连接的地址：我们暂时要将其记住：（我这里记住我的，你们记住你们的）"),a("code",[t._v("mongodb+srv://taopoppy:<password>@zhihu-2kvxj.mongodb.net/test?retryWrites=true&w=majority")])])]),t._v(" "),a("h2",{attrs:{id:"mongoose连接mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongoose连接mongodb","aria-hidden":"true"}},[t._v("#")]),t._v(" Mongoose连接MongoDB")]),t._v(" "),a("p",[t._v("实际上"),a("code",[t._v("MongoDB")]),t._v("有"),a("code",[t._v("node")]),t._v("的驱动的，但是原生的驱动用起来不方便，而"),a("code",[t._v("mongoose")]),t._v("能使"),a("code",[t._v("node")]),t._v("连接"),a("code",[t._v("MongoDB")]),t._v("数据库变得非常生动和简单，我们下面就来说说操作步骤")]),t._v(" "),a("p",[t._v("安装"),a("code",[t._v("mongoose")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" mongoose --save\n")])])]),a("p",[t._v("然后引入并使用：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mongoose "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongoose'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引入")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" connenctionStr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./config'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引入地址")]),t._v("\n\nmongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("connenctionStr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n  useNewUrlParser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  useFindAndModify"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("`MongoDB连接成功`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("上面代码总的"),a("code",[t._v("connenctionStr")]),t._v("就是我们上面在"),a("code",[t._v("MongoDB Atlas")]),t._v("中获取的连接地址，然后关于"),a("code",[t._v("useNewUrlParser")]),t._v("和"),a("code",[t._v("useFindAndModify")]),t._v("的配置都是后面我们在测试的时候"),a("code",[t._v("MongoDB")]),t._v("给我们提示的，最后启动")]),t._v(" "),a("h2",{attrs:{id:"设计用户的schema"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设计用户的schema","aria-hidden":"true"}},[t._v("#")]),t._v(" 设计用户的Schema")]),t._v(" "),a("p",[t._v("我们这里的"),a("code",[t._v("Schema")]),t._v("指的是"),a("code",[t._v("json")]),t._v("的结构，而且设计和编写的"),a("code",[t._v("Schema")]),t._v("都是写在代码当中的，不用对数据库进行设置")]),t._v(" "),a("h3",{attrs:{id:"_1-分析用户模块的属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-分析用户模块的属性","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 分析用户模块的属性")]),t._v(" "),a("p",[t._v("比如现在我们认为用户只有简单的"),a("code",[t._v("name")]),t._v("和"),a("code",[t._v("age")]),t._v("属性，这样就足够了，因为分析就是思考的过程")]),t._v(" "),a("h3",{attrs:{id:"_2-用户模块的schema和model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-用户模块的schema和model","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 用户模块的Schema和Model")]),t._v(" "),a("p",[a("code",[t._v("mongoose")]),t._v("提供了一系列的方法，我们只要往里填就行了，我们在"),a("code",[t._v("app/modules")]),t._v("下面新建"),a("code",[t._v("users.js")]),t._v("文件，写如下代码")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mongoose "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongoose'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" model "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoose  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Schema和model是个类")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义文档结构")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" userSchema "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" required"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" required"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建用户模型")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("model")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'User'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" userSchema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"mongodb实现增删改查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb实现增删改查","aria-hidden":"true"}},[t._v("#")]),t._v(" MongoDB实现增删改查")]),t._v(" "),a("p",[t._v("我们这里直接上传控制器的代码：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" User "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../models/users'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UsersCtl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 查询用户列表\n   */")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 查询特定用户\n\n   */")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("throw")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'用户不存在'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" user\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 新建用户\n   */")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 校验")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("verifyParams")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'string'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" required"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newUser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//数据库会自动帮我们添加ID")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newUser\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 更新用户\n   */")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("verifyParams")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'string'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" required"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" updateUser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("findByIdAndDelete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("updateUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("throw")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'更新用户不存在'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" updateUser\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 删除用户\n   */")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" deleteUser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("findByIdAndRemove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("deleteUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("throw")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'删除用户不存在'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("204")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UsersCtl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("然后我们去"),a("code",[t._v("postman")]),t._v("中测试，测试都没有问题")])])},[],!1,null,null,null);s.default=e.exports}}]);