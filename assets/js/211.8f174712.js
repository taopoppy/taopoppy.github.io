(window.webpackJsonp=window.webpackJsonp||[]).push([[211],{397:function(t,s,a){"use strict";a.r(s);var n=a(0),r=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"开始项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始项目","aria-hidden":"true"}},[t._v("#")]),t._v(" 开始项目")]),t._v(" "),a("h2",{attrs:{id:"项目创建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目创建","aria-hidden":"true"}},[t._v("#")]),t._v(" 项目创建")]),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("① 安装koa-generator")])])],1),t._v(" "),a("p",[a("code",[t._v("koa-generator")]),t._v("是用来搭建"),a("code",[t._v("koa2")]),t._v("项目的一个脚手架，我们直接到"),a("a",{attrs:{href:"https://www.npmjs.com/package/koa-generator",target:"_blank",rel:"noopener noreferrer"}},[t._v("npm官网"),a("OutboundLink")],1),t._v("上去找到全局安装命令并在任意目录下执行即可：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("npm install "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g koa"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("generator\n")])])]),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("② 创建项目")])])],1),t._v(" "),a("p",[t._v("因为全局安装了脚手架，现在我们的命令行当中就有"),a("code",[t._v("koa2")]),t._v("这个命令了，因为我们需要通过"),a("code",[t._v("ejs")]),t._v("模块引擎来渲染前端页面，所以我们的创建命令如下：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("koa2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e koa2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("weibo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("code\n")])])]),a("p",[t._v("接着它会提示你要进入目录并且安装依赖，我们就继续执行命令：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("cd koa2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("weibo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" npm install\n")])])]),a("p",[t._v("如果网络比较差，建议使用"),a("code",[t._v("cnpm")]),t._v("或者在后面添加淘宝镜像参数，命令如下：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("npm install "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("registry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("taobao"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org\n")])])]),a("h2",{attrs:{id:"提交代码和迭代"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提交代码和迭代","aria-hidden":"true"}},[t._v("#")]),t._v(" 提交代码和迭代")]),t._v(" "),a("p",[t._v("下面所有的命令我们都在刚才创建的"),a("code",[t._v("koa2-weibo-code")]),t._v("项目文件中执行"),a("br"),t._v(" "),a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("① 初始化一个git仓库")])])],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("git init\n")])])]),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("② 添加远程仓库源")])])],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("git remote add origin git@e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("coding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("net"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("taopoppy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("koa2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("weibo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\n")])])]),a("p",[t._v("添加完成可以使用"),a("code",[t._v("git status")]),t._v("来查看本地仓库的状态")]),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("③ 拉取远程仓库内容")])])],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("git pull origin master\n")])])]),a("p",[t._v("拉取后就会将远程仓库中的"),a("code",[t._v(".gitIgnore")]),t._v("或者"),a("code",[t._v("READM.md")]),t._v("拉取到本地，当然取决于你在"),a("code",[t._v("github")]),t._v("或者"),a("code",[t._v("coding.net")]),t._v("上面的创建方式了。")]),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("④ 提交")])])],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("git add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\ngit commit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"init project"')]),t._v("\ngit push origin master\n")])])]),a("h2",{attrs:{id:"完善其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#完善其他","aria-hidden":"true"}},[t._v("#")]),t._v(" 完善其他")]),t._v(" "),a("p",[t._v("下面讲两个需要注意的问题：")]),t._v(" "),a("ul",[a("li",[t._v("第一个就是如果你从远程拉取下来的是"),a("code",[t._v(".gitIgnore")]),t._v(",你只需要添加"),a("code",[t._v("README.md")]),t._v("文件即可，如果拉取的是"),a("code",[t._v("README.md")]),t._v("，你需要自己添加"),a("code",[t._v(".gitIgnore")]),t._v("文件")]),t._v(" "),a("li",[t._v("下载"),a("code",[t._v("cross-env")]),t._v("用于设置环境变量的插件"),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("npm i cross"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("env "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\n")])])]),t._v("然后在"),a("code",[t._v("package.json")]),t._v("当中修改启动命令：\n"),a("ul",[a("li",[a("code",[t._v('"dev": "cross-env NODE_ENV=dev ./node_modules/.bin/nodemon bin/www"')]),t._v(",")]),t._v(" "),a("li",[a("code",[t._v('"prd": "cross-env NODE_ENV=production pm2 start bin/www"')]),t._v(",")])])])]),t._v(" "),a("h2",{attrs:{id:"项目结构讲解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目结构讲解","aria-hidden":"true"}},[t._v("#")]),t._v(" 项目结构讲解")]),t._v(" "),a("p",[t._v("整个项目在创建完毕和提交完毕后，我们就先来看看原始的目录结构，并简单了解一下，由于原始文件太裸露，通常我们在企业项目中业务的代码都会放在一个"),a("code",[t._v("src")]),t._v("文件夹下面，所以我们先修改一下结构：")]),t._v(" "),a("ul",[a("li",[a("font",{attrs:{color:"#DD1144"}},[t._v("在项目的目录下创建一个src目录")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#DD1144"}},[t._v("将public文件夹、routes文件夹、views文件夹和app.js文件全部移动到我们新创建的src文件夹下面")])],1),t._v(" "),a("li",[a("font",{attrs:{color:"#DD1144"}},[t._v("对应着改变一下路由的引入（我这里只修改了WWW里面对app的引用路由，因为app现在移动了到src里面）")])],1)]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" bin\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WWW")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" node_modules   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 依赖文件夹")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" src "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 业务代码文件")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 静态资源文件夹")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" images\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" javascripts\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" stylesheets\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" routes "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 路由文件夹")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" views  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ejs模板文件夹")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ejs\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ejs\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实际启动文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 包锁文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 包管理配置文件")]),t._v("\n")])])]),a("ul",[a("li",[a("p",[t._v("我们首先来看"),a("code",[t._v("WWW")]),t._v("文件，因为往往我们启动的文件应该是"),a("code",[t._v("index.js")]),t._v("或者是"),a("code",[t._v("app.js")]),t._v("，但是在真正的企业级开发的时候："),a("font",{attrs:{color:"#3eaf7c"}},[t._v("业务app和server app应该是分开的")]),t._v("，所以你看到"),a("code",[t._v("app.js")]),t._v("当中有很多路由注册还有中间件的添加都是和业务有关系的，"),a("font",{attrs:{color:"#3eaf7c"}},[t._v("而WWW是将创建http服务的这个创建server的代码从app当中抽离了出来")]),t._v("，所以这个文件你也不需要改，也不用管太多。")],1)]),t._v(" "),a("li",[a("p",[t._v("而"),a("code",[t._v("app.js")]),t._v("这个文件只是返回了一个"),a("code",[t._v("Koa")]),t._v("的实例而已，这样的拆分也比较符合开放封闭原则，而里面的内容我们需要详细讲解一下")])])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// error handler")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onerror")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理错误的，发生了错误会在页面显示出来")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// middlewares")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bodyparser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  enableTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'form'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 负责解析post请求中发送的json数据、form数据等等")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过bodyparser解析出来是字符串形式的，通过json解析成为对象格式的")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("logger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 日志功能")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-static'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/public'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将public这个目录注册为静态资源，通过http://localhost:3000/stylesheets/style.css可以直接访问css文件")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("views")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/views'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  extension"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ejs'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册ejs，能让ejs正常编译")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// routes")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("allowedMethods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册路由")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("allowedMethods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// error-handling")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'server error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 控制台打印错误，和前面的onerror(app)是不一样的，前面的onerror(app)是在客户端页面上显示错误的")]),t._v("\n")])])]),a("p",[t._v("然后我们提交一下代码：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("git add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\ngit commit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'refactor: 调整目录结构'")]),t._v("\ngit push origin master\n")])])]),a("h2",{attrs:{id:"路由粗解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由粗解","aria-hidden":"true"}},[t._v("#")]),t._v(" 路由粗解")]),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("① 路由参数")])])],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/profile/:userName'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" userName "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'this is profile page'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    userName\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("通过这种书写"),a("code",[t._v(":userName")]),t._v("这个来实现动态路由参数的使用")]),t._v(" "),a("li",[t._v("在服务端通过"),a("code",[t._v("ctx.params")]),t._v("拿到前端传来的具体参数值"),a("br"),t._v("\n比如我们在前端输入"),a("code",[t._v("http://localhost:3000/profile/zhangsan")]),t._v(",那么我们在页面得到的服务端的返回值如下：")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"this is profile page"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zhangsan"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("动态参数可以写多个，都可以通过"),a("code",[t._v("ctx.params")]),t._v("对象中解构出来")]),t._v(" "),a("p",[a("font",{attrs:{color:"#1E90FF"}},[a("strong",[t._v("② Post参数")])])],1),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/login'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" userName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    userName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    password\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("因为前端发来的数据通过我们之前引用的中间件"),a("code",[t._v("koa-bodparser")]),t._v("和"),a("code",[t._v("json")]),t._v("已经解析成为了一个对象，并且绑定在了"),a("code",[t._v("ctx.request.body")]),t._v("上面，然后我们就能对拿到的数据做校验等操作了")]),t._v(" "),a("li",[t._v("至于为什么绑定在"),a("code",[t._v("ctx.request.body")]),t._v("上面，因为"),a("code",[t._v("ctx.body")]),t._v("已经被占用了")]),t._v(" "),a("li",[t._v("除了"),a("code",[t._v("get")]),t._v("请求，其他请求我们需要借助"),a("code",[t._v("PostMan")]),t._v("来测试，这个我们在这里就不仔细说了，相信你肯定会。")])]),t._v(" "),a("p",[t._v("最后我们提交一下代码：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("git add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\ngit commit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"feat：路由演示"')]),t._v("\ngit push origin master\n")])])])])},[],!1,null,null,null);s.default=r.exports}}]);